var svManager={getInstance:function(){var B=window.$rdp;if(B&&B.running&&B.running())return B;return null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(B){var aa=new Object;aa.id=B.id;aa.server=B.id;aa.displayName=B.displayName||B.id;var pa=B.rdp;if(pa){for(var Ua in pa)aa[Ua]=pa[Ua];aa.user=pa.username||"";aa.pwd=pa.password||"";aa.useConsole=pa.console||false;aa.legacyMode=pa.leagacyMode||pa.legacyMode||false;aa.server_bpp=pa.color||16;aa.exe=pa.remoteProgram||"";aa.args=pa.remoteArgs||"";if(aa.exe.length>0)aa.startProgram="app";else if(aa.command&&aa.command.length>0)aa.startProgram="shell";else aa.startProgram="noapp"}return aa}
function Rdp2(B){if(!B){var aa=window.opener;try{if(aa&&aa.__sparkUser&&aa.__sparkUser.server)B=aa.__sparkUser.server;if(!B&&aa.sparkServer)B=aa.sparkServer}catch(Ea){}if(!B)B=hi5.browser.cookie2Obj();if(!B||!B.gateway){hi5.notifications.notify({"msg":__svi18n.noauth});return null}}var pa="";var Ua=B.gateway||"";var ia=window.innerWidth;var ea=window.innerHeight;var lb=16;var na=null;if(B.width)ia=parseInt(B.width,10);if(B.height)ea=parseInt(B.height,10);if(B.color)lb=parseInt(B.color,10);if(B.server_bpp)lb=
parseInt(B.server_bpp,10);for(var oa in B){svGlobal.logger.debug("** p:"+oa+" v="+B[oa]);var ya=B[oa];if("useSSL"==oa){na=ya=="true"||ya==true;continue}if(typeof ya=="boolean")if(ya)ya="on";else continue;if(""!=pa)pa+="&";pa+=oa+"="+encodeURIComponent(ya)}if(na===null)na="https:"==location.protocol;oa=na?"wss://":"ws://";pa=oa+Ua+"/RDP?"+pa;return new Rdp(pa,ia,ea,lb)}svGlobal.Rdp2=Rdp2;
function Rdp(B,aa,pa,Ua){function ia(b){return mb?new Uint32Array(b):new Array(b)}function ea(b){return mb in window?new Int32Array(b):new Array(b)}function lb(b){return mb?new Float32Array(b):new Array(b)}function na(b){return mb?new Uint8Array(b):new Array(b)}function oa(b){return b=="on"||b=="true"}function ya(b){return b=="off"||b=="false"}function Ea(){var b=m.gateway;if(m.ongetgatewayaddress)b=m.ongetgatewayaddress(b);return b}function Qb(b){if(hi5.browser.isiOS){var e=b-hi5.browser.innerHeight;
if(e>10&&e<22)b=hi5.browser.innerHeight}return b}function Sc(){var b=hi5.storage.get("SV_CONN_SHARE_ID");if(!b){b=hi5.tool.uuid();hi5.storage.set("SV_CONN_SHARE_ID",b)}return b}function Na(){return t.displayName||t.server||t.symlink||t.id||"undefined"}function zb(b,e){if(m.setTitle){e=e||window;if(m.ontitlechange)b=m.ontitlechange(b);e.document.title=b}}function Rb(){function b(b,d,f,c,h,Ca,u,F){var O=0;var D="Int32Array"in window?new Int32Array(160):Array(160);if(!D.buffer)ta(D,0,160,0);var m="Int32Array"in
window?new Int32Array(40):Array(40);if(!m.buffer)ta(m,0,40,0);var K=120;for(var Q=0;Q<=3;Q++,O+=13){e(h[Q],f[Q],O,Ca,m);g(d[Q],c[Q],m,K);Ga(y,K,D,Q*40,39)}var I=ea(8);var Y=A[Va];var Wa=A[Va^=1];a(b,Y);k(Wa,Y,I);q(I);r(I,13,D,u,0,F);x(Wa,Y,I);q(I);r(I,14,D,u,13,F);n(Wa,Y,I);q(I);r(I,13,D,u,27,F);l(Y,I);q(I);r(I,120,D,u,40,F);var J=0;var t=F;for(var z=F+160;z-- >F;t++){J=p(C,28180);C=u[t]+J;if(C<-32768)C=-32768;else if(C>32767)C=32767;J=C<<1;if(J<-32768)J=-32768;else if(J>32767)J=32767;u[t]=J}}function e(b,
e,g,a,h){var Ca=ea(13);if(!Ca.buffer)ta(Ca,0,13,0);var q;q=f(b);d(a,Ca,g,q[0],q[1]);c(e,Ca,h)}function f(b){var e=0;var d=0;if(b>15)e=(b>>3)-1;d=b-(e<<3);if(d==0){e=-4;d=7}else{for(;d<=7;){d=d<<1|1;e--}d-=8}var f=new Array(2);f[0]=e;f[1]=d;return f}function d(b,e,d,f,c){var g;var a;var h;var q;a=u[c];h=m(6,f);q=I(1,m(h,1));var k=0;for(var n=0;n<13;n++){g=(b[d++]<<1)-7;g<<=12;g=p(a,g);g=g+q;if(g<-32768)g=-32768;else if(g>32767)g=32767;e[k++]=J(g,h)}}function c(b,e,d){var f=13;var c=0;var g=0;switch(b){case 3:d[g++]=
0;case 2:d[g++]=0;case 1:d[g++]=0;case 0:d[g++]=e[c++];f--}do{d[g++]=0;d[g++]=0;d[g++]=e[c++]}while(--f>0);for(;++b<4;)d[g++]=0}function g(b,e,d,f){var c;var g;var a;a=b<40||b>120?Wa:b;Wa=a;c=D[e];for(var h=0;h<=39;h++){g=p(c,y[h-a+f]);g=g+d[h];if(g<-32768)g=-32768;else if(g>32767)g=32767;y[h+f]=g}Ga(y,f-80,y,f-120,120)}function a(b,e){var d=0;var f=0;h(b,e,f++,d,0,-32,13107);h(b,e,f++,d,0,-32,13107);h(b,e,f++,d,2048,-16,13107);h(b,e,f++,d,-2560,-16,13107);h(b,e,f++,d,94,-8,19223);h(b,e,f++,d,-1792,
-8,17476);h(b,e,f++,d,-341,-4,31454);h(b,e,f++,d,-1144,-4,29708)}function h(b,e,d,f,c,g,a){f=b[d]+g;if(f<-32768)f=-32768;else if(f>32767)f=32767;f<<=10;f=m(f,c<<1);f=p(a,f);f=f+f;if(f<-32768)f=-32768;else if(f>32767)f=32767;e[d]=f}function k(b,e,d){var f=0;for(var c=0;c<8;c++){f=(b[c]>>2)+(e[c]>>2);if(f<-32768)f=-32768;else if(f>32767)f=32767;f=f+(b[c]>>1);if(f<-32768)f=-32768;else if(f>32767)f=32767;d[c]=f}}function x(b,e,f){var d=0;for(var c=0;c<8;c++){d=(b[c]>>1)+(e[c]>>1);if(d<-32768)d=-32768;
else if(d>32767)d=32767;f[c]=d}}function n(b,e,f){var d=0;for(var c=0;c<8;c++){d=(b[c]>>2)+(e[c]>>2);if(d<-32768)d=-32768;else if(d>32767)d=32767;d=d+(e[c]>>1);if(d<-32768)d=-32768;else if(d>32767)d=32767;f[c]=d}}function l(b,e){for(var d=0;d<8;d++)e[d]=b[d]}function q(b){var e=0;for(var d=0;d<8;d++)if(b[d]<0){e=b[d]==-32768?32767:-b[d];b[d]=-(e<11059?e<<1:e<20070?e+11059:O(e>>2,26112))}else{e=b[d];b[d]=e<11059?e<<1:e<20070?e+11059:O(e>>2,26112)}}function r(b,e,d,f,c,g){var a=0;var h=0;for(var q=
0;e!=0;){e--;a=d[c];for(var k=7;k>=0;k--){h=b[k];q=K[k];q=((h==-32768&&q==-32768?32767:65535&h*q+16384>>15)&65535)<<16>>16;a=m(a,q);h=((h==-32768&&a==-32768?32767:65535&h*a+16384>>15)&65535)<<16>>16;h=K[k]+h;if(h<-32768)h=-32768;else if(h>32767)h=32767;K[k+1]=h}f[g+c++]=K[0]=a}}function p(b,e){if(b==-32768&&e==-32768)return 32767;else{var d=b*e+16384;d=(d>>15&65535)<<16>>16;return d}}function O(b,e){var d=b+e;return d<-32768?-32768:d>32767?32767:d}function m(b,e){var d=b-e;return d<-32768?-32768:
d>32767?32767:d}function I(b,e){if(e>=16)return 0;if(e<=-16)if(b<0)return-1;else return-0;if(e<0)return J(b,-e);return b<<e}function J(b,e){if(e>=16)if(b<0)return-1;else return 0;if(e<=-16)return 0;if(e<0)return b<<-e;return b>>e}var u=[18431,20479,22527,24575,26623,28671,30719,32767];var D=[3277,11469,21299,32767];var y=ea(280);y[0]=0;var A=[ea(8),ea(8)];var Va=0;var Wa=40;var K=ea(9);var C=0;var F=ea(320);F[0]=0;var Y=[.1];this.decode=function(e,d,f){var c=0;var g=0;var a=0;var h=ea(8);var q=ea(4);
var k=ea(4);var n=ea(4);var x=ea(4);var l=ea(52);if(ba)ba.begin("audioDec");for(;d<f;){a=0;a=e[d++]&255;h[0]=a&63;a=a>>>6;a|=e[d++]<<2&1023;h[1]=a&63;a=a>>>6;a|=e[d++]<<4&4095;h[2]=a&31;a=a>>>5;h[3]=a&31;a=a>>>5;a|=e[d++]<<2&1023;h[4]=a&15;a=a>>>4;h[5]=a&15;a=a>>>4;a|=e[d++]<<2&1023;h[6]=a&7;a=a>>>3;h[7]=a&7;a=a>>>3;a|=e[d++]<<4&4095;q[0]=a&127;a=a>>>7;n[0]=a&3;a=a>>>2;k[0]=a&3;a=a>>>2;a|=e[d++]<<1&511;x[0]=a&63;a=a>>>6;l[0]=a&7;a=a>>>3;a=e[d++]&255;l[1]=a&7;a=a>>>3;l[2]=a&7;a=a>>>3;a|=e[d++]<<2&
1023;l[3]=a&7;a=a>>>3;l[4]=a&7;a=a>>>3;l[5]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[6]=a&7;a=a>>>3;l[7]=a&7;a=a>>>3;l[8]=a&7;a=a>>>3;a=e[d++]&255;l[9]=a&7;a=a>>>3;l[10]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[11]=a&7;a=a>>>3;l[12]=a&7;a=a>>>3;a|=e[d++]<<4&4095;q[1]=a&127;a=a>>>7;n[1]=a&3;a=a>>>2;k[1]=a&3;a=a>>>2;a|=e[d++]<<1&511;x[1]=a&63;a=a>>>6;l[13]=a&7;a=a>>>3;a=e[d++]&255;l[14]=a&7;a=a>>>3;l[15]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[16]=a&7;a=a>>>3;l[17]=a&7;a=a>>>3;l[18]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[19]=a&7;a=a>>>
3;l[20]=a&7;a=a>>>3;l[21]=a&7;a=a>>>3;a=e[d++]&255;l[22]=a&7;a=a>>>3;l[23]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[24]=a&7;a=a>>>3;l[25]=a&7;a=a>>>3;a|=e[d++]<<4&4095;q[2]=a&127;a=a>>>7;n[2]=a&3;a=a>>>2;k[2]=a&3;a=a>>>2;a|=e[d++]<<1&511;x[2]=a&63;a=a>>>6;l[26]=a&7;a=a>>>3;a=e[d++]&255;l[27]=a&7;a=a>>>3;l[28]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[29]=a&7;a=a>>>3;l[30]=a&7;a=a>>>3;l[31]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[32]=a&7;a=a>>>3;l[33]=a&7;a=a>>>3;l[34]=a&7;a=a>>>3;a=e[d++]&255;l[35]=a&7;a=a>>>3;l[36]=a&7;a=a>>>
3;a|=e[d++]<<2&1023;l[37]=a&7;a=a>>>3;l[38]=a&7;a=a>>>3;a|=e[d++]<<4&4095;q[3]=a&127;a=a>>>7;n[3]=a&3;a=a>>>2;k[3]=a&3;a=a>>>2;a|=e[d++]<<1&511;x[3]=a&63;a=a>>>6;l[39]=a&7;a=a>>>3;a=e[d++]&255;l[40]=a&7;a=a>>>3;l[41]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[42]=a&7;a=a>>>3;l[43]=a&7;a=a>>>3;l[44]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[45]=a&7;a=a>>>3;l[46]=a&7;a=a>>>3;l[47]=a&7;a=a>>>3;a=e[d++]&255;l[48]=a&7;a=a>>>3;l[49]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[50]=a&7;a=a>>>3;l[51]=a&7;a=a>>>3;b(h,q,k,n,x,l,F,0);a=a&15;
a|=e[d++]<<4&4095;h[0]=a&63;a=a>>>6;h[1]=a&63;a=a>>>6;a=e[d++]&255;h[2]=a&31;a=a>>>5;a|=e[d++]<<3&2047;h[3]=a&31;a=a>>>5;h[4]=a&15;a=a>>>4;a|=e[d++]<<2&1023;h[5]=a&15;a=a>>>4;h[6]=a&7;a=a>>>3;h[7]=a&7;a=a>>>3;a=e[d++]&255;q[0]=a&127;a=a>>>7;a|=e[d++]<<1&511;n[0]=a&3;a=a>>>2;k[0]=a&3;a=a>>>2;a|=e[d++]<<5&8191;x[0]=a&63;a=a>>>6;l[0]=a&7;a=a>>>3;l[1]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[2]=a&7;a=a>>>3;l[3]=a&7;a=a>>>3;l[4]=a&7;a=a>>>3;a=e[d++]&255;l[5]=a&7;a=a>>>3;l[6]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[7]=a&
7;a=a>>>3;l[8]=a&7;a=a>>>3;l[9]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[10]=a&7;a=a>>>3;l[11]=a&7;a=a>>>3;l[12]=a&7;a=a>>>3;a=e[d++]&255;q[1]=a&127;a=a>>>7;a|=e[d++]<<1&511;n[1]=a&3;a=a>>>2;k[1]=a&3;a=a>>>2;a|=e[d++]<<5&8191;x[1]=a&63;a=a>>>6;l[13]=a&7;a=a>>>3;l[14]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[15]=a&7;a=a>>>3;l[16]=a&7;a=a>>>3;l[17]=a&7;a=a>>>3;a=e[d++]&255;l[18]=a&7;a=a>>>3;l[19]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[20]=a&7;a=a>>>3;l[21]=a&7;a=a>>>3;l[22]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[23]=a&7;a=a>>>3;l[24]=
a&7;a=a>>>3;l[25]=a&7;a=a>>>3;a=e[d++]&255;q[2]=a&127;a=a>>>7;a|=e[d++]<<1&511;n[2]=a&3;a=a>>>2;k[2]=a&3;a=a>>>2;a|=e[d++]<<5&8191;x[2]=a&63;a=a>>>6;l[26]=a&7;a=a>>>3;l[27]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[28]=a&7;a=a>>>3;l[29]=a&7;a=a>>>3;l[30]=a&7;a=a>>>3;a=e[d++]&255;l[31]=a&7;a=a>>>3;l[32]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[33]=a&7;a=a>>>3;l[34]=a&7;a=a>>>3;l[35]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[36]=a&7;a=a>>>3;l[37]=a&7;a=a>>>3;l[38]=a&7;a=a>>>3;a=e[d++]&255;q[3]=a&127;a=a>>>7;a|=e[d++]<<1&511;n[3]=
a&3;a=a>>>2;k[3]=a&3;a=a>>>2;a|=e[d++]<<5&8191;x[3]=a&63;a=a>>>6;l[39]=a&7;a=a>>>3;l[40]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[41]=a&7;a=a>>>3;l[42]=a&7;a=a>>>3;l[43]=a&7;a=a>>>3;a=e[d++]&255;l[44]=a&7;a=a>>>3;l[45]=a&7;a=a>>>3;a|=e[d++]<<2&1023;l[46]=a&7;a=a>>>3;l[47]=a&7;a=a>>>3;l[48]=a&7;a=a>>>3;a|=e[d++]<<1&511;l[49]=a&7;a=a>>>3;l[50]=a&7;a=a>>>3;l[51]=a&7;a=a>>>3;b(h,q,k,n,x,l,F,160);g=c++*320;for(var r=0;r<320;r++)Y[g++]=F[r]/32768}Y.length=c*320;if(ba)ba.end("audioDec");return Y}}function Sb(b,e){function f(b,
e,d,f,c,g){var h=b+c;var q=e+g;var l=0;var k=0;if(a[0].set)for(;k<f;k++)a[q+k].set(a[e+k].subarray(b,b+d),h);else for(;k<f;k++){var n=a[q+k];var x=a[e+k];for(l=0;l<d;l++)n[h+l]=x[b+l]}}function d(b,e,d,f,c,g){var h=b+c;var q=e+g;var k=0;var l=0;if(a[0].set)for(l=f-1;l>=0;l--)a[q+l].set(a[e+l].subarray(b,b+d),h);else for(l=f-1;l>=0;l--){var n=a[q+l];var x=a[e+l];for(k=0;k<d;k++)n[h+k]=x[b+k]}}function c(b,e,d,f,c,g){var h=b+c;var q=e+g;var l=0;var k=0;var n=0;var x=0;for(l=d-1;l>=0;l--){n=h+l;x=b+
l;for(k=0;k<f;k++)a[q+k][n]=a[e+k][x]}}function g(b,e,d,f,c,g){var h=b+c;var q=e+g;var l=0;var k=0;var n=0;for(var x=0;l<d;l++){n=h+l;x=b+l;for(k=0;k<f;k++)a[q+k][n]=a[e+k][x]}}var a=[];var h=null;var k=new ob(0,0,0,0);var x="Uint8ClampedArray"in window;var n="Uint32Array"in window;var l=0;var q=0;var r=0;var p=0;var O=null;this.width=b;this.height=e;var m=false;var I=this;var J=null;this.setImgRect=function(a,b,e,d){l=a;q=b;r=e;p=d};this.addImg=function(a){if(r){if(O)URL.revokeObjectURL(O.src);O=
a}};this.flushImgs=function(){if(O){URL.revokeObjectURL(O.src);O=null;r=0}};this.getData=function(){return a};this.pause=function(a){m=a};this.release=function(){I.flushImgs();I=null;h=null;a=null;J=null};this.isPaused=function(){return m};this.setContext=function(a){if(a==h)return;if(!h&&a&&!a.createImageData(1,1).data.buffer)x=false;h=a;if(h!=null)J=h.createImageData(b,e)};this.getContext=function(){return h};this.resize=function(d,f){if(n)for(var c=0;c<f;c++)a[c]=new Uint32Array(d);else if(f>a.length)for(c=
a.length;c<f;c++)a[c]=[0];I.width=b=d;I.height=e=f;if(h!=null)J=h.createImageData(b,e)};I.resize(b,e);this.getBuffer=function(){return a};this.setRGB=function(b,e,d){a[e][b]=d|4278190080};this.getRGB=function(b,e){return a[e][b]};this.setRGBs=function(b,d,f,c,g,h,q){var l=h;var k=0;var n=0;var x=b+f;var r=d+c;if(r>e)r=e;if(g.subarray)for(var p=d;p<r;p++,l+=q)a[p].set(g.subarray(l,l+f),b);else{var O;for(p=d;p<r;p++,l+=q){n=l;O=a[p];for(k=b;k<x;k++)O[k]=g[n++]}}};this.moveArea=function(a,b,e,h,l,q){if(q>
0)d(a,b,e,h,l,q);else if(q<0)f(a,b,e,h,l,q);else if(l>0)c(a,b,e,h,l,q);else g(a,b,e,h,l,q)};this.getRGBs=function(b,e,d,f){var c=d*f;var g=ia(c);var h=b+d;var q=e+f;var l=0;var k=0;if(n)for(ua=e;ua<q;ua++){g.set(a[ua].subarray(b,h),l);l+=d}else for(ua=e;ua<q;ua++)for(k=b;k<h;k++)g[l++]=a[ua][k];return g};this.repaint=function(d,f,c,g){var l=J.data;var q=0;var k=0;var n=0|0;var r=0;var p=0;var O=0|0;var m=0|0;if(ba)ba.begin("paint");if(d<0){c+=d;d=0}if(f<0){g+=f;f=0}if(d+c>b)c=b-d;if(f+g>e)g=e-f;q=
d+c;k=f+g;if(x){var I=new Uint32Array(l.buffer);for(p=f;p<k;p++){I.set(a[p].subarray(d,q),n);n+=b}}else{m=(b-c)*4|0;for(p=f;p<k;p++){for(r=d;r<q;r++){O=a[p][r];l[n++]=O&255;l[n++]=O>>8&255;l[n++]=O>>16&255;l[n++]=255}n+=m}}h.putImageData(J,d,f,0,0,c,g);if(ba)ba.end("paint")};this.postPaint=function(a,b,e,d){if(k.width>0)k.union(a,b,e,d);else{k.x=a;k.y=b;k.width=e;k.height=d}};this.draw=function(){if(h&&!m){if(O&&O.complete){h.drawImage(O,l,q,r,p);URL.revokeObjectURL(O.src);O=null}if(k.width){I.repaint(k.x,
k.y,k.width,k.height);k.width=0}}};this.paintTo=function(a,d){if(a==0&&d==0)I.repaint(0,0,b,e);else svGlobal.logger.warn("xx paintTo, x:"+a+" y:"+d)};this.fillRect=function(b,e,d,f,c){var g=b+d;var h=e+f;if(a[0].fill){var l;for(var q=e;q<h;q++)a[q].fill(c,b,g)}else for(q=e;q<h;q++)for(l=b;l<g;l++)a[q][l]=c};this.drawLine=function(b,e,d,f,c){var g=0;var h=0;if(e==f){if(b>d){h=b;b=d;d=h}var q=a[e];d++;if(q.fill)q.fill(c,b,d);else for(g=b;g<d;g++)q[g]=c}else if(b==d){if(e>f){h=e;e=f;f=h}f++;for(g=e;g<
f;g++)a[g][b]=c}else{var l=Math.abs(d-b);var k=Math.abs(f-e);var n=b;var x=e;var r=0;var p=0;var O=0;var m=0;var I=0;var Q=0;var J=0;var t=0;if(d>=b){r=1;p=1}else{r=-1;p=-1}if(f>=e){O=1;m=1}else{O=-1;m=-1}if(l>=k){r=0;m=0;Q=l;I=l/2|0;J=k;t=l}else{p=0;O=0;Q=k;I=k/2|0;J=l;t=k}if(t<1)return;t++;for(var z=0;z<t;z++){a[x][n]=c;I+=J;if(I>=Q){I-=Q;n+=r;x+=O}n+=p;x+=m}}}}function Tb(){var b="SI_"+Na();if(t.domain)b+=t.domain;if(t.user)b+=t.user;return b}function Uc(){if(!da&&"sessionStorage"in window&&!t.pwd){var b=
sessionStorage[Tb()];if(b){var e=JSON.parse(b);if(!("random"in e))return"";var f=e.random;for(var d=0;d<16;d++)f[d]=f[d]&255;svGlobal.logger.info("load session, id="+e.logId+" server="+Na());return"&logId="+e.logId+"&random="+encodeURIComponent(hi5.Base64.enc(f))}}return""}function pb(b){return b&~3}function Ub(){if(da){N=(t.waWidth||screen.width)|0;v=(t.waHeight||screen.height)|0;if(v<768&&screen.height>767)v=768}else{N=pb(N);v=pb(v)}if(t.minWidth&&N<t.minWidth)N=t.minWidth|0;if(t.minHeight&&v<t.minHeight)v=
t.minHeight|0;t.waWidth=t.waWidth||N;t.waHeight=t.waHeight||v}function qb(b,e){if(z)z.resize(b,e);else z=new Sb(b,e);return z}function Vb(b){var e=b>>8&248|b>>13&7;var f=b>>3&252|b>>9&3;var d=b<<3&248|b>>2&7;return 4278190080|d<<16|f<<8|e}function Vc(b){return 4278190080|qa[2][b]<<16|qa[1][b]<<8|qa[0][b]}function Wc(b){return 4278190080|b}function Ab(b,e,f,d,c,g){var a=0;var h=0;var k=0;var x=0;var n=0;var l=0;var q=0;var r=0;var p=0;var O=0;var m=e;for(var I=g;h<d;){g=I+f*d*4-(h+1)*f*4;l=0;O=g;a=
0;if(p==0)for(;a<f;){k=b[e++];n=k&15;x=k>>4&15;r=n<<4|x;if(r<=47&&r>=16){n=r;x=0}for(;x>0;){l=b[e++];c[g]=l;g+=4;a++;x--}for(;n>0;){c[g]=l;g+=4;a++;n--}}else for(;a<f;){k=b[e++];n=k&15;x=k>>4&15;r=n<<4|x;if(r<=47&&r>=16){n=r;x=0}for(;x>0;){q=b[e++];if((q&1)!=0){q=q>>1;q=q+1;l=-q}else{q=q>>1;l=q}q=c[p+a*4]+l;c[g]=q;g+=4;a++;x--}for(;n>0;){q=c[p+a*4]+l;c[g]=q;g+=4;a++;n--}}h++;p=O}return e-m}function Xc(b,e,f,d,c,g){var a=0;var h=0;var k=0;var x=0;var n=0;var l=0;var q=0;var r=0;var p=e;for(var O=g;h<
d;){g=O+f*d*4-(h+1)*f*4;r=g;a=0;if(q==0)for(;a<f;){k=b[e++];n=k&15;x=k>>4&15;l=n<<4|x;if(l<=47&&l>=16){n=l;x=0}for(;x>0;){e++;c[g]=255;g+=4;a++;x--}for(;n>0;){c[g]=255;g+=4;a++;n--}}else for(;a<f;){k=b[e++];n=k&15;x=k>>4&15;l=n<<4|x;if(l<=47&&l>=16){n=l;x=0}for(;x>0;){e++;c[g]=255;g+=4;a++;x--}for(;n>0;){c[g]=255;g+=4;a++;n--}}h++;q=r}return e-p}function Bb(b,e,f){if(!e)e=b.length;if(!f)f=0;var d=Math.floor(e/4);var c=ia(d);c[0]=0;var g=0;for(var a=0;a<d;a++){g=(a<<2)+f;c[a]=(b[g+3]&255)<<24|b[g+
2]&255|(b[g+1]&255)<<8|(b[g+0]&255)<<16}return c}function Cb(b,e,f,d,c,g){var a;var h;for(h=0;h<d;h++)for(a=0;a<f;a++)c[g+((d-h-1)*f+a)*4]=b[e+(h*f+a)]}function Yc(b,e,f,d,c){var g=d[c];var a=0;var h=c+1;var k=b*e;var x=ia(k*4);x[0]=0;var n=g&16;var l=g&32;if(ba)ba.begin("decodeInt32");if(l==0){a=Xc(d,h,b,e,x,3);h+=a}else{var q=0;for(var r=0;r<k;r++){q=r<<2;x[q+3]=255}}if(n!=0){a=Ab(d,h,b,e,x,2);h+=a;a=Ab(d,h,b,e,x,1);h+=a;a=Ab(d,h,b,e,x,0)}else{a=Cb(d,h,b,e,x,2);h+=k;a=Cb(d,h,b,e,x,1);h+=k;a=Cb(d,
h,b,e,x,0)}if(ba)ba.end("decodeInt32");return Bb(x)}function Wb(b,e,f,d,c){var g=-1;var a=-1;var h=c;var k=0;var x=h+f;var n=0;var l=0;var q=0;var r=b;var p=-1;var O=0;var m=0;var I=0;var J=0;var u=0;var D=0;var y=4294967295;var A=0;var Va=false;var t=false;var K=false;var C=ia(b*e);C[0]=0;if(ba)ba.begin("decodeInt16");for(;h<x;){O=0;m=d[h++];n=m>>4;switch(n){case 12:case 13:case 14:n-=6;l=m&15;q=16;break;case 15:n=m&15;if(n<9){l=d[h++];l|=d[h++]<<8}else l=n<11?8:1;q=0;break;default:n>>=1;l=m&31;
q=32}if(q!=0){K=n==2||n==7;if(l==0)if(K)l=d[h++]+1;else l=d[h++]+q;else if(K)l<<=3}switch(n){case 0:if(p==n&&!(r==b&&g==-1))Va=true;break;case 8:A=d[h++]|d[h++]<<8;I=4278190080|(A>>8&248|A>>13&7)|(A>>3&252|A>>9&3)<<8|(A<<3&248|A>>2&7)<<16;case 3:A=d[h++]|d[h++]<<8;J=4278190080|(A>>8&248|A>>13&7)|(A>>3&252|A>>9&3)<<8|(A<<3&248|A>>2&7)<<16;break;case 6:case 7:A=d[h++]|d[h++]<<8;y=4278190080|(A>>8&248|A>>13&7)|(A>>3&252|A>>9&3)<<8|(A<<3&248|A>>2&7)<<16;n-=5;break;case 9:D=3;n=2;O=3;break;case 10:D=5;
n=2;O=5}p=n;for(u=0;l>0;){if(r>=b){r=0;e--;g=a;a=k+e*b}switch(n){case 0:if(Va){if(g==-1)C[a+r]=y;else C[a+r]=C[g+r]^y|4278190080;Va=false;l--;r++}if(g==-1){for(;(l&~7)!=0&&r+8<b;)for(var F=0;F<8;F++){C[a+r]=4278190080;l--;r++}for(;l>0&&r<b;){C[a+r]=4278190080;l--;r++}}else{for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){C[a+r]=C[g+r];l--;r++}for(;l>0&&r<b;){C[a+r]=C[g+r];l--;r++}}break;case 1:if(g==-1){for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){C[a+r]=y;l--;r++}for(;l>0&&r<b;){C[a+r]=y;l--;r++}}else{for(;(l&
~7)!=0&&r+8<b;)for(F=0;F<8;F++){C[a+r]=C[g+r]^y|4278190080;l--;r++}for(;l>0&&r<b;){C[a+r]=C[g+r]^y|4278190080;l--;r++}}break;case 2:if(g==-1){for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){u<<=1;u=u&255;if(u==0){D=O!=0?O&255:d[h++];u=1}if((D&u)!=0)C[a+r]=y;else C[a+r]=4278190080;l--;r++}for(;l>0&&r<b;){u<<=1;u=u&255;if(u==0){D=O!=0?O&255:d[h++];u=1}if((D&u)!=0)C[a+r]=y;else C[a+r]=4278190080;l--;r++}}else{for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){u<<=1;u=u&255;if(u==0){D=O!=0?O&255:d[h++];u=1}if((D&u)!=0)C[a+
r]=C[g+r]^y|4278190080;else C[a+r]=C[g+r];l--;r++}for(;l>0&&r<b;){u<<=1;u=u&255;if(u==0){D=O!=0?O&255:d[h++];u=1}if((D&u)!=0)C[a+r]=C[g+r]^y|4278190080;else C[a+r]=C[g+r];l--;r++}}break;case 3:for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){C[a+r]=J;l--;r++}for(;l>0&&r<b;){C[a+r]=J;l--;r++}break;case 4:for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){A=d[h++]|d[h++]<<8;C[a+r]=4278190080|(A>>8&248|A>>13&7)|(A>>3&252|A>>9&3)<<8|(A<<3&248|A>>2&7)<<16;l--;r++}for(;l>0&&r<b;){A=d[h++]|d[h++]<<8;C[a+r]=4278190080|(A>>8&
248|A>>13&7)|(A>>3&252|A>>9&3)<<8|(A<<3&248|A>>2&7)<<16;l--;r++}break;case 8:for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){if(t){C[a+r]=J;t=false}else{C[a+r]=I;t=true;l++}l--;r++}for(;l>0&&r<b;){if(t){C[a+r]=J;t=false}else{C[a+r]=I;t=true;l++}l--;r++}break;case 13:for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){C[a+r]=4294967295;l--;r++}for(;l>0&&r<b;){C[a+r]=4294967295;l--;r++}break;case 14:for(;(l&~7)!=0&&r+8<b;)for(F=0;F<8;F++){C[a+r]=4278190080;l--;r++}for(;l>0&&r<b;){C[a+r]=4278190080;l--;r++}break;default:l--;
r++}}}if(ba)ba.end("decodeInt16");return C}function rb(b){switch(b){case 16:wa=Vb;cb=Wb;break;case 8:wa=Vc;break;case 32:wa=Wc;cb=Yc;break;default:if(!t.invitation)m.showMessage(b+" bit color is not supported anymore.");return false}Ha=b;Oa=(b+7)/8>>0;return true}function Db(b,e){N=b;v=e;ca=0,W=0,P=N-1,S=v-1;svGlobal.logger.warn("resolution changed, w:"+b+" h:"+e);if(m.onresolutionchange)m.onresolutionchange(b,e)}function H(b){Z.send(b)}function Zc(b){var e=b.substring(0,2);var f=b.substring(2);if(Aa&&
(e=="80"||e=="81"||e=="82"||e=="83")){var d=f.split("\t");var c=new Uint8Array(7);var g=0;var a=0;var h=0;a=parseInt(d[0]);h=parseInt(d[1]);var k=parseInt(e,16);switch(k){case 128:g=("0"==d[2]?4096:8192)|32768;break;case 129:g="0"==d[2]?4096:8192;break;case 130:g=2048;break;case 131:g="0"==d[2]?640|32768:896|32768}c[0]=1<<5;c[1]=g&255;c[2]=g>>8;c[3]=a&255;c[4]=a>>8;c[5]=h&255;c[6]=h>>8;Aa.add(new RecordingObj(c,0,7,60))}else;}function $c(b,e){if(e==1)return b;else if(e<1){console.error("rate must be smaller than the original rate");
return}var f=Math.round(b.length/e);var d=new Float32Array(f);var c=0;for(var g=0;c<d.length;){var a=Math.round((c+1)*e);var h=0;var k=0;for(var x=g;x<a&&x<b.length;x++){h+=b[x];k++}d[c]=h/k;c++;g=a}return d}function Xa(b,e,f,d,c,g){this.data=b;this.left=d;this.top=c;this.width=e;this.height=f;this.bitsperpixel=g;this.bytesperpixel=Math.floor((g+7)/8)}function Xb(){var b;var e=new Array(5);var f=new Array(5);f[0]=null;this.putBitmap=function(b,c,g){if(c==32767){if(f[b]){f[b].data=null;f[b]=null}f[b]=
g;return}var a=e[b];if(a){if(a[c]){a[c].data=null;a[c]=null}}else e[b]=a=new Array;a[c]=g};this.getBitmap=function(b,c){if(c==32767)return f[b];return e[b]?e[b][c]:null}}function Yb(b){var e=__svi18n.errorCode[b];if(!e)e="error "+b;if(m.onerror)m.onerror({name:b,message:e});if(m.displayMsg)hi5.notifications.notify({"msg":e});if(svGlobal.log>0&&console.error)console.error(e)}function zf(b){var e=__svi18n.info[b];if(!e)return;if(m.displayMsg)hi5.notifications.notify({"msg":e});svGlobal.logger.info(e)}
function ad(){this.xOrigin=0;this.yOrigin=0;this.style=0;this.pattern=new Array(8)}function bd(){this.left=0;this.right=0;this.top=0;this.bottom=0}function cd(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.offset=0;this.action=0}function dd(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0}function ed(b,e){this.size=b;this.data=e}function fd(b,e,f,d,c,g,a){this.font=b;this.character=e;this.offset=f;this.baseLine=d;this.width=c;this.height=g;this.fontData=a}function gd(){this.mixmode=
0;this.startX=0;this.startY=0;this.endX=0;this.endY=0;this.backgroundColor=0;this.opcode=0;this.pen=new hd}function id(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0;this.colorTable=0;this.cacheID=0;this.cacheIDX=0}function Af(b,e,f,d,c){this.bits=b;this.size=e;this.red=f;this.green=d;this.blue=c}function jd(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.backgroundColor=0;this.foregroundColor=0;this.brush=new ad}function hd(){this.style=0;this.width=0;this.color=
0}function kd(){this.x=0;this.y=0;this.flags=0;this.foregroundColor=0;this.lines=0;this.opcode=0;this.dataSize=0;this.data=new Array(256)}function ld(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.color=0}function md(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0}function nd(){this.flags=0;this.mixmode=0;this.foregroundColor=0;this.backgroundColor=0;this.x=0;this.y=0;this.unknown=0;this.font=0;this.clipLeft=0;this.clipTop=0;this.clipRight=0;this.clipBottom=0;this.boxLeft=
0;this.boxTop=0;this.boxRight=0;this.boxBottom=0;this.opcode=0;this.length=0;this.text=null;this.textPos=0}function Eb(){this.orderType=0;this.bounds=new bd;this.destBlt=new dd;this.patBlt=new jd;this.screenBlt=new md;this.line=new gd;this.rectangle=new ld;this.deskSave=new cd;this.memBlt=new id;this.polyLine=new kd;this.text2=new nd;this._line=new hi5.graphic.Line}function od(){function b(b,e,c,g,a,h){this.x=b;this.y=e;this.cx=c;this.cy=g;this.offset=a;this.data=h}var e=[];this.save=function(f,d,
c,g,a,h){var k=new b(f,d,c,g,a,h);var x=0;for(var n=e.length;x<n;x++)if(!e[x]){e[x]=k;return}e.push(k)};this.restore=function(b,d,c,g,a){var h;var k=0;for(var x=e.length;k<x;k++){h=e[k];if(h&&h.x==b&&h.y==d&&h.cx==c&&h.cy==g)if(h.offset==a){var n=h.data;e[k]=null;return n}else svGlobal.logger.warn("TODO: offset")}return null}}function Zb(){T=false;Ia=false;qa=null;$b();U=new Eb;Ja=0;Pa=new Array(256);Ka=new Xb;for(var b=0;b<12;b++)Ya[b]=new Array(256);sb=new Array(20);Ba.reset()}function pd(){return"&waWidth="+
t.waWidth+"&waHeight="+t.waHeight}function qd(b,e){function f(a){e(false,a.target.responseText)}function d(a){e(true)}var c=e?true:false;var g=new XMLHttpRequest;if(c){g.addEventListener("load",f);g.addEventListener("error",d);g.addEventListener("abort",d)}g.open("GET",b,c);g.setRequestHeader("Content-Type","text/plain;charset=UTF-8");g.send(null);return c?"":g.responseText}function rd(b){if(!db)return"";return qd(m.modifyURL(Ea()+"/CLIP?s="+db+"&t="+Date.now()),b)}function sd(){function b(b){if(!e(b))return false;
var d=b["ownerWinid"]<1||!a.mainWin;if(!d)return d;var f=b["style"];if((f&4194304)!=0)return true;var c=(b.extStyle&128)!=0;d=d&&!c;if(d&&((f&2147483648)!=0&&(f&2156396544)==0))d=false;return d}function e(a){return a.winWidth&&a.winHeight&&a.showState&&a.winHeight>45&&a.winWidth>45}function f(b){for(;b.ownerWinid>0;){var e=a.getWinById(b.ownerWinid);if(e&&e.isVisible())b=e;else break}return b}function d(b){var e="";for(var d=b;d;){if(d.titleInfo)e=d.titleInfo;d=a.getWinById(d.ownerWinid)}return e}
var c=[];var g=0;var a=this;this.mainWin=null;this.onchange=function(e){if(!e.isVisible()&&e==a.mainWin)a.mainWin=null;else if(e.isVisible()&&!a.mainWin)if(b(e)){a.mainWin=e;e.fillBrowser()}};this.addWin=function(e){var d=c.length;var f=false;for(var n=0;n<d;n++)if(e.id==c[n].id){c[n]=e;f=true;break}if(!f)c.push(e);if(c.length==1)g=Date.now();if(m.windowState>0){var l=b(e);svGlobal.logger.info("is main win:"+l+" id:"+e.id);if(l&&!a.mainWin){a.mainWin=e;if(m.windowState>0){e.fillBrowser();e.activate(1);
svGlobal.logger.info("Maximize:"+e.id);a.getOtherApps(w.zOrders,function(b){if(b.length>0&&m.onexistingapp)m.onexistingapp(b)},5E3)}}else if(m.windowState>0)e.checkBound()}};this.isMain=b;this.popWins=function(b){var e=a.getWinById(b);var d=[];if(e){b=e.ownerWinid>0?e.ownerWinid:e.id;var f=c.length;for(var g=f-1;g>=0;g--)if(c[g].ownerWinid==b||c[g].id==b){d.push(c[g]);c.splice(g,1)}}return d};this.hasApp=function(b){var a=0;for(var e=c.length;a<e;a++)if(c[a].appId==b)return true;return false};this.isNew=
function(){return Date.now()-g<3E4};this.getAll=function(){return c};this.hasWin=function(b){return c.indexOf(b)>=0};this.close=function(){var b=0;for(var a=c.length;b<a;b++)c[b].close()};this.clear=function(){c.length=0};this.delWin=function(b){var a=0;for(var e=c.length;a<e;a++)if(c[a].id==b){c.splice(a,1);return a}return-1};this.isRunning=function(){var b;var a=c.length;if(a<1)return false;var e=0;for(a=c.length;e<a;e++){b=c[e];if(b.isVisible())return true}return false};this.getWinById=function(b){var a;
var e=c.length;if(e<1)return null;for(var d=0;d<e;d++){a=c[d];if(a.id==b)return a}return null};this.getTopWin=function(b){var e=null;var d;var f=b.length;for(d=0;d<f;d++){e=a.getWinById(b[d]);if(e&&e.isVisible())break;else e=null}if(!e){svGlobal.logger.warn("No win found");f=c.length;for(d=f-1;d>=0;d--){e=c[d];if(e.isVisible())break;else e=null}}return e};this.getMain=function(b){var e=a.getTopWin(b);if(e)return f(e);return null};this.getOtherApps=function(b,e,g){var n=c.length;if(n==0||!c[n-1])return;
var l=c[n-1].appId;if(g||!l){setTimeout(function(){a.getOtherApps(b,e)},g||3E3);return}var q=[];var r=a.getTopWin(b);if(r){var p=r.ownerWinid>0?r.ownerWinid:r.id;var O=[];var m=0;for(n=c.length;m<n;m++){if(c[m].ownerWinid==p||c[m].id==p||!c[m].isVisible())continue;O.push(c[m])}for(m=0,n=O.length;m<n;m++){if(O[m].ownerWinid==p||O[m].id==p)continue;q.push({title:d(O[m]),win:f(O[m])});p=O[m].ownerWinid>0?O[m].ownerWinid:O[m].id}}e(q)}}function td(b){var e={};var f=0;var d=b;this.enabled=false;hi5.EventControl(this);
var c=this;var g=null;this.release=function(){c=null;b=null;d=null;e=null};this.read=function(a,d,g){function x(e){if(e.target.readyState==FileReader.DONE){var q=new Uint8Array(e.target.result);b.send(a,d,g,q);f+=g;c.fireEvent("progress",[f])}}var n=e[e[a]];if(typeof n=="undefined")return;var l=n.size;var q=n.name;if(l<1){m.showMessage(__svi18n.file.zero+q,null,3E3);return}var r=n.slice(d,d+g);var p=new FileReader;p.onloadend=x;p.readAsArrayBuffer(r)};this.mkdirs=function(a){if(!c.enabled)return;
if(a.charAt(a.length-1)!="/")a+="/";a=encodeURIComponent(a);b.start(a,0)};this.addFile=function(a,d){if(!c.enabled)return;if(!("slice"in a)){a.slice=a.webkitSlice||a.mozSlice;if(!("slice"in a)){m.showMessage(__svi18n.file.slice);return}}var f=d||a.name;if(m.beforeupload)if(m.beforeupload(a,d))return;c.fireEvent("beforeupload",[a,d]);f=encodeURIComponent(f);e[f]=a;b.start(f,a.size)};this.addFiles=function(b){if(!c.enabled)return;var e=0;for(var d=b.length;e<d;e++)c.addFile(b[e])};this.removeFile=function(b){d.remove(b)};
this.confirmId=function(b,d,c){e[b]=d;if(c)f+=parseInt(c)};this.close=function(b){if(b){var d=e[b];if(d){delete e[b];delete e[d];var g=decodeURIComponent(d);if(m.onfileuploaded)m.onfileuploaded(g);c.fireEvent("fileuploaded",[g])}for(var x in e)return}else e={};f=0;c.fireEvent("uploaded");if(m.onuploaded)m.onuploaded()};this.cancelAll=function(){d.cancelAll();if(m.onuploadingCancelled)m.onuploadingCancelled();c.fireEvent("uploadingCancelled");c.close()};this.list=function(b,e){g=e;d.list(b)};this.notifyFiles=
function(b){if(g)g(b);c.fireEvent("files")}}function ud(){function b(b,f){var d=f.length;var c=new Uint8Array(2+d*2);c[0]=58;c[1]=b;var g=0;var a=2;for(var h=0;h<d;h++){g=f.charCodeAt(h);c[a++]=g&255;c[a++]=g>>8&255}H(c.buffer)}this.start=function(b,f){var d=b.length;var c=new Uint8Array(10+d*2);c[0]=58;c[1]=0;c[2]=f&255;c[3]=f>>8&255;c[4]=f>>16&255;c[5]=f>>24&255;var g=0;var a=10;for(var h=0;h<d;h++){g=b.charCodeAt(h);c[a++]=g&255;c[a++]=g>>8&255}H(c.buffer)};this.send=function(b,f,d,c){var g=new Uint8Array(22+
d);g[0]=58;g[1]=3;var a=2;g[a++]=b&255;g[a++]=b>>8&255;g[a++]=b>>16&255;g[a++]=b>>24&255;g[a++]=f&255;g[a++]=f>>8&255;g[a++]=f>>16&255;g[a++]=f>>24&255;a+=4;g[a++]=d&255;g[a++]=d>>8&255;g[a++]=d>>16&255;g[a++]=d>>24&255;a+=4;g.set(c,a);H(g.buffer)};this.remove=function(e){b(6,e)};this.list=function(e){b(5,e)};this.cancelAll=function(){b(7,"")}}function ac(b){if(!ha)ha=new td(new ud);b.setFileHandler(ha)}function bc(b,e,f){var d=false;this.exe=b;this.args=e||"";this._dir=f||"";var c=this;this.close=
function(){if(!d&&T){d=true;H("8C5"+c.exe+"\t"+c.args+"\t"+m.sessionInfo.appInfo.session)}}}function Fb(b){var e=this;if(!b)b=143;this.send=function(f){var d=!!f.buffer;var c=d?f:f.getData();var g=b==64;var a=d?c.length:f.getEnd()||c.length;if(a<c.length)if(d)c=c.subarray(0,a);else c=c.slice(0,a);var h=g?5:9;var k=h+a;var x=new Uint8Array(k);x[0]=b;if(g){x[1]=e.id;x[2]=e.id>>8;x[3]=e.id>>16;x[4]=e.id>>24}else{var n=e.name;var l=Math.min(n.length,8);for(var q=0;q<l;q++)x[1+q]=n.charCodeAt(q)}x.set(c,
h);H(x.buffer)};this.name="";this.flags=0;this.id=0;this.count=0}function vd(){var b=window.opener;if(b)try{if(b.__sparkUser&&b.__sparkUser.session)return b.__sparkUser;else if(b.opener&&b.opener.__sparkUser.session)return b.opener.__sparkUser}catch(e){}return null}function cc(){function b(b){Aa=new RecordingManager;var a=b.user.length>0?b.server+"_"+b.user:b.server;var e={name:a,width:N,height:v,color:Ha,namesuffix:".rdpv",filetag:"RDPV",duration:0};Aa.setHeader(e)}if(T)return;Ia=false;if(Za)Z=Za;
else{var e=B+"&width="+N+"&height="+v+"&server_bpp="+Ha+"&audio="+ja.available+Uc();if(B.indexOf("waWidth")<0)e+=pd();var f=new Date;e+="&tzOffset="+f.getTimezoneOffset()+"&time="+f.getTime();var d="";var c="";var g="";for(g in $a){var a=$a[g];if("flags"in a){if(d){d+=",";c+=","}d+=a.name;c+=a.flags}}if(d){e+="&channelName="+d;e+="&channelFlags="+c}d="";for(g in ab){a=ab[g];if("flags"in a){if(d)d+=",";d+=a.name}}if(d)e+="&gwChannelName="+d;var h=vd();if(h){var k=h.account;var x=h.session;if(k)e+=
"&account="+k;if(x)e+="&session="+x}var n=hi5.browser.isTouch&&(window.innerWidth>=1024||window.innerHeight>=768);t.audioRecord=oa(t.audioRecord)&&hi5.audio.recordable;ma.init(n,!!t.remotefx,t.audioRecord);if(t.audioRecord)e+="&audioRecord=on";if(ma.count>0)e+="&dvcChannels="+ma.names.join(",");if(hi5.browser.binaryWS())e+="&binary=on";if(G.existingFile)e+="&existingFile="+G.existingFile;e+="&isTouch="+n+"&gatewayAddr="+encodeURIComponent(Ea());e=m.modifyURL(e);B=e;e=m.mode==0&&G.wsPost?B.substring(0,
B.indexOf("?"))+"?_METHOD=post":B;if(m.oncreatewebsocket)Z=m.oncreatewebsocket(e);else Z=new WebSocket(e,"rdp");if("binaryType"in Z)Z.binaryType="arraybuffer"}svGlobal.logger.info(B);Z.onopen=function(b){T=true;if(m.onopen)m.onopen();H("87"+navigator.userAgent);if(G.joinCloseMode)m.setJoinCloseMode(G.joinCloseMode)};if(t["recording"]!=undefined&&t["recording"]=="on")b(t);Z.onmessage=wd;Z.onclose=La;Z.onerror=xd;var l=w[w.length-1];if(l)if(da){if(l)l.remoteApp=new bc(t["exe"],t["args"],"")}else zb(Na(),
l.getWindow());if(t.invitation){var q=null;if(l)q=l.initChat(t.expert);eb=new m.GatewayChannel;eb.name="C_H_A_T";eb.process=function(b){var a=b.getUnicodeString(b.getEnd()-b.getPosition(),true);if(q)q.add(a,t.novice)};if(q)q.onchat=function(b){if(T){var a=new Array(b.length*2);var e=new hi5.DataBuffer(a,0,a.length);e.setUnicodeString(b);e.markEnd();eb.send(e)}};m.addGatewayChannel(eb)}}function xd(b){svGlobal.logger.warn(b)}function fb(b){var e=yd(b);ka.attach(e,0,e.length);return ka}function wd(b){var e;
var f=b.data;if(typeof f!="string"){var d=new Uint8Array(f);if(Aa!=null)Aa.add(new RecordingObj(d,0,f.byteLength,-1));ka.attach(d,0,f.byteLength);e=ka.getLittleEndian16();switch(e){case 28:dc(ka);break;case 48:ec(ka);break;case 49:fc(ka);break;case 55:zd(ka);break;case 60:gc(ka);break;case 62:hc(ka.getUnicodeString(ka.getEnd()-ka.getPosition(),false));break;case 63:ic(ka);break;case 64:Ad(ka);break;case 146:Bd(ka);break;default:if(m.onunknownmessage)m.onunknownmessage(e,ka);else svGlobal.logger.warn("@TODO:"+
e+"\n")}}else{e=parseInt(f.substring(0,2),16);var c=f.substring(2);switch(e){case 0:Cd();break;case 15:Dd(c);break;case 26:Ed(c);break;case 27:Fd(c);break;case 28:dc(fb(c));break;case 48:ec(fb(c));break;case 49:fc(fb(c));break;case 50:Gd(c);break;case 51:Hd(c);break;case 54:Id(c);break;case 55:Jd(c);break;case 56:Kd(c);break;case 57:Ld(c);break;case 58:Md(c);break;case 59:Nd(c);break;case 60:gc(fb(c));break;case 61:Od(c);break;case 62:hc(c);break;case 63:ic(fb(c));break;default:if(m.onunknownmessage)m.onunknownmessage(e,
c);else svGlobal.logger.warn("@TODO:"+f+"\n")}}ra.sendPing()}function Bd(b){var e=b.getByte();switch(e){case 1:ra.processPong(b)}}function dc(b){var e=b.getAscllString(8);var f=ab[e];if(f!=null)f.process(b);else svGlobal.logger.warn("Channel "+e+" not found")}function Cd(){var b=B.substring(B.indexOf("?")+1);H("00"+b);H("87"+navigator.userAgent)}function Ld(b){var e=b.split("\t");svGlobal.logger.debug(b);var f=w.getWinById(parseInt(e[0]));if(f){if(!w.hasApp(e[1])&&m.onremoteappstart)m.onremoteappstart({"id":e[1]});
f.appId=e[1]}}function Pd(b,e){var f=0;var d=false;this.width=b;this.interval=e;var c=this;var g=0;this.start=function(){if(d)return;d=true;f=setInterval(function(){var b=w.getFocused();if(b&&T){var e=b.getThumbnail(c.width);if(e&&e.length!=g){H("8E7"+e);g=e.length}}},c.interval)};this.stop=function(){clearInterval(f)}}function Qd(b,e){if(va&&(va.width!=b||va.interval!=e)){va.stop();va=null}if(!va)va=new Pd(b,e);va.start()}function jc(){if(va){va.stop();va=null}}function Dd(b){sa=true;tb=false;Gb=
false;gb=m.reconnectTimes;U=new Eb;if(G.pingInterval)ra.setInterval(G.pingInterval);if(m.onready)m.onready();var e="";for(e in $a){var f=$a[e];if(f&&f.onopen)f.onopen()}for(e in ab){f=ab[e];if(f&&f.onopen)f.onopen()}}function ic(b){var e=b.getAscllString(8);var f=$a[e];if(f&&f.process)f.process(b)}function Ad(b){var e=b.getByte();var f=b.getLittleEndian32();switch(e){case 1:var d=b.getAscllString();ma[d].id=f;svGlobal.logger.info("DVC create, name:"+d+" id:"+f);ma[f]=ma[d];if(ma[f].onopen)ma[f].onopen();
break;case 3:ma[f].process(b);break;case 4:if(ma[f]&&ma[f].onclose)ma[f].onclose();svGlobal.logger.info("close DVC, id:"+f)}}function hc(b){var e=parseInt(b.substring(0,1),16);var f;var d;var c=b.substring(1);var g=false;var a=m.sessionInfo.appInfo;switch(e){case 0:d=JSON.parse(c);Zb();T=true;var h=d.width;var k=d.height;if(h==N&&k==v)break;Db(h,k);w.setSize(h,k,da?"hidden":null);z=qb(h,k);break;case 1:Ma=m.reconnectOnResize;m.reconnectOnResize=false;d=JSON.parse(c);m.sessionInfo.joinedSessions.push(d.numericId);
if(m.onsessionjoin)g=m.onsessionjoin(d);if(g)break;m.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);m.sessionInfo.joinedSessions.removeElm(d.numericId);if(m.sessionInfo.joinedSessions.length==0)m.reconnectOnResize=Ma;if(m.onsessionexit)g=m.onsessionexit(d);if(g)break;m.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);if(a.joinMode!=d.mode){a.joinMode=d.mode;var x=hi5.$("joinSelect");
if(x)x.value=d.mode}if(a.hasControl)return;w.setReadOnly(false);f=hi5.$("requestControl");if(f)f.disabled=true;if(m.ongivecontrol)g=m.ongivecontrol();if(g)break;m.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:w.setReadOnly(true);a.hasControl=false;f=hi5.$("requestControl");if(f)f.disabled=false;if(m.ontakebackcontrol)g=m.ontakebackcontrol();if(g)break;m.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:var n=function(){m.refuseControl(d.numericId);this.destroy()};var l=function(){m.giveControl(d.numericId);
this.destroy();if(z.isPaused())m.pauseSession(m.sessionInfo.appInfo.numericId,false)};d=JSON.parse(c);if(m.onrequirecontrol)g=m.onrequirecontrol(d);if(g)break;var q=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);var r=__svi18n.info.recontrol;if(z.isPaused)r+="<br><br>"+(__svi18n.info.autoresume||"");hi5.notifications.notify({"title":q,"msg":r,"cbYes":l,"cbNo":n});break;case 6:w.execute("setTouchRemoting",[true]);break;case 7:d=JSON.parse(c);if(d.width&&d.height){m.reconnectOnResize=false;
z=qb(d.width,d.height);Db(d.width,d.height);w.setSize(d.width,d.height)}if(d.color){rb(d.color);svGlobal.logger.warn("Color depth changed to:"+d.color)}break;case 8:d=JSON.parse(c);Gb=true;if(m.onrequestcredential&&m.onrequestcredential(d,Qa.reconnect))return;if(m.onautherror&&m.onautherror(d))return;var p=w.getFocused();p.requestCredential(d,Qa.reconnect);break;case 9:d=JSON.parse(c);if(d.interval>0&&d.width>0)Qd(d.width,d.interval);else jc();break;case 11:var O=function(){m.allowJoin(d.numericId,
false);this.destroy()};var Q=function(){m.allowJoin(d.numericId,true);this.destroy()};d=JSON.parse(c);if(m.onrequirejoin)g=m.onrequirejoin(d);if(g)break;q=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({"title":q,"msg":__svi18n.info.reqjoin,"cbYes":Q,"cbNo":O})}}function Od(b){var e=JSON.parse(b);switch(e.type){case 0:Db(e.width,e.height);z=qb(N,v);rb(e.color);var f=e.server;if(f&&m)m.server=e.server;kc=e.length;var d=w.getFocused();da=e.isRail==true;if(d){d.setSize(N,
v,da?"hidden":null);d.setAutoScale(!da);if(f)zb(Na(),d.getWindow());f=e.keyboard;if(typeof f!="undefined"&&f==0)d.setUnicode(true);f=e.mapDisk;if(f){Hb=true;ac(d)}}if(m.onopened)m.onopened(e);break;case 1:var c=e.duration;if(m.onprogress)m.onprogress(c,kc);break;case 2:if(e.status==2){Zb();T=true}else{var g=e.status==0;if(g!=z.isPaused()){if(m.onsessionpause&&m.onsessionpause(g,e))break;z.pause(g);if(!g)z.repaint(0,0,z.width,z.height);if(e.warn)m.showMessage(g?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}}}
function gc(b){var e=b.getByte();switch(e){case 32:Rd(b)}}function Rd(b){if(z.isPaused())return;var e=b.getLittleEndian16();var f=b.getLittleEndian16();var d=b.getLittleEndian16();var c=w.getFocused();c.moveCursor(f,d,true)}function Nd(b){var e=hi5.Base64.dec(b,0);var f=new RdpBuffer(e,0,e.length);var d=f.getLittleEndian32();if(xa||!(d&16)){Hb=false;ha=null}else if(d&128)ha=null;if(d&64)m.showMessage(__svi18n.info.recording);w.execute("setFeature",[d])}function Kd(b){var e=JSON.parse(b);var f=e;db=
e.session;if(!f.server)f.server=Na();var d=hi5.$("joinSelect");if(d)d.value=f.joinMode;d=hi5.$("requestControl");if(d)d.disabled=f.hasControl;if(e.joined)w.execute("setAutoScale",[true]);else if(oa(t.connectif)){m.mode=0;m.reconnectOnResize=Ma;w.setSize(N,v)}var c=G.page&&G.page.join||"join.html";var g=Ea();c=g+"/"+c+"?id="+(e.joined||e.numericId);var a=e.webAddress;if(a&&a.length>0&&a.toLowerCase()!=g.toLowerCase()){var h=a.indexOf("://");m.protocol=a.substring(0,h)=="http"?"ws":"wss";m.gateway=
a;c+="&gateway="+encodeURIComponent(a)}c=m.modifyURL(c);f.joinLink=c;m.sessionInfo.appInfo=f;if("isApp"in f&&da!==f.isApp){da=f.isApp;Ub();w.setSize(N,v,da?"hidden":null);z=qb(N,v);if(!Ia)w.execute("setAutoScale",[true])}if(e.ver&&e.ver!=svGlobal.version)svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+e.ver);if(m.onsessionstart)m.onsessionstart(m.sessionInfo)}function Md(b){if(!ha)return;var e=parseInt(b.charAt(0),10);b=b.substring(1);if(e==5){ha.notifyFiles(JSON.parse(b));return}var f=
b.split("\t");switch(e){case 1:ha.confirmId(f[0],f[1],f[2]);break;case 2:ha.read(f[0],parseInt(f[1],10),parseInt(f[2],10));break;case 4:ha.close(f[0])}}function Jd(b){var e=parseInt(b.substring(0,1),16);var f=b.substring(1);switch(e){case 0:Sd(f);break;case 1:Td(f);break;case 2:lc();case 3:}}function zd(b){var e=b.getByte();switch(e){case 0:Ud(b);break;case 1:Vd(b);break;case 2:lc();case 3:}}function lc(){}function Td(b){function e(b){var a=0;b=b*k;for(n=0;n<k;n++)a|=(g[b+n]&255)<<n*8;if(a>l){a-=
r;a/=-q}else a/=l;return a}function f(b){return function(){H("8A"+b)}}if(!ja.available||z.isPaused())return;var d=b.indexOf("\t");var c=b.substring(0,d);var g=hi5.Base64.dec(b,d+1);var a=X.tag!=1;if(a){if(!bb)bb=new Rb;g=bb.decode(g,0,g.length)}var h=X.bitsPerSample;var k=h>>3;var x=Math.floor(g.length/k);var n=0;var l=Math.pow(2,h-1)-1;var q=-l-1;var r=Math.pow(2,h);var p=0;if(ja.supportAudioData){var m=new Array(x);m[0]=.1;for(p=0;p<x;p++)m[p]=e(p);var Q=Ra.add(m);setTimeout(f(c),Q-ja.delay*1E3);
return}var I=X.channels;var J=Math.floor(x/I);var u=ja.getBuffer(J);var D=u.getChannelData(0);var y=u.getChannelData(1);for(p=0;p<J;){var A=p*2;var t=e(A);if(I==1){D[p]=t;y[p]=t}else{D[p]=t;y[p]=e(A+1)}p++}Q=ja.playBuffer(u);setTimeout(f(c),(Q-ja.delay)*1E3)}function Vd(b){function e(b){return function(){if(T)H("8A"+b)}}if(!ja.available||z.isPaused())return;var f=b.getByte()+","+b.getLittleEndian16()+","+b.getLittleEndian64();var d=b.getPosition();var c=b.getData();var g=b.getEnd()-d;if(X.tag==41222){var a=
hi5.audio.getAudioContext();if(a)a.decodeAudioData(c.buffer.slice(d),function(b){var a=ja.playBuffer(b);if(!xa)setTimeout(e(f),(a-ja.delay)*1E3)},function(b){svGlobal.logger.warn(b)});return}var h=X.tag!=1;if(h){if(!bb)bb=new Rb;c=bb.decode(c,d,g);d=0;g=c.length}var k=X.bitsPerSample;var x=k>>3;var n=Math.floor(g/x);var l=0;var q=0;var r=0;if(!h){l=Math.pow(2,k-1)-1;q=-l-1;r=Math.pow(2,k)}var p=d;var m=0;var Q=0;if(ja.supportAudioData){var I=new Array(n);I[0]=.1;if(h)for(m=0;m<n;m++)I[m]=c[p++];else for(m=
0;m<n;m++){Q=c[p++]|c[p++]<<8;if(Q>l){Q-=r;Q/=-q}else Q/=l;I[m]=Q}var J=Ra.add(I);setTimeout(e(f),J-ja.delay*1E3);return}var u=X.channels;var D=Math.floor(n/u);var y=ja.getBuffer(D);var A=y.getChannelData(0);var t=y.getChannelData(1);m=0;if(h)for(;m<D;){if(u==1)t[m]=A[m]=c[p++];else{A[m]=c[p++];t[m]=c[p++]}m++}else for(;m<D;){Q=c[p++]|c[p++]<<8;if(Q>l){Q-=r;Q/=-q}else Q/=l;if(u==1){A[m]=Q;t[m]=Q}else{A[m]=Q;Q=c[p++]|c[p++]<<8;if(Q>l){Q-=r;Q/=-q}else Q/=l;t[m]=Q}m++}J=ja.playBuffer(y);if(!xa)setTimeout(e(f),
(J-ja.delay)*1E3)}function Sd(b){var e=b.split("\t");X.tag=parseInt(e[0],10);X.channels=parseInt(e[1],10);X.bitsPerSample=parseInt(e[2],10);X.samplePerSec=parseInt(e[3],10);svGlobal.logger.debug("Audio Format, tag="+X.tag+" channels="+X.channels+" bitsPerSample="+X.bitsPerSample+" samplePerSec="+X.samplePerSec);if(ja.supportAudioData)if(!Ra)Ra=new mc(m.audioBuffer)}function Ud(b){X.tag=b.getLittleEndian16();X.channels=b.getLittleEndian16();X.samplePerSec=b.getLittleEndian32();b.skipPosition(6);X.bitsPerSample=
b.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+X.tag+" channels="+X.channels+" bitsPerSample="+X.bitsPerSample+" samplePerSec="+X.samplePerSec);if(ja.supportAudioData)Ra=new mc(m.audioBuffer)}function mc(b){function e(a){var e=a.length;var d=e>h.size();if(c||d){h.stop();setTimeout(function(){h.start()},b*1E3);return}for(var f=0;f<e;f++)a[f]=h.pull()}var f=new Array;var d;var c;var g;var a=new Wd(X.channels,X.samplePerSec,e);var h=this;this.delay=b;this.reset=function(){f.length=0;
d=0;c=true;a.stop();g=0};this.reset();this.start=function(){if(!c)return;a.start();c=false};this.stop=function(){a.stop();c=true};this.size=function(){var b=f.length;var a=0;for(var e=0;e<b;e++)a+=f[e].length;return a};this.add=function(e){var d=Date.now();if(g<d)g=d;var c=e.length/(X.samplePerSec*X.channels)*1E3;g+=c;var h=f.length;f[h]=e;if(h==0){d=Date.now();setTimeout(function(){a.start()},b*1E3)}return g-d};this.pull=function(){if(f.length==0)return null;var b=f[0];if(d<b.length)return b[d++];
f.shift();d=0;return this.pull()}}function Wd(b,e,f){function d(){var b;if(h){b=c.mozWriteAudio(h.subarray(k));g+=b;k+=b;if(k<h.length)return;h=null}var e=c.mozCurrentSampleOffset();var d=e+a-g;if(d>0){var x=new Float32Array(d);f(x);b=c.mozWriteAudio(x);if(b<x.length){h=x;k=b}g+=b}}var c=new Audio;c.mozSetup(b,e);var g=0;var a=b*Math.floor(e/2);var h=null;var k=0;var x=null;this.start=function(){x=setInterval(d,100)};this.stop=function(){if(!x)return;clearInterval(x)}}function Xd(b){var e=null;this.available=
false;this.delay=b;this.supportWebAudio=false;this.supportAudioData=false;if(t.playSound==0||m.mode>0){e=hi5.audio.getAudioContext();if(e){this.available=true;this.supportWebAudio=true}else if("AudioDataDestination"in window){this.supportAudioData=true;this.available=true}}this.getBuffer=function(b){return e.createBuffer(2,b,X.samplePerSec)};var f=0;var d=null;this.setVolume=function(b){if(b==1)d=null;else{if(!d)d=e.createGain();d.gain.value=b}};this.playBuffer=function(c){var g=e.createBufferSource();
g.buffer=c;if(d){g.connect(d);d.connect(e.destination)}else g.connect(e.destination);var a=e.currentTime;var h=f>0?f:a+b;if(h<a)h=a;f=h+c.duration;if(g.start)g.start(h);else g.noteOn(h);return f-a};this.iOSFix=function(){if(e&&hi5.browser.isTouch&&hi5.browser.isSafari){var b=this.getBuffer(1024);var d=e.createBufferSource();d.buffer=b;d.connect(e.destination);if(d.start)d.start(0);else d.noteOn(0)}};this.close=function(){e=null}}function Id(b){var e=b.split("\t");b=Ea()+e[0];b=m.modifyURL(b);svGlobal.logger.info("Downloading file:"+
b+" name:"+e[1]+" driver:"+e[2]);if(m.onprintingready)if(m.onprintingready({"link":b,"printerName":e[1],"pinterDriver":e[2]}))return;var f=w.getFocused();if(f)f.showPDF(b)}function Hd(b){w.setReadOnly(b=="1")}function Gd(b){var e=parseInt(b.substring(0,1),10);b=b.substring(1);switch(e){case 1:Yd(b);break;case 2:Zd(b);break;case 5:$d(b)}}function $d(b){var e=w.getFocused();if(e&&b!="0")e.setIgnorePaste(true)}function Zd(b){var e=w.getFocused();if(e)if(!e.processClipReq(b))if((G.clipWarnAlways||!nc)&&
t&&!t["leagacyMode"]){m.showMessage(__svi18n.info.menucopy,null,5E3);nc=true}}function ae(b){if(!m.openLink||b.length>2E3)return false;var e=b.indexOf(";");if(e>0)b=b.substring(e+1);var f=b;b=b.toLowerCase();var d=b.indexOf("http://")==0||b.indexOf("https://")==0||b.indexOf("ftp://")==0||b.indexOf("mailto:")==0||b.indexOf("tel:")==0||b.indexOf("callto:")==0;if(!d)if(b.indexOf("www.")==0){d=true;b="http://"+b}else if(b.indexOf("ftp.")==0){d=true;b="ftp://"+b}if(d){if(b.indexOf("\r")>0||b.indexOf("\n")>
0)return false;if(m.onurlredirection&&m.onurlredirection(d))return true;var c=w.getFocused();if(!c)return false;c.processLink(f);return true}return false}function Yd(b){if(m.onservercopy&&m.onservercopy(b))return;if(!ae(b))w.copyToClip(b);setTimeout(function(){H("883")},999)}function ec(b){var e=b.getLittleEndian16();var f=b.getByte();var d=b.getByte();var c=b.getLittleEndian16();var g=null;if((d&32)!=0){c-=18;var a=Ba.dec(b.getData(),b.getPosition(),c,d);g=Ba.getData()}else g=b;switch(f){case 2:be(g);
break;case 20:break;case 31:break;case 27:ce(g);break;case 34:break;case 38:de(g);break;case 40:Qa.sendKeyboardSynchronize(oa(t.scrollLock),oa(t.numLock),oa(t.capsLock));break;case 47:ee(g);break;case 50:g.skipPosition(4);break;case 54:fe(g);break;case 55:break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+f)}}function fe(b){var e=b.getLittleEndian32().toString(16).toUpperCase();var f=__svi18n.serverStatus[e];if(m.displayMsg)svGlobal.logger.info(f)}function be(b){var e=b.getLittleEndian16();
switch(e){case 0:b.skipPosition(2);var f=b.getLittleEndian16();b.skipPosition(2);oc(b,f);break;case 1:pc(b);break;case 2:qc(b);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+e)}}function ce(b){var e=0;var f=0;var d=0;e=b.getLittleEndian16();b.skipPosition(2);switch(e){case 3:f=b.getLittleEndian16();d=b.getLittleEndian16();if(z.isPaused())break;w.getFocused().moveCursor(f,d,true);break;case 6:rc(b);break;case 7:sc(b);break;case 1:ge(b);break;case 8:tc(b);default:}}function ge(b){var e=
b.getLittleEndian16();switch(e){case 0:uc();break;default:svGlobal.logger.warn("XXX system pointer message "+e)}}function he(b,e){var f;var d;var c=m.sessionInfo;switch(e){case 0:b.skipPosition(4);c.domain=b.getUnicodeString(52,true);b.skipPosition(4);c.userName=b.getUnicodeString(512,true);c.sessionId=b.getLittleEndian32();break;case 1:c.version=b.getLittleEndian16();b.skipPosition(4);c.sessionId=b.getLittleEndian32();f=b.getLittleEndian32();d=b.getLittleEndian32();b.skipPosition(558);c.domain=b.getUnicodeString(f,
true);c.userName=b.getUnicodeString(d,true);case 2:}return c}function vc(){if(!Ia){setTimeout(function(){if(T)H("884")},999);if(m.onloggedin)m.onloggedin()}Ia=true;if(da)w.execute("setAutoScale",[false]);if(ha)ha.enabled=true;if(ub&&!da){z.setContext(w.getFocused().context);z.repaint(0,0,z.width,z.height)}}function de(b){var e=b.getLittleEndian32();if(e<3){he(b,e);vc();return}if(e!=3)return;b.skipPosition(2);var f=b.getLittleEndian32();b.skipPosition(4);if(f==2)return;var d=b.getLittleEndian32();
b.skipPosition(4);var c=new Object;c.logId=b.getLittleEndian32();c.time=Date.now();m.sessionInfo.sessionId=c.logId;vc();var g=b.getBytes(16);var a=new Array(16);for(var h=0;h<16;h++)a[h]=g[h]&255;c.random=a;var k="8D"+c.logId+"\t"+hi5.Base64.enc(a);if(m.sessionInfo.userName){k+="\t"+m.sessionInfo.userName;if(m.sessionInfo.domain)k+="\t"+m.sessionInfo.domain}if(!xa)H(k);if("sessionStorage"in window)setTimeout(function(){sessionStorage[Tb()]=JSON.stringify(c)},300)}function ee(b){tb=true;var e=b.getLittleEndian32();
if(!xa)H("85"+e);svGlobal.logger.info("Disconnect:"+e);var f=e==11&&da;if(f)w.close();var d=e<1||f;if(d)return;Yb(e.toString(16).toUpperCase())}function ie(){var b=0;var e=0;var f=[0];var d=new RdpBuffer(f,0,0);this.addFragement=function(d,g){Ga(d.getData(),d.getPosition(),f,e,g);e+=g;b+=g};this.clearFragements=function(){d.setPosition(0);d.markEnd(b);b=0;e=0;return d}}function fc(b){var e=b.getByte();var f=e&15;var d=e>>4&3;var c=e>>6&3;var g;var a=0;if(c==2)a=b.getByte();g=b.getLittleEndian16();
var h=null;if((a&32)!=0){var k=Ba.dec(b.getData(),b.getPosition(),g,a);h=Ba.getData();g=Ba.getDecompressedLength()}else h=b;if(d!=0)switch(d){case 2:case 3:vb.addFragement(h,g);return;case 1:vb.addFragement(h,g);h=vb.clearFragements()}if(ba)ba.begin("decodeFastPath");switch(f){case 0:var x=h.getLittleEndian16();oc(h,x);break;case 1:h.skipPosition(2);pc(h);break;case 2:h.skipPosition(2);qc(h);break;case 3:break;case 4:je(h);break;case 5:uc(h);break;case 6:break;case 8:break;case 9:rc(h);break;case 10:sc(h);
break;case 11:tc(h);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+f)}if(ba)ba.end("decodeFastPath")}function je(b){var e=b.getEnd();var f;var d;var c;for(var g;b.getPosition()<e;){var a=b.getLittleEndian16();switch(a){case 1:case 6:f=b.getLittleEndian16();d=b.getLittleEndian16();c=b.getLittleEndian16();g=b.getBigEndian16();ke(b,f,d,c,g);break;case 4:le(b);break;default:svGlobal.logger.warn("Invalid surface cmd:"+a)}}}function le(b){var e=b.getLittleEndian16();var f=b.getLittleEndian32();if(e==
1)H("91"+f)}function wb(b,e,f,d,c,g){var a;var h=d*g;for(var k=0;k<c;k++){a=e+(c-k-1)*h;Ga(b,a,f,k*h,h)}}function me(){var b=ia(10240);var e=0;var f=na(10240);var d=0;var c=na(10240);var g=0;var a=na(10240);var h=0;var k=na(0);var x=0;this.getData=function(){return b};this.getDataSize=function(){return e};this.resetData=function(a){if(b.length<a)b=ia(a);e=a;return b};this.resetLumaPlane=function(b){if(f.length<b)f=na(b);d=b;return f};this.getLumaPlanceSize=function(){return d};this.resetOrangeChromaPlane=
function(b){if(c.length<b)c=na(b);g=b;return c};this.getOrangeChromaPlane=function(){return g};this.resetGreenChromaPlane=function(b){if(a.length<b)a=na(b);h=b;return a};this.getGreenChromaPlane=function(){return h};this.resetAlphaPlane=function(b){if(k.length<b)k=na(b);x=b;return k};this.getAlphaPlane=function(){return x}}function ne(){function b(b,e,a,f,k,x,n,l,q){var r=0;var p=0;var m=0;var Q=0;var I=0;var J=0;var u=0;var D=0;var y=0;var A=0;var t=0;var z=0;var K=d(k,8);var C=n-1;for(p=0;p<x;p++){if(l>
0){m=p*K;Q=(p>>1)*(K>>1);I=(p>>1)*(K>>1)}else{m=p*k;Q=p*k;I=p*k}for(r=0;r<k;r++){J=b[m]&255;u=(e[Q]&255)<<C<<24>>24;D=a[I]<<C<<24>>24;y=J+u-D;A=J+D;t=J-u-D;t=t<0?0:t>255?255:t;A=A<0?0:A>255?255:A;y=y<0?0:y>255?255:y;q[z++]=4278190080|t<<16|A<<8|y;m++;Q+=l>0?r%2:1;I+=l>0?r%2:1}}}function e(b,e,a,d,k){if(a==0)ta(d,0,k,255);else if(a<k)f(b,e,d,k);else Ga(b,e,d,0,k)}function f(b,e,a,d){var f=0;var x=0;var n=0;x=d;for(var l=0;x>4;){n=b[e++];if(x==5){a[l++]=n;x--}else if(n==b[e]){e++;if((b[e]&255)<255){f=
b[e++]&255;f+=2}else{e++;f=(b[e+3]&255)<<24|(b[e+2]&255)<<16|(b[e+1]&255)<<8|b[e]&255;e+=4}ta(a,l,l+f,n);l+=f;x-=f}else{a[l++]=n;x--}}for(var q=0;q<4;q++)a[l++]=b[e++]}function d(b,e){return b+(~(b&e-1)+1&e-1)}this.process=function(f,g,a,h,k){var x=f.getLittleEndian32();var n=f.getLittleEndian32();var l=f.getLittleEndian32();f.skipPosition(4);var q=f.getByte();var r=f.getByte();f.skipPosition(2);var p=f.getData();var m=f.getPosition();var Q=a*h;var I=Q*4;var J=k.resetData(Q);var u=d(a,8);var D=d(h,
2);I=u*D;var y=k.resetLumaPlane(I);var A=k.resetOrangeChromaPlane(I);var t=k.resetGreenChromaPlane(I);var z=a*h;var K=r>0?u*h:z;var C=r>0?(u>>1)*(D>>1):z;var F=r>0?C:z;e(p,m,x,y,K);m+=x;e(p,m,n,A,C);m+=n;e(p,m,l,t,F);m+=l;b(y,A,t,null,a,h,q,r,J);f.skipPosition(x+n+l)}}function wc(b,e,f){var d=b;var c=f;var g=0;var a=8;var h=e;this.attach=function(b,e,f){d=b;c=f;g=0;a=8;h=e};this.getBits=function(b){var e=b;var f=0;for(var l=0;g<c&&e>0;){f=e;if(f>a)f=a;if(l!=0)l<<=f;l|=d[g+h]>>a-f&(1<<f)-1;a-=f;e-=
f;if(a==0){a=8;g++}}return l};this.putBits=function(b,e){var f=b;var l=e;for(var q=0;g<c&&l>0;){q=l;if(q>a)q=a;d[g+h]|=(f>>l-q&(1<<q)-1)<<a-q;a-=q;l-=q;if(a==0){a=8;g++}}};this.eos=function(){return g>c};this.left=function(){return g>=c?0:(c-g-1)*8+a};this.getProcessBytes=function(){return a<8?g+1:g}}function xc(){this.quantIdxY=0;this.quantIdxCb=0;this.quantIdxCr=0;this.YLen=0;this.CbLen=0;this.CrLen=0;this.x=0;this.y=0;this.data=ia(4096);this.data[0]=0|0;var b=this;this.readHeaderfromStream=function(e){e.skipPosition(6);
b.quantIdxY=e.getByte();b.quantIdxCb=e.getByte();b.quantIdxCr=e.getByte();b.x=e.getLittleEndian16()*64;b.y=e.getLittleEndian16()*64;b.YLen=e.getLittleEndian16();b.CbLen=e.getLittleEndian16();b.CrLen=e.getLittleEndian16()}}function oe(){function b(b,a,e,d){for(var f=0;f<4096;f++)d[f]=4278190080|e[f]<<16|a[f]<<8|b[f]}function e(b,a,e){var d=0;var f=0;var c=0;var g=0;var h=0;var k=0;var m=0;for(m=0;m<4096;m++){d=b[m];f=a[m];c=e[m];d=d+4096<<16;g=d+c*91947;h=d-f*22544-c*46792;k=d+f*115998;g=g>>21;h=h>>
21;k=k>>21;b[m]=g<0?0:g>255?255:g;a[m]=h<0?0:h>255?255:h;e[m]=k<0?0:k>255?255:k}}function f(b,a,e,f,c,p,m){k(b.et,f,c,p,m,4096,b.bitStream);h(m,4032,64);g(m,a);d(m,b.dwtBuffer)}function d(b,a){c(b,3840,a,8);c(b,3072,a,16);c(b,0,a,32)}function c(b,a,e,d){var f=0;var c=0;var g=0;var h=0;var k=0;var m=0;var u=0;var D=0;var y=0;var A=0;var t=0;var z=0;var K=0;A=d<<1;y=a+d*d*3;m=a;h=0;u=a+d*d;D=a+d*d*2;k=d*d*2;for(z=0;z<d;z++){e[h]=b[y]-(b[m]+b[m]+1>>1)<<16>>16;e[k]=b[u]-(b[D]+b[D]+1>>1)<<16>>16;for(K=
1;K<d;K++){t=K<<1;e[h+t]=b[y+K]-(b[m+K-1]+b[m+K]+1>>1)<<16>>16;e[k+t]=b[u+K]-(b[D+K-1]+b[D+K]+1>>1)<<16>>16}for(K=0;K<d-1;K++){t=K<<1;e[h+t+1]=(b[m+K]<<1)+(e[h+t]+e[h+t+2]>>1)<<16>>16;e[k+t+1]=(b[D+K]<<1)+(e[k+t]+e[k+t+2]>>1)<<16>>16}t=K<<1;e[h+t+1]=(b[m+K]<<1)+e[h+t]<<16>>16;e[k+t+1]=(b[D+K]<<1)+e[k+t]<<16>>16;y+=d;m+=d;h+=A;u+=d;D+=d;k+=A}for(t=0;t<A;t++){for(K=0;K<d;K++){z=K<<1;f=a+z*A+t;c=K*A+t;g=c+d*A;b[f]=e[c]-((K>0?e[g-A]:e[g])+e[g]+1>>1)<<16>>16}for(K=0;K<d;K++){z=K<<1;f=a+z*A+t;c=K*A+t;g=
c+d*A;b[f+A]=(e[g]<<1)+(b[f]+b[f+(K<d-1?2*A:0)]>>1)<<16>>16}}}function g(b,e){a(b,0,4096,5);a(b,0,1024,e[8]-6);a(b,1024,1024,e[7]-6);a(b,2048,1024,e[9]-6);a(b,3072,256,e[5]-6);a(b,3328,256,e[4]-6);a(b,3584,256,e[6]-6);a(b,3840,64,e[2]-6);a(b,3904,64,e[1]-6);a(b,3968,64,e[3]-6);a(b,4032,64,e[0]-6)}function a(b,e,a,d){if(d==0)return;for(var f=e;a>0;f++,a--)b[f]<<=d}function h(b,e,a){var d;var f;for(d=e,f=e+1;a>1;d++,f++,a--)b[f]+=b[d]}function k(b,e,a,d,f,c,g){var h=1;var k=h<<3;var m=1;var u=m<<3;
var t=0;var y=f;var A=0;var z=0;var B=0;if(g==null)g=new wc(e,a,d);else g.attach(e,a,d);for(;!g.eos()&&c>0;){var K;if(h!=0){var C;for(var F;!g.eos();){t=g.getBits(1);if(t!=0)break;var Y=1<<h;var w=Y;if(w>c)w=c;if(w>0){ta(y,A,A+w,0);A+=w}c-=Y;k+=4;if(k>80)k=80;if(k<0)k=0;h=k>>3}K=g.getBits(h);Y=K;w=Y;if(w>c)w=c;if(w>0){ta(y,A,A+w,0);A+=w}c-=Y;F=g.getBits(1);z=0;B=0;do{t=g.getBits(1);if(t==1)z++;else break}while(true);B=g.getBits(m);B|=z<<m;if(z==0){u+=-2;if(u>80)u=80;if(u<0)u=0;m=u>>3}else if(z!=1){u+=
z;if(u>80)u=80;if(u<0)u=0;m=u>>3}C=B+1;if(c>0)y[A++]=F!=0?-C:C;c--;k+=-6;if(k>80)k=80;if(k<0)k=0;h=k>>3}else{var fa;var za;var Fa;z=0;B=0;do{t=g.getBits(1);if(t==1)z++;else break}while(true);B=g.getBits(m);B|=z<<m;if(z==0){u+=-2;if(u>80)u=80;if(u<0)u=0;m=u>>3}else if(z!=1){u+=z;if(u>80)u=80;if(u<0)u=0;m=u>>3}C=B;if(b!=1){var nb=C;for(fa=0;nb!=0;){nb>>=1;fa++}za=g.getBits(fa);Fa=C-za;if(za!=0&&Fa!=0){k+=-2*3;if(k>80)k=80;if(k<0)k=0;h=k>>3}else if(za==0&&Fa==0){k+=2*3;if(k>80)k=80;if(k<0)k=0;h=k>>3}if(c>
0)y[A++]=(za&1)!=0?-1*(za+1>>1):za>>1;c--;if(c>0)y[A++]=(Fa&1)!=0?-1*(Fa+1>>1):Fa>>1;c--}else if(C==0){if(c>0)y[A++]=0;c--;k+=3;if(k>80)k=80;if(k<0)k=0;h=k>>3}else{if(c>0)y[A++]=(C&1)!=0?-1*(C+1>>1):C>>1;c--;k+=-3;if(k>80)k=80;if(k<0)k=0;h=k>>3}}}return A}this.decodeRgb=function(a,d,c,g,h,k,m,t,I,z){f(a,c,h,d.getData(),d.getPosition(),g,a.yrBuffer);d.skipPosition(g);f(a,c,m,d.getData(),d.getPosition(),k,a.cbgBuffer);d.skipPosition(k);f(a,c,I,d.getData(),d.getPosition(),t,a.crbBuffer);d.skipPosition(t);
e(a.yrBuffer,a.cbgBuffer,a.crbBuffer);b(a.yrBuffer,a.cbgBuffer,a.crbBuffer,z)}}function pe(){var b=[new ob];var e=[new xc];var f=0;var d=0;this.resetRects=function(e){if(b.length<e){var d=b.length;b.length=e;for(var a=d;a<e;a++)b[a]=new ob}f=e;return b};this.resetTiles=function(b){if(e.length<b){var f=e.length;e.length=b;for(var a=f;a<b;a++)e[a]=new xc}d=b;return e};this.getRectSize=function(){return f};this.getTileSize=function(){return d};this.getRects=function(){return b};this.getTiles=function(){return e}}
function qe(){this.ctxId=0;this.tileSize=64;this.flags=0;this.cct=0;this.xft=0;this.et=0;this.qt=0;this.yrBuffer=ea(4096);this.yrBuffer[0]=0|0;this.cbgBuffer=ea(4096);this.cbgBuffer[0]=0|0;this.crbBuffer=ea(4096);this.crbBuffer[0]=0|0;this.dwtBuffer=ea(32*32*2*2);this.dwtBuffer[0]=0|0;var b=this;this.setProperties=function(e){b.flags=e&7;b.cct=e>>3&3;b.xft=e>>5&15;b.et=e>>9&15};this.bitStream=new wc}function re(){function b(b,e){b.skipPosition(6);var a=b.getLittleEndian16();e.cct=a>>>4&3;e.xft=a>>>
6&15;e.et=a>>>10&15;e.qt=a>>>14&3;var d=b.getByte();b.skipPosition(1);var f=b.getLittleEndian16();b.skipPosition(4);var c=new Array(d*10);var g=0;var h;var n;for(n=0;n<d;n++){h=b.getByte();c[g++]=h&15;c[g++]=h>>>4;h=b.getByte();c[g++]=h&15;c[g++]=h>>>4;h=b.getByte();c[g++]=h&15;c[g++]=h>>>4;h=b.getByte();c[g++]=h&15;c[g++]=h>>>4;h=b.getByte();c[g++]=h&15;c[g++]=h>>>4}var m=k.resetTiles(f);for(n=0;n<f;n++){var x=m[n];x.readHeaderfromStream(b);l(e,b,c,x.YLen,x.quantIdxY*10,x.CbLen,x.quantIdxCb*10,x.CrLen,
x.quantIdxCr*10,x.data)}}function e(b){b.skipPosition(2);b.skipPosition(1);var e=b.getLittleEndian16();var a=k.resetRects(e);for(var d=0;d<e;d++){var f=a[d];f.x=b.getLittleEndian16();f.y=b.getLittleEndian16();f.width=b.getLittleEndian16();f.height=b.getLittleEndian16()}b.skipPosition(4)}function f(b){b.skipPosition(2)}function d(b){b.skipPosition(10)}function c(b){b.skipPosition(2);n.ctxId=b.getByte();n.tileSize=b.getLittleEndian16();n.setProperties(b.getLittleEndian16())}function g(b){var e=b.getByte();
for(var a=0;a<e;a++){var d=b.getByte();var f=b.getLittleEndian16();var c=b.getLittleEndian16();svGlobal.logger.info("Channel, id:"+d+" width:"+f+" height:"+c)}}function a(b){b.skipPosition(4)}function h(b){var e=b.getLittleEndian32();var a=b.getLittleEndian16()}var k=new pe;var m=new oe;var n=new qe;this.decode=function(l,m){var p=0;var x=0;var t=0;for(var z=l.getPosition()+m;l.getPosition()<z;){p=l.getLittleEndian16();x=l.getLittleEndian32();if(x==0)break;t=l.getPosition()-6+x;switch(p){case 52416:h(l);
break;case 52417:a(l);break;case 52418:g(l);break;case 52419:c(l);break;case 52420:d(l);break;case 52421:f(l);break;case 52422:e(l);break;case 52423:b(l,n);break;default:svGlobal.logger.warn("unknown blockType 0x%X"+p)}l.setPosition(t)}return k};var l=m.decodeRgb;this.getResult=function(){return k}}function ke(b,e,f,d,c){var g=b.getByte();b.skipPosition(2);var a=b.getByte();var h=b.getLittleEndian16();var k=b.getLittleEndian16();var m=b.getLittleEndian32();var n;var l=b.getPosition()+m;switch(a){case 0:var q=
Bb(b.getData(),m,b.getPosition());n=ia(q.length);wb(q,0,n,h,k,1);z.setRGBs(e,f,h,k,n,0,h);z.postPaint(e,f,h,k);break;case 1:Ib(b,g,h,k,Sa);var r=Sa.getData();var p=Sa.getDataSize();n=ia(p);wb(r,0,n,h,k,1);z.setRGBs(e,f,h,k,n,0,h);z.postPaint(e,f,h,k);break;case 3:var t=yc.decode(b,m);var Q=t.getRects();var I=t.getTiles();var J=t.getTileSize();var u=t.getRectSize();var D=u?new ob(0,0,0,0):null;var y=0;for(var A=0;A<J;A++){var B=I[A];if(u)for(var w=0;w<u;w++){var K=Q[w];K.intersection(B.x,B.y,64,64,
D);if(D.isEmpty())continue;y=(D.y-B.y)*64+(D.x-B.x);D.x+=e;D.y+=f;z.setRGBs(D.x,D.y,D.width,D.height,B.data,y,64);z.postPaint(D.x,D.y,D.width,D.height)}else{z.setRGBs(B.x,B.y,64,64,B.data,0,64);z.postPaint(B.x,B.y,64,64)}}}b.setPosition(l)}function sc(b){zc(b.getLittleEndian16())}function rc(b){Ac(b,24)}function tc(b){var e=b.getLittleEndian16();Ac(b,e)}function se(b,e,f,d,c,g,a,h){this.x=b;this.y=e;this.width=f;this.height=d;this.mask=c;this.pixel=g;this.bpp=a;this.cache_idx=h}function Ac(b,e){if(te)return;
var f=0;var d=0;var c=0;var g=0;var a=0;var h=0;var k=0;a=b.getLittleEndian16();f=b.getLittleEndian16();d=b.getLittleEndian16();c=b.getLittleEndian16();g=b.getLittleEndian16();h=b.getLittleEndian16();k=b.getLittleEndian16();var m=b.getBytes(k);var n=b.getBytes(h);if(f<0||f>=c-1)f=0;if(d<0)d=0;else if(d>=g)d=g-1;var l=true;for(var q=0;q<k;q++)if(m[q]!=0){l=false;break}ue(new se(f,d,c,g,n,m,e,a),l);zc(a)}function ve(b,e,f,d,c,g){if(c!=1)e=d-e-1;var a=(e*f+b)*c;var h=a/8>>0;var k=g[h]&255;switch(c){case 1:k=
k&128>>a%8;return k==0?0:4294967295;case 8:return k==0?0:4294967295;case 15:k=(g[h+1]&255)<<8|k;var m=new Array(4);Bc(k,15,m,0);return m[0]<<16|m[1]<<8|m[2];case 16:k=(g[h+1]&255)<<8|k;m=new Array(4);Bc(k,16,m,0);return m[0]<<16|m[1]<<8|m[2];case 24:return(g[h+2]&255)<<16|(g[h+1]&255)<<8|k;case 32:return(g[h+3]&255)<<24|(g[h+2]&255)<<16|(g[h+1]&255)<<8|k}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function we(b,e,f,d,c,g){if(c!=1)e=d-e-1;f=((f+7)/8|0)*8;var a=e*f+b;var h=a/8>>
0;var k=g[h]&128>>a%8;return k==0?1:0}function xe(b,e,f,d,c,g){var a=new Array(b*e);a[0]=0;var h=0;var k=true;var m=f.length;for(var n=0;n<m;n++)if(f[n]!=0){k=false;break}var l=0;var q;for(n=0;n<e;n++)for(q=0;q<b;q++){a[h]=ve(q,n,b,e,c,d);if(!k){l=we(q,n,b,e,c,f);if(l==0&&a[h]!=0){a[h]=~a[h];a[h]|=4278190080}else if(l==1||a[h]!=0)a[h]|=4278190080;if(c==32&&a[h]==-1&&l==0)a[h]=0}h++}return a}function ue(b,e){var f=b.x;var d=b.y;var c=b.width;var g=b.height;var a=b.mask;var h=b.pixel;var k=b.bpp;var x=
b.cache_idx;if(e){Cc(x,{"data":null,"hotX":f,"hotY":d,"url":null,"rawData":null,"width":c,"height":g,"none":true});return}var n=xe(c,g,a,h,k,f);var l="";if(k==1)l=Dc.getName(n,c,x);var q="";if(!l){var r=40;var p=c*g*4;var t=h.length;var z=a.length;var I=22+r+p+t+z;var B=new Uint8Array(I);B[0]=0;var u=new RdpBuffer(B,0,I);u.setLittleEndian16(0);u.setLittleEndian16(2);u.setLittleEndian16(1);u.setByte(c);u.setByte(g);u.setByte(0);u.setByte(0);u.setLittleEndian16(f);u.setLittleEndian16(d);u.setLittleEndian32(r+
p+t+z);u.setLittleEndian32(22);u.setLittleEndian32(r);u.setLittleEndian32(c);u.setLittleEndian32(g*2);u.setLittleEndian16(1);u.setLittleEndian16(32);u.setLittleEndian32(0);u.setLittleEndian32(t+z);u.setLittleEndian32(0);u.setLittleEndian32(0);u.setLittleEndian32(0);u.setLittleEndian32(0);var D;var y;for(D=g-1;D>=0;D--)for(y=0;y<c;y++){var A=n[c*D+y];u.setByte(A&255);u.setByte(A>>8&255);u.setByte(A>>16&255);u.setByte(A>>24&255)}for(D=0;D<t;D++)u.setByte(h[D]);for(D=0;D<z;D++)u.setByte(a[D]);if(hi5.browser.isIE){var w=
hi5.Arrays.hashCode(B);var G=new Uint8Array(I+6);G[0]=142;G[1]=56;G[2]=w&255;G[3]=w>>8&255;G[4]=w>>16&255;G[5]=w>>24&255;G.set(B,6);H(G.buffer);q=m.modifyURL(Ea()+"/CURSOR?"+w)}}Cc(x,{"system":l,"hotX":f,"hotY":d,"url":q,"rawData":n,"width":c,"height":g,"none":false,"result":""})}function zc(b){if(z.isPaused())return;var e=ye(b);if(e)w.setCursor(e)}function uc(){w.setCursor({"system":"default","none":false,"result":"default"})}function qc(b){var e=0;var f=null;var d=null;var c=null;var g=0;b.skipPosition(2);
e=b.getLittleEndian16();b.skipPosition(2);f=new Array(e);d=new Array(e);c=new Array(e);var a=b.getBytes(e*3);for(var h=0;h<e;h++){f[h]=a[g];d[h]=a[g+1];c[h]=a[g+2];g+=3}if(e!=256)return;ze(8,e,f,d,c)}function ze(b,e,f,d,c){if(!qa)qa=new Array(3);qa[0]=f;qa[1]=d;qa[2]=c}function oc(b,e){var f=0;var d=0;for(var c=0;f<e;){d=b.getByte();c=d&3;switch(c){case 1:Ae(b,d);break;case 2:if(Be(b,d))break;else return;case 3:Ce(b)}f++}}function De(b,e,f){var d=0;var c=0;if((e&64)!=0)f--;if((e&128)!=0)if(f<2)f=
0;else f-=2;for(var g=0;g<f;g++){c=b.getByte();d|=c<<g*8}return d}function Ae(b,e){var f=0;var d=0;var c=false;if((e&8)!=0)U.orderType=b.getByte();d=Ee[U.orderType];f=De(b,e,d);if((e&4)!=0){if((e&32)==0)Fe(b,U.bounds);Ge(U.bounds)}c=(e&16)!=0;switch(U.orderType){case 0:He(b,U.destBlt,f,c);break;case 1:Ie(b,U.patBlt,f,c);break;case 2:Je(b,U.screenBlt,f,c);break;case 9:Ke(b,U.line,f,c);break;case 10:Le(b,U.rectangle,f,c);break;case 11:Me(b,U.deskSave,f,c);break;case 13:Ne(b,U.memBlt,f,c);break;case 22:Oe(b,
U.polyLine,f,c);break;case 27:Pe(b,U.text2,f,c);break;default:svGlobal.logger.warn("XXX Order type "+U.orderType)}if((e&4)!=0)$b()}function Be(b,e){var f=e>>2;switch(f){case 11:Qe(b);return true;case 13:Re(b);return true;default:svGlobal.logger.warn("Alt Sec order:"+f);var d=m.sessionInfo.appInfo;if(d&&!d.joined)m.reconnect(N,v,true);return false}}function Re(b){var e=b.getLittleEndian32()}function Qe(b){var e=b.getLittleEndian16();var f=b.getLittleEndian32();var d=b.getPosition()+(e-7);if((f&16777216)!=
0)Se(f,b);else if((f&33554432)!=0)svGlobal.logger.info("XXX Alt Sec window Notify="+f);else if((f&67108864)!=0)Te(f,b);else svGlobal.logger.info("XXX Alt Sec window order flgas="+f);b.setPosition(d)}function Se(b,e){var f=e.getLittleEndian32();if((b&1073741824)!=0)Ue(f,e);else if((b&2147483648)!=0)svGlobal.logger.info("XXX rail cache icon, winId="+f);else if((b&536870912)!=0)Ve(f);else We(e,b,f)}function Ue(b,e){svGlobal.logger.info("XXX rail icon, winId="+b)}function Xe(b){this.id=b;this.appId="";
var e=this;var f=false;this.resizable=function(){return(e.style&262144)!=0||(e.style&65536)!=0||(e.style&16777216)!=0||e.showState==3};this.fillBrowser=function(){if(G.disableJoinedAppResize&&m.mode==2)return;if(!e.resizable())return;var d=w.getOwnerSurface(e);if(d){var c=d.getWindow();if(c){svGlobal.logger.info("fill browser, id:"+e.id+" title:"+e.titleInfo);if(e.showState==3){f=true;e.exeCommand(61728)}else e.resize(0,0,c.innerWidth,c.innerHeight)}}else svGlobal.logger.warn("XXX No browser for "+
b)};this.setShowState=function(b){e.showState=b;if(b==5&&f){f=false;e.fillBrowser()}};this.parent=function(){return w.getWinById(e.ownerWinid)};this.resize=function(b,f,g,a){if(G.disableJoinedAppResize&&m.mode==2)return;H("8C1"+e.id+"\t"+b+"\t"+f+"\t"+g+"\t"+a)};this.checkBound=function(){var b=w.getOwnerSurface(e);if(!b){svGlobal.logger.warn("no surface for checkBound");return}if(!e.isVisible())return;var f=b.getWindow();var g=e.winWidth;var a=e.winHeight;var h=e.winOffsetX;var k=e.winOffsetY;if(!f)return;
if(g<1||a<1||h<0||k<0||hi5.browser.isTouch)return;var m=false;var n=f.innerHeight;var l=f.innerWidth;if(e.resizable()){if(g>l){g=l;m=true}if(a>n){a=n;m=true}if(h+g>l){h=l-g;m=true}if(k+a>n){k=n-a;m=true}}else{if(h>l){h=l/2|0;m=true}if(k>n){k=n/2|0;m=true}}if(m)e.resize(h,k,g,a)};this.exeCommand=function(e){H("8C4"+b+"\t"+e)};this.activate=function(e){H("8C3"+b+"\t"+e)};this.close=function(){e.exeCommand(61536)};this.getAppId=function(){H("8C0"+b)};this.isVisible=function(){return e.winWidth&&e.winHeight&&
e.showState&&e.winHeight>45&&e.winWidth>45};this.getAppId()}function Te(b,e){svGlobal.logger.info("*** -- Alt Sec window Desktop="+b);if((b&1)!=0){svGlobal.logger.info("Desktop non monitored flags="+b);return}if((b&32)!=0){var f=e.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+b+" winId="+f);w.setTitle(f);if(!z.getContext()){var d=w.getFocused();if(d)z.setContext(d.context)}}else return;if((b&16)!=0){var c=e.getByte();if(c>0){var g=w.zOrders;g.length=c;for(var a=0;a<c;a++){g[a]=
e.getLittleEndian32();svGlobal.logger.info("---zorders:"+g[a])}}}}function Ve(b){svGlobal.logger.info("***** delete winId="+b);w.delWin(b)}function We(b,e,f){if(!da)da=true;var d=(e&268435456)==0;svGlobal.logger.info("\n\n=========== winId="+f+" existed="+d);var c=d?w.getWinById(f):new Xe(f);if(!c){svGlobal.logger.warn("XXX, No win with id:"+f);return}if((e&2)!=0){c["ownerWinid"]=b.getLittleEndian32();svGlobal.logger.info("***** ownerWinid="+c["ownerWinid"])}var g=false;var a=false;if((e&8)!=0){a=
true;c["style"]=b.getLittleEndian32();c["extStyle"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+f+" style="+c["style"]+" extStyle="+c["extStyle"]);svGlobal.logger.info("*****--- WS_POPUP="+((c["style"]&2147483648)!=0));svGlobal.logger.info("*****--- WS_DLGFRAME="+((c["style"]&4194304)!=0));svGlobal.logger.info("*****--- DS_MODALFRAME="+((c["style"]&128)!=0));svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+((c["extStyle"]&1)!=0));svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+
((c["extStyle"]&128)!=0));svGlobal.logger.info("*****--- WS_BORDER="+((c["style"]&8388608)!=0));svGlobal.logger.info("*****--- WS_CAPTION="+((c["style"]&12582912)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPED="+((c["style"]&0)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+((c["style"]&13565952)!=0));svGlobal.logger.info("*****--- WS_POPUPWINDOW="+((c["style"]&2156396544)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+((c["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_CHILD="+
((c["style"]&1073741824)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+((c["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_EX_MDICHILD="+((c["extStyle"]&64)!=0));svGlobal.logger.info("*****--- WS_EX_LAYERED="+((c["extStyle"]&524288)!=0))}if((e&16)!=0){c.setShowState(b.getByte());svGlobal.logger.info("***** winId="+f+" showState="+c["showState"]);var h=c["showState"];switch(h){case 2:if(m.windowState==3)setTimeout(function(){return function(){c.exeCommand(61728)}}(),50);break;case 3:c.fillBrowser()}}var k=
(e&4)!=0;if(k){var x=b.getLittleEndian16();c["titleInfo"]=b.getUnicodeString(x,false);svGlobal.logger.info("***** winId="+f+" title="+c["titleInfo"])}if((e&16384)!=0){c["clientOffsetX"]=b.getLittleEndian32();c["clientOffsetY"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+f+" coffX"+c["clientOffsetX"]+" coffY="+c["clientOffsetY"])}if((e&65536)!=0){c["clientAreaWidth"]=b.getLittleEndian32();c["clientAreaHeight"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+f+" cw"+c["clientAreaWidth"]+
" ch="+c["clientAreaHeight"])}if((e&131072)!=0)c["rpContent"]=b.getLittleEndian32();if((e&262144)!=0)c["rootParentHandle"]=b.getLittleEndian32();if((e&2048)!=0){var n=b.getLittleEndian32();var l=b.getLittleEndian32();if((c["winOffsetX"]<0||c["winOffsetY"]<0)&&n>0&&l>0&&a)g=true;c["winOffsetX"]=n;c["winOffsetY"]=l;svGlobal.logger.info("***** winId="+f+" offX"+c["winOffsetX"]+" offY="+c["winOffsetY"])}if((e&32768)!=0){c["winClientDeltaX"]=b.getLittleEndian32();c["winClientDeltaY"]=b.getLittleEndian32();
svGlobal.logger.info("***** winId="+f+" dX"+c["winClientDeltaX"]+" dY="+c["winClientDeltaY"])}if((e&1024)!=0){c["winWidth"]=b.getLittleEndian32();c["winHeight"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+f+" w"+c["winWidth"]+" h="+c["winHeight"])}if((e&256)!=0){var q=b.getLittleEndian16();if(q>0)b.skipPosition(q*8)}if((e&4096)!=0){c["visibleOffsetX"]=b.getLittleEndian32();c["visibleOffsetY"]=b.getLittleEndian32()}if((e&512)!=0){var r=b.getLittleEndian16();c["numVisibilityRects"]=r;
if(r>0)b.skipPosition(r*8)}if(!d)w.addWin(c);else{if(g)c.checkBound();w.onWinChange(c)}if(k)w.setTitle(f)}function Ce(b){var e;var f;var d;var c;e=b.getLittleEndian16();d=b.getLittleEndian16();f=b.getByte();c=b.getPosition()+e+7;switch(f){case 0:Ye(b);break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:Ze(b,d);break;case 3:$e(b);break;case 4:Ec(b,d,false);break;case 5:Ec(b,d,true);break;case 7:svGlobal.logger.info("CacheBrush...=");break;case 8:af(b,d);break;default:svGlobal.logger.warn("invalid second Order, type="+
f)}b.setPosition(c)}function af(b,e){var f=e&7;e=(e&65408)>>7;var d=b.getLittleEndian16();b.skipPosition(8);var c=b.getByte();b.skipPosition(2);var g=b.getByte();var a=b.getLittleEndian16();var h=b.getLittleEndian16();var k=b.getLittleEndian32();var m=null;if(g==1){Ib(b,c,a,h,Sa);var n=Sa.getData();var l=Sa.getDataSize();m=ia(l);wb(n,0,m,a,h,1);Ka.putBitmap(f,d,new Xa(m,a,h,0,0,32))}else if(g==0){var q=Bb(b.getData(),k,b.getPosition());m=ia(q.length);wb(q,0,m,a,h,1);Ka.putBitmap(f,d,new Xa(m,a,h,
0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+g);b.skipPosition(k)}function Ye(b){var e=b.getByte();b.skipPosition(1);var f=b.getByte();var d=b.getByte();var c=b.getByte();var g=Math.floor((c+7)/8);var a=b.getLittleEndian16();var h=b.getLittleEndian16();var k=b.getPosition();b.skipPosition(a);var m=new Array(f*d*g);m[0]=0;var n=0;var l=f*g;for(var q=0;q<d;q++){n=k+(d-q-1)*l;b.copyToByteArray(m,q*l,n,l)}Ka.putBitmap(e,h,new Xa(Jb(m,g),f,d,0,0,g*8))}function Ze(b,e){var f=b.getByte();var d=
b.getByte();var c=b.getByte();var g=b.getByte();var a=b.getByte();var h=Math.floor((a+7)/8);var k=b.getLittleEndian16();var m=b.getLittleEndian16();var n=0;if((e&1024)!=0)n=k;else{b.skipPosition(2);n=b.getLittleEndian16();b.skipPosition(2);b.skipPosition(2)}var l;if(h!=1)l=cb(c,g,n,b.getData(),b.getPosition());else l=Kb(c,g,n,b.getData(),b.getPosition());b.skipPosition(n);Ka.putBitmap(f,m,new Xa(l,c,g,0,0,a))}function Ec(b,e,f){var d;var c;var g;var a;var h;var k;var m;var n=0;g=e&7;k=((e&120)>>3)-
2;e=(e&65408)>>7;if((e&2)!=0)b.skipPosition(8);if((e&1)!=0){a=hb.readVar2Bytes(b);h=a}else{a=hb.readVar2Bytes(b);h=hb.readVar2Bytes(b)}n=hb.readVar4Bytes(b);m=hb.readVar2Bytes(b);var l=f&&(e&8)==0;if(l)b.skipPosition(8);if(f){var q;if(k!=1)q=cb(a,h,n,b.getData(),b.getPosition());else q=Kb(a,h,n,b.getData(),b.getPosition());b.skipPosition(n);if(!q){svGlobal.logger.warn("Failed to decompress bitmap data");return}d=new Xa(q,a,h,0,0,k*8)}else{var r=new Array(a*h*k);r[0]=0;var p=b.getPosition();var t=
0;var z=a*k;for(c=0;c<h;c++){t=p+(h-c-1)*z;b.copyToByteArray(r,c*z,t,z)}d=new Xa(Jb(r,k),a,h,0,0,k*8)}Ka.putBitmap(g,m,d);if((e&2)!=0)svGlobal.logger.warn("XXX:TODO, persistent")}function $e(b){var e=null;var f=0;var d=0;var c=0;var g=0;var a=0;var h=0;var k=0;var m=0;f=b.getByte();d=b.getByte();for(var n=0;n<d;n++){c=b.getLittleEndian16();g=b.getLittleEndian16();a=b.getLittleEndian16();h=b.getLittleEndian16();k=b.getLittleEndian16();m=k*Math.floor((h+7)/8)+3&~3;e=new fd(f,c,g,a,h,k,b.getBytes(m));
bf(e)}}function L(b,e,f){var d=0;if(f){d=b.getByte()<<24>>24;e+=d;return e}else{e=b.getLittleEndian16()<<16>>16;return e}}function Fe(b,e){var f=b.getByte();if((f&1)!=0)e.left=L(b,e.left,false);else if((f&16)!=0)e.left=L(b,e.left,true);if((f&2)!=0)e.top=L(b,e.top,false);else if((f&32)!=0)e.top=L(b,e.top,true);if((f&4)!=0)e.right=L(b,e.right,false);else if((f&64)!=0)e.right=L(b,e.right,true);if((f&8)!=0)e.bottom=L(b,e.bottom,false);else if((f&128)!=0)e.bottom=L(b,e.bottom,true)}function Ie(b,e,f,d){if((f&
1)!=0)e.x=L(b,e.x,d);if((f&2)!=0)e.y=L(b,e.y,d);if((f&4)!=0)e.cx=L(b,e.cx,d);if((f&8)!=0)e.cy=L(b,e.cy,d);if((f&16)!=0){e.opcode=b.getByte();e.opcode=e.opcode&3|(e.opcode&48)>>2}if((f&32)!=0)e.backgroundColor=Ta(b);if((f&64)!=0)e.foregroundColor=Ta(b);cf(b,e.brush,f>>7);var c=e.x;var g=e.y;if(c>P||g>S)return;var a=e.cx;var h=e.cy;var k=e.opcode;var m=e.backgroundColor;var n=e.foregroundColor;var l=e.brush.xOrigin;var q=e.brush.yOrigin;var r=e.brush.style;var p=e.brush.pattern;df(k,c,g,a,h,n,m,l,q,
r,p)}function He(b,e,f,d){if((f&1)!=0)e.x=L(b,e.x,d);if((f&2)!=0)e.y=L(b,e.y,d);if((f&4)!=0)e.cx=L(b,e.cx,d);if((f&8)!=0)e.cy=L(b,e.cy,d);if((f&16)!=0)e.opcode=b.getByte()&15;var c=e.x;var g=e.y;var a=e.cx;var h=e.cy;var k=e.opcode;if(c>N||g>v)return;var m=c+a-1;if(m>P)m=P;if(c<ca)c=ca;a=m-c+1;var n=g+h-1;if(n>S)n=S;if(g<W)g=W;h=n-g+1;if(a<1||h<1)return;ib(k,z,N,c,g,a,h,null,0,0,0);z.postPaint(c,g,a,h)}function Je(b,e,f,d){if((f&1)!=0)e.x=L(b,e.x,d);if((f&2)!=0)e.y=L(b,e.y,d);if((f&4)!=0)e.cx=L(b,
e.cx,d);if((f&8)!=0)e.cy=L(b,e.cy,d);if((f&16)!=0)e.opcode=b.getByte()&15;if((f&32)!=0)e.srcX=L(b,e.srcX,d);if((f&64)!=0)e.srcY=L(b,e.srcY,d);var c=e.x;var g=e.y;if(c>P||g>S)return;var a=e.cx;var h=e.cy;var k=e.opcode;var m=e.srcX;var n=e.srcY;var l=c+a-1;if(l>P)l=P;if(c<ca)c=ca;a=l-c+1;var q=g+h-1;if(q>S)q=S;if(g<W)g=W;h=q-g+1;m+=c-e.x;n+=g-e.y;if(a<1||h<1)return;if(k==12)z.moveArea(m,n,a,h,c-m,g-n);else ib(k,z,a,c,g,a,h,null,a,m,n);z.postPaint(c,g,a,h)}function Ta(b){var e=0;var f=0;f=b.getByte();
e=f;f=b.getByte();e|=f<<8;f=b.getByte();e|=f<<16;return e}function ef(b,e,f){if((f&1)!=0)e.style=b.getByte();if((f&2)!=0)e.width=b.getByte();if((f&4)!=0)e.color=Ta(b);return true}function Ke(b,e,f,d){if((f&1)!=0)e.mixmode=b.getLittleEndian16();if((f&2)!=0)e.startX=L(b,e.startX,d);if((f&4)!=0)e.startY=L(b,e.startY,d);if((f&8)!=0)e.endX=L(b,e.endX,d);if((f&16)!=0)e.endY=L(b,e.endY,d);if((f&32)!=0)e.backgroundColor=Ta(b);if((f&64)!=0)e.opcode=b.getByte();ef(b,e.pen,f>>7);var c=e.startX;var g=e.startY;
var a=e.endX;var h=e.endY;var k=e.pen.color;var m=e.opcode-1;if(g==h){if(c>a){var n=c;c=a;a=n}if(c<ca)c=ca;if(a>P)a=P}else if(c==a){if(g>h){n=g;g=h;h=n}if(g<W)g=W;if(g>S)g=S}Fc(c,g,a,h,k,m)}function Le(b,e,f,d){if((f&1)!=0)e.x=L(b,e.x,d);if((f&2)!=0)e.y=L(b,e.y,d);if((f&4)!=0)e.cx=L(b,e.cx,d);if((f&8)!=0)e.cy=L(b,e.cy,d);if((f&16)!=0)Ja=Ja&4294967040|b.getByte();if((f&32)!=0)Ja=Ja&4294902015|b.getByte()<<8;if((f&64)!=0)Ja=Ja&4278255615|b.getByte()<<16;e.color=Ja;Lb(e.x,e.y,e.cx,e.cy,e.color,true)}
function Me(b,e,f,d){if((f&1)!=0)e.offset=b.getLittleEndian32();if((f&2)!=0)e.left=L(b,e.left,d);if((f&4)!=0)e.top=L(b,e.top,d);if((f&8)!=0)e.right=L(b,e.right,d);if((f&16)!=0)e.bottom=L(b,e.bottom,d);if((f&32)!=0)e.action=b.getByte();ff(e)}function Ne(b,e,f,d){if((f&1)!=0){e.cacheID=b.getByte();e.colorTable=b.getByte()}if((f&2)!=0)e.x=L(b,e.x,d);if((f&4)!=0)e.y=L(b,e.y,d);if((f&8)!=0)e.cx=L(b,e.cx,d);if((f&16)!=0)e.cy=L(b,e.cy,d);if((f&32)!=0)e.opcode=b.getByte()&15;if((f&64)!=0)e.srcX=L(b,e.srcX,
d);if((f&128)!=0)e.srcY=L(b,e.srcY,d);if((f&256)!=0)e.cacheIDX=b.getLittleEndian16();var c=e.x;var g=e.y;if(c>P||g>S)return;var a=e.cx;var h=e.cy;var k=e.srcX;var m=e.srcY;var n=c+a-1;if(n>P)n=P;if(c<ca)c=ca;a=n-c+1;var l=g+h-1;if(l>S)l=S;if(g<W)g=W;h=l-g+1;k+=c-e.x;m+=g-e.y;var q=Ka.getBitmap(e.cacheID,e.cacheIDX);if(!q){svGlobal.logger.warn("Failed to get bitmap from cache, id:"+e.cacheID+" idx="+e.cacheIDX);return}var r=q.width;var p=q.height;if(a>r)a=r;if(h>p)h=p;if(e.opcode==12){z.setRGBs(c,
g,a,h,q.data,m*r+k,r);z.postPaint(c,g,a,h)}else{ib(e.opcode,z,N,c,g,a,h,q.data,r,k,m);z.postPaint(c,g,a,h)}}function cf(b,e,f){if((f&1)!=0)e.xOrigin=b.getByte();if((f&2)!=0)e.yOrigin=b.getByte();if((f&4)!=0)e.style=b.getByte();var d=e.pattern;if((f&8)!=0)d[0]=b.getByte();if((f&16)!=0)for(var c=1;c<8;c++)d[c]=b.getByte();e.pattern=d}function Oe(b,e,f,d){if((f&1)!=0)e.x=L(b,e.x,d);if((f&2)!=0)e.y=L(b,e.y,d);if((f&4)!=0)e.opcode=b.getByte();if((f&16)!=0)e.foregroundColor=Ta(b);if((f&32)!=0)e.lines=b.getByte();
if((f&64)!=0){var c=b.getByte();e.dataSize=c;e.data=b.getBytes(c)}gf(e)}function Pe(b,e,f,d){if((f&1)!=0)e.font=b.getByte();if((f&2)!=0)e.flags=b.getByte();if((f&4)!=0)e.opcode=b.getByte();if((f&8)!=0)e.mixmode=b.getByte();if((f&16)!=0)e.foregroundColor=Ta(b);if((f&32)!=0)e.backgroundColor=Ta(b);if((f&64)!=0)e.clipLeft=b.getLittleEndian16();if((f&128)!=0)e.clipTop=b.getLittleEndian16();if((f&256)!=0)e.clipRight=b.getLittleEndian16();if((f&512)!=0)e.clipBottom=b.getLittleEndian16();if((f&1024)!=0)e.boxLeft=
b.getLittleEndian16();if((f&2048)!=0)e.boxTop=b.getLittleEndian16();if((f&4096)!=0)e.boxRight=b.getLittleEndian16();if((f&8192)!=0)e.boxBottom=b.getLittleEndian16();if((f&16384)!=0)b.skipPosition(1);if((f&32768)!=0)b.skipPosition(1);if((f&65536)!=0)b.skipPosition(1);if((f&131072)!=0)b.skipPosition(1);if((f&262144)!=0)b.skipPosition(7);if((f&524288)!=0)e.x=b.getLittleEndian16();if((f&1048576)!=0)e.y=b.getLittleEndian16();if((f&2097152)!=0){var c=b.getByte();e.length=c;e.text=b.getBytes(c);e.textPos=
0}var g=e.font;var a=e.flags;var h=e.mixmode;var k=e.foregroundColor;var m=e.backgroundColor;var n=e.clipLeft;var l=e.clipTop;var q=e.clipRight;var r=e.clipBottom;var p=e.boxLeft;var t=e.boxTop;var B=e.boxRight;var I=e.boxBottom;var w=e.x;var u=e.y;var D=e.length;var y=e.text;var A=q-n;var G=r-l;var H=B-p;var K=I-t;var C=null;var F=0;var Y=0;if(p+H>N)H=N-p;if(H>1)Lb(p,t,H,K,m,false);else if(h==1)Lb(n,l,A,G,m,false);var Tc=D;for(var fa=0;fa<D;)switch(y[Y+fa]){case 255:var za=y[Y+fa+2];if(za>Tc-Y){fa=
D=0;break}var Fa=y.slice?y.slice(Y,Y+za):y.subarray(Y,Y+za);var nb=new ed(za,Fa);hf(y[Y+fa+1],nb);fa+=3;D-=fa;Y=fa;fa=0;break;case 254:var Ca=jf(y[Y+fa+1]);var L=Ca?Ca.data:null;if(L)if(L[1]==0&&(a&32)==0)if((a&4)!=0)u+=y[Y+fa+2];else w+=y[Y+fa+2];if(fa+2<D)fa+=3;else fa+=2;D-=fa;Y=fa;fa=0;if(!Ca)break;var v=Ca.size;for(var Da=0;Da<v;Da++){C=Gc(g,L[Da]);if((a&32)==0){F=L[++Da];if((F&128)!=0)if((a&4)!=0){u+=L[Da+1]|L[Da+2]<<8;Da+=2}else{w+=L[Da+1]|L[Da+2]<<8;Da+=2}else if((a&4)!=0)u+=F;else w+=F}if(C){Hc(h,
w+C.offset&65535,u+C.baseLine&65535,C.width,C.height,C.fontData,m,k,Oa,Ha);if((a&32)!=0)w+=C.width}}break;default:C=Gc(g,y[Y+fa]);if((a&32)==0){F=y[Y+ ++fa];if((F&128)!=0)if((a&4)!=0){u+=y[Y+fa+1]|y[Y+fa+2]<<8;fa+=2}else{w+=y[Y+fa+1]|y[Y+fa+2]<<8;fa+=2}else if((a&4)!=0)u+=F;else w+=F}if(C){Hc(h,w+C.offset&65535,u+C.baseLine&65535,C.width,C.height,C.fontData,m,k,Oa,Ha);if((a&32)!=0)w+=C.width}fa++}if(H>1){if(K>0)z.postPaint(p,t,H,K)}else if(A>0&&G>0)z.postPaint(n,l,A,G)}function pc(b){var e=0;var f=
0;var d=0;var c=0;var g=0;var a=0;var h=0;var k=0;var m=0;var n=0;var l=0;var q=0;var r=0;var p;var t;var z;var B;z=B=0;p=N;t=v;e=b.getLittleEndian16();for(var w=0;w<e;w++){f=b.getLittleEndian16();d=b.getLittleEndian16();c=b.getLittleEndian16();g=b.getLittleEndian16();a=b.getLittleEndian16();h=b.getLittleEndian16();n=b.getLittleEndian16();l=b.getLittleEndian16();q=b.getLittleEndian16();k=c-f+1;m=g-d+1;if(p>f)p=f;if(t>d)t=d;if(z<c)z=c;if(B<g)B=g;if(Ha!=n){svGlobal.logger.warn("Server limited colour depth to "+
n+" bits");if(!Ic)rb(n);Ic=true;Bpp=Oa}if(l==0){var u=a*Oa;var D=h*u;var y="Uint8Array"in window?new Uint8Array(D):new Array(D);y[0]=0;var A=b.getPosition();for(var G=0;G<h;G++){Ga(b.getData(),A,y,(h-G-1)*u,u);A+=u}b.skipPosition(D);Jc(y,f,d,a,h,k,m,Oa);continue}if((l&1024)!=0)r=q;else{b.skipPosition(2);r=b.getLittleEndian16();b.skipPosition(4)}kf(b.getData(),r,b.getPosition(),a,h,f,d,k,m,Oa);b.skipPosition(r)}}function Ed(b){var e=JSON.parse(b);if(m.onnotify)m.onnotify(e);if(!e.name){if(svGlobal.log>
0)console.erro("No error code for message:"+b);return}svGlobal.logger.info("msg="+b);if(e.type&&m.onerror)m.onerror(e);var f=__svi18n.errorCode["S"+e.name]||"";f+=e.message;m.showMessage(f,null);tb=true}function Fd(b){w.drawLicense(b)}function Bf(b){var e=b.split("\t");var f=parseInt(e[0],10);var d=parseInt(e[1],10);lf(f,d,false)}function lf(b,e,f){}function Ge(b){ca=b.left;if(ca<0)ca=0;W=b.top;if(W<0)W=0;P=b.right;if(P>=N)P=N-1;S=b.bottom;if(S>=v)S=v-1}function $b(){ca=0;P=N-1;W=0;S=v-1}function mf(b,
e,f,d,c,g){var a;var h;if(e==d)if(f>b){h=f-b;if(h<1)return;for(a=0;a<h;a++)jb(g,z,b+a,e,c);z.postPaint(b,e,h+1,1)}else{h=b-f;if(h<1)return;for(a=0;a<h;a++)jb(g,z,f+a,e,c);z.postPaint(f,e,h+1,1)}else if(d>e){h=d-e;if(h<1)return;for(a=0;a<h;a++)jb(g,z,b,e+a,c);z.postPaint(b,e,1,h+1)}else{h=e-d;if(h<1)return;for(a=0;a<h;a++)jb(g,z,b,d+a,c);z.postPaint(b,d,1,h+1)}}function Fc(b,e,f,d,c,g){var a=Math.min(b,f);var h=Math.max(b,f);var k=Math.min(e,d);var m=Math.max(e,d);c=wa(c);var n=a>=ca&&h<=P&&k>=W&&
m<=S;if(!n){if(a>P||h<ca||k>S||m<W)return;var l=0;if(b==f){if(e>d){l=e;e=d;d=l}if(e<W)e=W;if(d>S)d=S}else if(e==d){if(b>f){l=b;b=f;f=l}if(b<ca)b=ca;if(f>P)f=P}else{var q=U._line;q.set(b,e,f,d);var r=q.intersection(ca,W,P,W);var p=[];if(r.onLine1&&r.onLine2)p.push(r.x,r.y);r=q.intersection(P,W,P,S);if(r.onLine1&&r.onLine2)p.push(r.x,r.y);r=q.intersection(ca,S,P,S);if(r.onLine1&&r.onLine2)p.push(r.x,r.y);r=q.intersection(ca,W,ca,S);if(r.onLine1&&r.onLine2)p.push(r.x,r.y);if(p.length==2)if(b>=ca&&b<=
P&&e>=W&&e<=S)p.push(b,e);else if(f>=ca&&f<=P&&d>=W&&d<=S)p.push(f,d);if(p.length!=4)return;b=p[0];e=p[1];f=p[2];d=p[3]}}if(g==12)z.drawLine(b,e,f,d,c);else if(b==f||e==d)mf(b,e,f,d,c,g);else{var t=Math.abs(f-b);var B=Math.abs(d-e);var w=b;var J=e;var u;var D;var y;var A;var G;var H;var K;var C;if(f>=b){u=1;D=1}else{u=-1;D=-1}if(d>=e){y=1;A=1}else{y=-1;A=-1}if(t>=B){u=0;A=0;H=t;G=t/2>>0;K=B;C=t}else{D=0;y=0;H=B;G=B/2>>0;K=t;C=B}if(C<1)return;for(var F=0;F<=C;F++){jb(g,z,w,J,c);G+=K;if(G>=H){G-=H;
w+=u;J+=y}w+=D;J+=A}}a=Math.min(b,f);h=Math.max(b,f);k=Math.min(e,d);m=Math.max(e,d);if(h-a<0)return;if(m-k<0)return;z.postPaint(a,k,h-a+1,m-k+1)}function ff(b){var e=b.right-b.left+1;var f=b.bottom-b.top+1;if(b.action==0)nf(b.offset,b.left,b.top,e,f);else of(b.offset,e,f,b.left,b.top)}function nf(b,e,f,d,c){if(d<1||c<1)return;Mb.save(e,f,d,c,b,z.getRGBs(e,f,d,c))}function of(b,e,f,d,c){var g=Mb.restore(d,c,e,f,b);if(!g){svGlobal.logger.warn("XXX no matched desktop save.");return}z.setRGBs(d,c,e,
f,g,0,e);z.postPaint(d,c,e,f)}function gf(b){var e=b.x;var f=b.y;var d=b.foregroundColor;var c=b.lines;var g=b.dataSize;var a=b.data;var h=new Array(1);h[0]=Math.floor((c-1)/4)+1;var k=0;var m=0;var n=b.opcode-1;for(var l=0;l<c&&h[0]<g;l++){var q=e;var r=f;if(l%4==0)k=a[m++];if((k&192)==0)k|=192;if((k&64)!=0)e+=Kc(a,h);if((k&128)!=0)f+=Kc(a,h);Fc(q,r,e,f,d,n);k<<=2}}function Hc(b,e,f,d,c,g,a,h,k,m){var n=128;h=wa(h);a=wa(a);if(e>P||f>S)return;var l=e+d-1;if(l>P)l=P;var q=e<ca?ca:e;var r=l-e+1;var p=
f+c-1;if(p>S)p=S;var t=f<W?W:f;var B=p-f+1;if(r<1||B<1)return;var w=t!=f||r!=d||B!=c||q!=e;var J=0;var u=0;var D=z.setRGB;if(!w)if(b==0)for(var y=0;y<c;y++){J=f+y;for(var A=0;A<d;A++){if(n==0){u++;n=128}if((g[u]&n)!=0)D(e+A,J,h);n>>=1}u++;n=128;if(u==g.length)u=0}else for(y=0;y<c;y++){J=f+y;for(A=0;A<d;A++){if(n==0){u++;n=128}if((g[u]&n)!=0)D(e+A,J,h);else D(e+A,J,a);n>>=1}u++;n=128;if(u==g.length)u=0}else if(b==0)for(y=0;y<B;y++){J=f+y;for(A=0;A<r;A++){if(n==0){u++;n=128}if(e+A>=q&&J>=t)if((g[u]&
n)!=0)D(e+A,J,h);n>>=1}u++;n=128;if(u==g.length)u=0}else for(y=0;y<B;y++){J=f+y;for(A=0;A<r;A++){if(n==0){u++;n=128}if(e+A>=q&&f+y>=t)if((g[u]&n)!=0)D(e+A,J,h);else D(e+A,J,a);n>>=1}u++;n=128;if(u==g.length)u=0}}function df(b,e,f,d,c,g,a,h,k,m,n){g=wa(g);a=wa(a);var l=e+d-1;if(l>P)l=P;if(e<ca)e=ca;d=l-e+1;var q=f+c-1;if(q>S)q=S;if(f<W)f=W;c=q-f+1;if(d<1||c<1)return;var r=null;switch(m){case 0:r=ia(d*c);r[0]=0;for(var p=0;p<r.length;p++)r[p]=g;ib(b,z,N,e,f,d,c,r,d,0,0);z.postPaint(e,f,d,c);if(d==1)w.execute("setCaretPos",
[e,f]);break;case 2:svGlobal.logger.warn("hatch");break;case 3:var t=n;r=ia(d*c);r[0]=0;var B=0;for(p=0;p<c;p++)for(var I=0;I<d;I++){if((t[(p+k)%8]&1<<(I+h)%8)==0)r[B]=g;else r[B]=a;B++}ib(b,z,N,e,f,d,c,r,d,0,0);z.postPaint(e,f,d,c);break;default:svGlobal.logger.warn("Unsupported brush style "+m)}}function Kc(b,e){var f=b[e[0]++]&255;var d=f&128;if((f&64)!=0)f|=~63;else f&=63;if(d!=0)f=f<<8|b[e[0]++]&255;return f}function Lb(b,e,f,d,c,g){if(b>P||e>S)return;var a=b+f-1;if(a>P)a=P;if(b<ca)b=ca;f=a-
b+1;var h=e+d-1;if(h>S)h=S;if(e<W)e=W;d=h-e+1;if(f<1||d<1)return;z.fillRect(b,e,f,d,wa(c));z.postPaint(b,e,f,d)}function Jc(b,e,f,d,c,g,a,h,k){if(!k)k=0;var m=Jb(b,h);z.setRGBs(e,f,g,a,m,k,d);z.postPaint(e,f,g,a)}function kf(b,e,f,d,c,g,a,h,k,m){if(h*k*d*c<1)return;if(m!=1){z.setRGBs(g,a,h,k,cb(d,c,e,b,f),0,d);z.postPaint(g,a,h,k)}else Jc(Kb(d,c,e,b,f),g,a,d,c,h,k,m)}function yd(b){return hi5.Base64.dec(b,0)}function La(b){if(!m)return;svGlobal.logger.warn("closed ...");if(m){var e=m.mode==0;if(!T&&
e)Yb("connection");var f=e&&(T||gb<m.reconnectTimes)&&gb>0&&!tb;T=false;sa=false;if(f){gb--;m.showMessage(__svi18n.info.reconnecting+" "+(m.reconnectTimes-gb)+"/"+m.reconnectTimes,null,3E3);setTimeout(cc,5);return}}if(Gb)return;ja=null;U=null;ma=null;if(ha){ha.release();ha=null}Mb=null;Ka=null;sb=null;Ya=null;Pa=null;if(typeof rdp8bulkData!="undefined")rdp8bulkData.release();yc=null;Sa=null;Ib=null;Lc=null;if(ma)ma.close();jc();if(ja)ja.close();if(ra){ra.setInterval(0);ra=null}try{if(Aa!=null){Aa.exit();
Aa=null}if(m.onclose)m.onclose();if(w)w.close()}catch(d){}ka=null;if(Z){Z.onopen=null;Z.onmessage=null;Z.onclose=null;Z.onerror=null;Z=null}Qa=null;vb=null;w=null;if(z){z.release();z=null}if(Ba){Ba.release();Ba=null}m=null;if(!hi5.browser.isChromeApp)window.removeEventListener("unload",La,false);else chrome.runtime.onSuspend.removeListener(La);if(window&&window.$rdp)window.$rdp=null}function xb(b,e,f,d,c,g,a){var h=c*f+d;var k=b.setRGB;var m=b.getRGB;for(var n=0;n<a;n++){for(var l=0;l<g;l++){if(b){var q=
m(d+l,c+n);k(d+l,c+n,~q&la)}else e[h]=~e[h]&la;h++}h+=f-g}}function pf(b,e,f,d,c,g){var a=b.setRGB;for(var h=f;h<f+c;h++)for(var k=d;k<d+g;k++)a(h,k,0)}function qf(b,e,f,d,c,g){var a=b.setRGB;for(var h=f;h<f+c;h++)for(var k=d;k<d+g;k++)a(h,k,la)}function Mc(b,e,f,d,c,g,a,h,k){if(!g)b.moveArea(h,k,d,c,e-h,f-k);else b.setRGBs(e,f,d,c,g,k*a+h,a)}function ib(b,e,f,d,c,g,a,h,k,m,n){if(g<0|a<0|f<0|k<0)return;switch(b){case 0:pf(e,f,d,c,g,a);break;case 1:rf(e,f,d,c,g,a,h,k,m,n);break;case 2:sf(e,f,d,c,g,
a,h,k,m,n);break;case 3:xb(e,h,k,m,n,g,a);Mc(e,d,c,g,a,h,k,m,n);break;case 4:xb(e,null,f,d,c,g,a);Nc(e,f,d,c,g,a,h,k,m,n);break;case 5:xb(e,null,f,d,c,g,a);break;case 6:tf(e,f,d,c,g,a,h,k,m,n);break;case 7:uf(e,f,d,c,g,a,h,k,m,n);break;case 8:Nc(e,f,d,c,g,a,h,k,m,n);break;case 9:vf(e,f,d,c,g,a,h,k,m,n);break;case 10:break;case 11:wf(e,f,d,c,g,a,h,k,m,n);break;case 12:Mc(e,d,c,g,a,h,k,m,n);break;case 13:xb(e,null,f,d,c,g,a);Oc(e,f,d,c,g,a,h,k,m,n);break;case 14:Oc(e,f,d,c,g,a,h,k,m,n);break;case 15:qf(e,
f,d,c,g,a);break;default:svGlobal.logger.warn("unsupported opcode: "+b)}}function jb(b,e,f,d,c){if(!e)return;var g=e.getRGB(f,d);switch(b){case 0:e.setRGB(f,d,0);break;case 1:e.setRGB(f,d,~(g|c)&la);break;case 2:e.setRGB(f,d,g&(~c&la));break;case 3:e.setRGB(f,d,~c&la);break;case 4:e.setRGB(f,d,(~g&c)*la);break;case 5:e.setRGB(f,d,~g&la);break;case 6:e.setRGB(f,d,g^c&la);break;case 7:e.setRGB(f,d,~g&c&la);break;case 8:e.setRGB(f,d,g&(c&la));break;case 9:e.setRGB(f,d,g^~c&la);break;case 10:break;case 11:e.setRGB(f,
d,g|~c&la);break;case 12:e.setRGB(f,d,c);break;case 13:e.setRGB(f,d,(~g|c)&la);break;case 14:e.setRGB(f,d,g|c&la);break;case 15:e.setRGB(f,d,la);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+b);e.setRGB(f,d,c)}}function rf(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++)l(f+c,d+g,~(q(f+c,d+g)|a[n])&la);n+=h-c}}function sf(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=
q(f+c,d+g);l(f+c,d+g,t&(~a[n]&la));n++}n+=h-c}}function tf(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=q(f+p,d+r);l(f+p,d+r,t^a[n]&la);n++}n+=h-c}}function uf(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=q(f+p,d+r);l(f+p,d+r,~(t&a[n])&la);n++}n+=h-c}}function Nc(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=
q(f+p,d+r);l(f+p,d+r,t&(a[n]&la));n++}n+=h-c}}function vf(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=q(f+p,d+r);l(f+p,d+r,t^~a[n]&la);n++}n+=h-c}}function wf(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=q(f+p,d+r);l(f+p,d+r,t|~a[n]&la);n++}n+=h-c}}function Oc(b,e,f,d,c,g,a,h,k,m){var n=m*h+k;var l=b.setRGB;var q=b.getRGB;for(var r=0;r<g;r++){for(var p=0;p<c;p++){var t=
q(f+p,d+r);l(f+p,d+r,t|a[n]&la);n++}n+=h-c}}function hf(b,e){if(b<Pa.length){var f=Pa[b];if(f){f.data=null;f=null}Pa[b]=e}}function jf(b){var e=null;if(b<Pa.length){e=Pa[b];if(e&&e.data)return e}return null}function bf(b){if(b.font<12&&b.character<256){var e=Ya[b.font][b.character];if(e){e.fontData=null;e=null}Ya[b.font][b.character]=b}else svGlobal.logger.warn("put font: font="+b.font+" c="+b.character)}function Gc(b,e){if(b<12&&e<256){var f=Ya[b][e];if(f)return f}return null}function Cc(b,e){if(b<
20)sb[b]=e}function ye(b){if(b<20){var e=sb[b];if(e)return e}return null}function Bc(b,e,f,d){switch(e){case 16:xf(b,f,d);break;case 15:yf(b,f,d);break;case 8:f[d]=qa[0][b];f[d+1]=qa[1][b];f[d+2]=qa[2][b];f[d+3]=255;break;case 32:f[d]=b&255;f[d+1]=b>>8&255;f[d+2]=b>>16&255;f[d+3]=b>>24&255;default:f[d]=b&255;f[d+1]=b>>8&255;f[d+2]=b>>16&255;f[d+3]=255}}function yf(b,e,f){var d=b>>7&248;var c=b>>2&248;var g=b<<3&255;d|=d>>5;c|=c>>5;g|=g>>5;e[f]=d;e[f+1]=c;e[f+2]=g;e[f+3]=255}function xf(b,e,f){var d=
b>>8&248;var c=b>>3&252;var g=b<<3&255;d|=d>>5;c|=c>>6;g|=g>>5;e[f]=d;e[f+1]=c;e[f+2]=g;e[f+3]=255}function Jb(b,e){var f=b.length/e>>0;var d=ia(f);d[0]=0;var c=wa;switch(e){case 1:for(var g=0;g<f;g++)d[g]=c(b[g]);break;case 2:for(g=0;g<f;g++)d[g]=c(b[g*2+1]<<8|b[g*2]);break;default:for(g=0;g<f;g++)d[g]=c(b[g*e+2]<<16)|b[g*e+1]<<8|b[g*e]}return d}function Kb(b,e,f,d,c){var g=d;var a=-1;var h=0;var k=c;var m=0;var n=f+k;var l=0;var q=0;var r=0;var p=b;var t=-1;var z=0;var B=0;var w=0;var u=0;var D=
0;var y=0;var A=4294967295;var G=false;var H=false;var K=false;var C=new Array(b*e);for(C[0]=0;k<n;){z=0;B=g[k++];l=B>>4;switch(l){case 12:case 13:case 14:l-=6;q=B&15;r=16;break;case 15:l=B&15;if(l<9){q=g[k++];q|=g[k++]<<8}else q=l<11?8:1;r=0;break;default:l>>=1;q=B&31;r=32}if(r!=0){K=l==2||l==7;if(q==0)if(K)q=g[k++]+1;else q=g[k++]+r;else if(K)q<<=3}switch(l){case 0:if(t==l&&!(p==b&&a==-1))G=true;break;case 8:w=g[k++];case 3:u=g[k++];break;case 6:case 7:A=g[k++];l-=5;break;case 9:y=3;l=2;z=3;break;
case 10:y=5;l=2;z=5}t=l;for(D=0;q>0;){if(p>=b){p=0;e--;a=h;h=m+e*b}switch(l){case 0:if(G){if(a==-1)C[h+p]=A;else C[h+p]=C[a+p]^A;G=false;q--;p++}if(a==-1){for(;(q&~7)!=0&&p+8<b;)for(var F=0;F<8;F++){C[h+p]=0;q--;p++}for(;q>0&&p<b;){C[h+p]=0;q--;p++}}else{for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){C[h+p]=C[a+p];q--;p++}for(;q>0&&p<b;){C[h+p]=C[a+p];q--;p++}}break;case 1:if(a==-1){for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){C[h+p]=A;q--;p++}for(;q>0&&p<b;){C[h+p]=A;q--;p++}}else{for(;(q&~7)!=0&&p+8<b;)for(F=
0;F<8;F++){C[h+p]=C[a+p]^A;q--;p++}for(;q>0&&p<b;){C[h+p]=C[a+p]^A;q--;p++}}break;case 2:if(a==-1){for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){D<<=1;D=D&255;if(D==0){y=z!=0?z:g[k++];D=1}if((y&D)!=0)C[h+p]=A;else C[h+p]=0;q--;p++}for(;q>0&&p<b;){D<<=1;D=D&255;if(D==0){y=z!=0?z:g[k++];D=1}if((y&D)!=0)C[h+p]=A;else C[h+p]=0;q--;p++}}else{for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){D<<=1;D=D&255;if(D==0){y=z!=0?z:g[k++];D=1}if((y&D)!=0)C[h+p]=C[a+p]^A;else C[h+p]=C[a+p];q--;p++}for(;q>0&&p<b;){D<<=1;D=D&255;
if(D==0){y=z!=0?z:g[k++];D=1}if((y&D)!=0)C[h+p]=C[a+p]^A;else C[h+p]=C[a+p];q--;p++}}break;case 3:for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){C[h+p]=u;q--;p++}for(;q>0&&p<b;){C[h+p]=u;q--;p++}break;case 4:for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){C[h+p]=g[k++];q--;p++}for(;q>0&&p<b;){C[h+p]=g[k++];q--;p++}break;case 8:for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){if(H){C[h+p]=u;H=false}else{C[h+p]=w;H=true;q++}q--;p++}for(;q>0&&p<b;){if(H){C[h+p]=u;H=false}else{C[h+p]=w;H=true;q++}q--;p++}break;case 13:for(;(q&
~7)!=0&&p+8<b;)for(F=0;F<8;F++){C[h+p]=255;q--;p++}for(;q>0&&p<b;){C[h+p]=255;q--;p++}break;case 14:for(;(q&~7)!=0&&p+8<b;)for(F=0;F<8;F++){C[h+p]=0;q--;p++}for(;q>0&&p<b;){C[h+p]=0;q--;p++}break;default:q--;p++}}}return C}if(sessionStorage)sessionStorage.clear();this.reconnectOnResize=true;this.displayMsg=true;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.openLink=true;this.setTitle=true;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[]};
this.mode=0;this.remoteAppLogin=true;var ub=false;var $a={};var ab={};var eb=null;var m=this;var Ma=true;var tb=false;var Gb=false;var sa=false;var Ic=false;var G=hi5.appcfg||{img:{},toolbar:{fadable:true}};this.setConfig=function(b){G=b};var Za=typeof B=="object"?B:null;var t=Za?{}:hi5.tool.queryToObj(B.substring(B.indexOf("?")+1));var N=0|0;var v=0|0;var Ha=(Ua||t.color||t.server_bpp||16)|0;var Ga=hi5.Arrays.arraycopy;var ta=hi5.Arrays.fill;var bb=null;var ba=null;var mb=!hi5.browser.isIE||hi5.browser.isEdge;
this.protocol=Za?"":B.substring(0,B.indexOf("://")).toLowerCase();this.setProfiler=function(b){ba=b};this.gateway=function(){if(Za)return"";var b=B.lastIndexOf("/RDP?");if(b==-1)b=B.lastIndexOf("/JOIN?");if(b==-1)b=B.lastIndexOf("/PLAY?");var e=B.substring(0,b);return e.replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();var xa=typeof B=="object"||B.indexOf("/PLAY?")>0;var Pc=!xa&&B.indexOf("invitation=")>0;if(Pc){var Nb=decodeURIComponent(B);var yb=Nb.indexOf(' USERNAME="');if(yb>
0){yb+=11;var Qc=Nb.substring(yb,Nb.indexOf('"',yb));B+="&novice="+Qc+"&server="+Qc}B+="&mapClipboard=on"}if(xa){this.mode=1;if(Za)B="";else{N=640|0;v=480|0}B+="&touchpad=on";this.reconnectOnResize=false}else if(B.indexOf("/JOIN?")>0||Pc){this.mode=2;Ma=this.reconnectOnResize;this.reconnectOnResize=false}if(aa==undefined)N=(t.width||window.innerWidth)|0;else N=aa|0;if(pa==undefined)v=(t.height||Qb(window.innerHeight))|0;else v=pa|0;if(N==-1)N=screen.width|0;else if(N==0)N=window.innerWidth|0;if(v==
-1)v=screen.height|0;else if(v==0)v=window.innerHeight|0;if(t.symlink&&t.parameters)hi5.tool.queryToObj(decodeURIComponent(t.parameters),t);if(!t.gateway)B+="&gateway="+encodeURIComponent(m.gateway);if(!t.minWidth&&G.minWidth)rdArgs.minWidth=G.minWidth;if(!t.minHeight&&G.minHeight)rdArgs.minHeight=G.minHeight;if(t.minWidth)t.minWidth=parseInt(t.minWidth);if(t.minHeight)t.minHeight=parseInt(t.minHeight);if(t.waWidth)t.waWidth=parseInt(t.waWidth);if(t.waHeight)t.waHeight=parseInt(t.waHeight);if(!("useSSL"in
t))B+="&useSSL="+(m.protocol=="wss");if(hi5.storage.isAvailable&&!ya(t.shareClipboard))if(oa(t.shareClipboard)||t.shareClipboardId||oa(t.mapClipboard)&&t.shareClipboard==undefined)B+="&shareClipboardId="+(t.shareClipboardId||Sc());if(G){if(G.displayMsg!=undefined)this.displayMsg=G.displayMsg;else G.displayMsg=this.displayMsg;if(G.appTimeout)this.appTimeout=G.appTimeout;if(G.reconnectOnResize!=undefined){this.reconnectOnResize=G.reconnectOnResize;Ma=this.reconnectOnResize}if(G.reconnectTimes)this.reconnectTimes=
G.reconnectTimes;if(G.windowState!=undefined)this.windowState=G.windowState;if(G.openLink!=undefined)this.openLink=G.openLink;if(G.setTitle!=undefined)this.setTitle=G.setTitle;if(G.audioBuffer)this.audioBuffer=G.audioBuffer;if(typeof G.useWSS=="boolean")B=(G.useWSS?"wss":"ws")+B.substring(B.indexOf("://"));if(typeof G.remoteAppLogin=="boolean"){this.remoteAppLogin=G.remoteAppLogin;ub=!G.remoteAppLogin;svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")}if(typeof G.hideLogin==
"boolean")ub=G.hideLogin}var gb=this.reconnectTimes;if(t.vmid&&t.vmid.indexOf("EnhancedMode=1")==-1){this.reconnectOnResize=false;Ma=this.reconnectOnResize}this.server=Na();this.port=parseInt(t.port,10);this.loadbalanceToken=G.loadbalanceTokenName?G.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(b){if(m.loadbalanceToken)b+="&"+m.loadbalanceToken;return b};this.getURL=function(){return B};this.getColor=function(){return Ha};var ob=hi5.graphic.Rectangle;var Ba=new function(){function b(b){return b&
511^b>>>9^b>>>4^b>>>7}function e(b){return b&31^b>>>5^b>>>9}function f(b){var e;e=(b>>>8^b&255)>>>2&15;if(b>>>9!=0)e=~e;e=e&65535;return e%12}function d(b){var e;e=b>>>4&15;return(e^e>>>2^e>>>3)&3}function c(b){b=(b&1431655765)<<1|b>>>1&1431655765;b=(b&858993459)<<2|b>>>2&858993459;b=(b&252645135)<<4|b>>>4&252645135;if(b>>>8==0)return b;b=(b&16711935)<<8|b>>>8&16711935;if(b>>>16==0)return b;b=(b&65535)<<16|b>>>16&65535;return b}function g(e){var a=B[b(e)];if((a^e)>>>9!=0)return a&511;else return B[w[f(e)]]}
function a(b){var a=D[e(b)];if((a^b)>>>5!=0)return a&31;else return D[y[d(b)]]}function h(b,e){var a=b[2]|b[3]<<16;a<<=16;b[2]=a&65535;b[3]=a>>>16&65535;var d=b[0]|b[1]<<16;a|=d>>>16;b[2]=a&65535;b[3]=a>>>16&65535;d=d<<16|e;b[0]=d&65535;b[1]=d>>>16&65535}function k(b,e){var a=b[0];b[0]=b[e];b[e]=a}function m(b,e,d,f){var n=q;var C=r;var x=l;var y=0|0;var B=0;var D=0;var w;var I=0;var J=e;var L=0|0;var N=0;var v=0;var V;var P;var ga=0|0;if(ba)ba.begin("decData6");t=0;p=x;if((f&64)!=0){Ga(n,x-32768,
n,0,32768);x=32768;l=x;p=32768}if((f&128)!=0){x=0;ta(n,0,65536,0);ta(C,0,C.length,0);p=0}if((f&32)!=32){Ga(b,0,n,x,d);x+=d;t=x-l;l=x;return 0}V=0;for(var S=e+d;J<S;){ga=b[J++];y|=ga<<V;N+=8;V+=8;if(V>=32)break}y=c(y);if(J<S){L=c(b[J++])&255;v=8}else v=0;for(;N>=8;){B=0;for(P=5;P<=13;P++){if(P==12)continue;ga=c(y&4294967295<<32-P);ga=g(ga);if(P==z[ga])break}y<<=P;N-=P;if(ga<256)n[x++]=ga&255;else if(ga>256&&ga<289){w=ga-257;V=A[w];B=G[w]-1;if(V!=0)B+=c(y&4294967295<<32-V);h(C,B);y<<=V;N-=V}else if(ga>
288&&ga<293){w=ga-289;B=C[w];if(w!=0)k(C,w)}else if(ga==256)break;for(V=32-N;V>0;)if(v<V){ga=L>>>8-v;y|=ga<<32-N-v;N+=v;V-=v;if(J<S){L=c(b[J++])&255;v=8}else{V=0;v=0}}else if(v>V){y|=L>>>8-V;L<<=V;L&=255;v-=V;N=32;break}else{y|=L>>>8-V;N=32;if(J<S){L=c(b[J++])&255;v=8}else v=0;break}if(B==0)continue;for(P=2;P<=9;P++){ga=c(y&4294967295<<32-P);ga=a(ga);if(P==u[ga])break}y<<=P;N-=P;V=H[ga];D=K[ga];if(V!=0)D+=c(y&4294967295<<32-V);y<<=V;N-=V;I=x-B;V=D>B?B:D;for(ga=0;V>0;){n[x++]=n[I++];V--}for(;D>B;){ga=
ga>=B?0:ga;n[x++]=n[I+ga++];D--}for(V=32-N;V>0;)if(v<V){ga=L>>>8-v;y|=ga<<32-N-v;N+=v;V-=v;if(J<S){L=c(b[J++])&255;v=8}else{V=0;v=0}}else if(v>V){y|=L>>>8-V;L<<=V;L&=255;v-=V;N=32;break}else{y|=L>>>8-V;N=32;if(J<S){L=c(b[J++])&255;v=8}else v=0;break}}if((f&128)!=0)t=x;else t=x-l;l=x;if(ba)ba.end("decData6");return 0}function n(b,e,a,d){var f;var c=0;var g;var h=0;var k;var m;var n;var r;var x;var C=(d&1)!=0;var u=q;if(ba)ba.begin("decData5");if((d&32)==0){p=0;t=a;return 0}if((d&64)!=0)l=0;if((d&128)!=
0){for(var y=65536;--y>=0;)u[y]=0;l=0}p=0;t=0;g=l;k=g;r=k;p=r;if(a==0)return 0;a+=h;do{if(c==0){if(h>=a)break;g=b[e+h++]<<24;c=8}if(g>=0){if(c<8){if(h>=a){if(g!=0)return-1;break}g|=b[e+h++]<<24-c;c+=8}if(k>=65536)return-1;u[k++]=g>>>24&255;g<<=8;c-=8;continue}g<<=1;if(--c==0){if(h>=a)return-1;g=b[e+h++]<<24;c=8}if(g>=0){if(c<8){if(h>=a)return-1;g|=b[e+h++]<<24-c;c+=8}if(k>=65536)return-1;u[k++]=(g>>>24|128)&255;g<<=8;c-=8;continue}g<<=1;if(--c<(C?3:2)){if(h>=a)return-1;g|=b[e+h++]<<24-c;c+=8}if(C)switch(g>>>
29){case 7:for(;c<9;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}g<<=3;m=g>>>26;g<<=6;c-=9;break;case 6:for(;c<11;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}g<<=3;m=(g>>>24)+64;g<<=8;c-=11;break;case 5:case 4:for(;c<13;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}g<<=2;m=(g>>>21)+320;g<<=11;c-=13;break;default:for(;c<17;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}g<<=1;m=(g>>>16)+2368;g<<=16;c-=17}else switch(g>>>30){case 3:if(c<8){if(h>=a)return-1;g|=b[e+h++]<<24-c;c+=8}g<<=2;m=g>>>26;g<<=6;c-=8;break;case 2:for(;c<
10;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}g<<=2;m=(g>>>24)+64;g<<=8;c-=10;break;default:for(;c<14;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}m=(g>>>18)+320;g<<=14;c-=14}if(c==0){if(h>=a)return-1;g=b[e+h++]<<24;c=8}n=0;if(g>=0){n=3;g<<=1;c--}else{x=C?14:11;do{g<<=1;if(--c==0){if(h>=a)return-1;g=b[e+h++]<<24;c=8}if(g>=0)break;if(--x==0)return-1}while(true);n=(C?16:13)-x;g<<=1;if(--c<n)for(;c<n;c+=8){if(h>=a)return-1;g|=b[e+h++]<<24-c}x=n;n=g>>>32-x&~(-1<<x)|1<<x;g<<=x;c-=x}if(k+n>=65536)return-1;f=
k-m&(C?65535:8191);do u[k++]=u[f++];while(--n!=0)}while(true);l=k;p=r;t=k-r;if(ba)ba.end("decData5");return 0}var l=0;var q=na(65536);q[0]=0;if(!q.buffer)ta(q,0,65536,0);var r=new Array(8);ta(r,0,8,0);var p=0;var t=0;var z=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,9,9,9,8,9,9,10,9,9,9,9,9,9,9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,
10,10,10,10,10,10,9,10,10,10,10,10,10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,7,7];var B=[123,65311,65293,
65063,65024,65285,65303,65128,197,65031,65299,65216,65288,65048,65307,65203,65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,65170,65185,65306,65039,65287,65110,65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,65194,65097,65535,65047,
65121,65247,65535,65279,65270,65100,65535,65535,65159,65535,65316,65535,65084,65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,65535,65535,65155,65065,65535,65535,65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,65535,65535,65133,65150,
65535,65535,65535,65535,65115,65244,65535,65535,65260,65095,65055,65535,65151,65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,65181,65199,65535,65535,65105,65235,65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,65160,65182,65535,65091,
65535,65535,65188,65171,65535,65535,65535,65085,65535,65535,65259,65241,65535,65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,65535,65131,65535,65535,65079,65535,65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,65139,65535,65535,65535,
65072,65163,65535,65535,65213,65070,256,65535,65262,65234,65535,65535,65535,65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,65535,65535,65245,65118,65046,65535,65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,65057,65535,65263,65176,
65535,65535,65153,65535,65535,65535,65191,65535,65210,65277,65535,65535,65535,65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,65238,65143,65535,65535,65535,65075,65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,65166,65535,273,65145,65089,
267];var w=[511,0,508,448,494,347,486,482];var u=[4,2,3,4,3,4,4,5,4,5,5,6,6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9];var D=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082];var y=[0,4,10,19];var A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15];var G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,
49153,65537];var H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,6,6,8,8,14,14];var K=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2];var C=new RdpBuffer(q,0,1);this.reset=function(){l=0;q=Array(65536);q[0]=0;p=0;t=0;C=new RdpBuffer(q,0,1)};this.release=function(){r=null;C=null;q=null};this.getData=function(){C.setPosition(p);C.markEnd(p+t);return C};this.getDecompressedLength=function(){return t};this.dec=function(b,e,a,d){if((d&15)==2)return m(b,e,a,d);
else return n(b,e,a,d)}};var te=B.indexOf("nocurosr=on")>0;var da=B.indexOf("startProgram=app")>0;var Hb=B.indexOf("mapDisk=on")>0;var ha=null;if(da){this.reconnectOnResize=false;Ma=this.reconnectOnResize}if(hi5.browser.isTouch)if(Math.max(N,v)>Math.max(window.innerWidth,window.innerHeight)){this.reconnectOnResize=false;Ma=this.reconnectOnResize}this.isRemoteApp=function(){return da};Ub();var Z=null;var T=false;var Ia=false;var ja=new Xd(m.audioBuffer);var z=new Sb(N,v);this.setVolume=function(b){if(ja)ja.setVolume(b)};
this.setAudioBuffer=function(b){m.audioBuffer=b;ja.delay=b;if(Ra)Ra.delay=b};var Ra=null;var Ya=new Array(12);for(var ua=0;ua<12;ua++)Ya[ua]=new Array(256);var Pa=new Array(256);var ca=0;var W=0;var P=N-1;var S=v-1;var qa=null;var db=null;var Oa=0;window.$rdp=this;var Aa=null;var wa=Vb;var cb=Wb;rb(Ha);this.running=function(){return T};var ra=new hi5.tool.PingPong(function(b){if(T)Z.send(b)},function(b){if(m.onpong)m.onpong(b)},function(){if(m.onnoresponse)return m.onnoresponse()});this.setJoinMode=
function(b){if(!T)return;H("8E1"+b)};this.setJoinCloseMode=function(b){if(!T)return;H("8EB3\t"+b)};this.refuseControl=function(b){if(!T)return;H("8E3"+b)};this.giveControl=function(b){if(!T)return;H("8E4"+b)};this.pauseSession=function(b,e){if(!T)return;H("8EB"+(e?1:0)+"\t"+b)};this.closeSession=function(b){if(!T)return;H("8EB2"+"\t"+b)};this.requestControl=function(){if(!T)return;H("8E2")};this.saveSession=function(b){if(!T)return;H("8E9"+(b.save?1:0)+"\t"+(b.timeout||0)+"\t"+(b.id||0))};this.allowJoin=
function(b,e){if(!T)return;H("8EA"+b+"\t"+(e?1:0))};var Ob=new function(){function b(){if(f&&f.length>0){var e=f.shift();Ob.sendSingleKey(e.down,e.key);if(f.length>0)setTimeout(b,d);else f=null}}var e={" ":57,"space":57,"pageup":201,"pagedown":209,"end":207,"home":199,"left":203,"up":200,"right":205,"down":208,"printscreen":183,"insert":210,"del":211,"delete":211,"altgr":184,"windows":219,"windowsright":220,"context":221,"esc":1,"backspace":14,"tab":15,"enter":28,"meta":29,"command":29,"ctrl":29,
"shift":42,"alt":56,"capslock":58,"f1":59,"f2":60,"f3":61,"f4":62,"f5":63,"f6":64,"f7":65,"f8":66,"f9":67,"f10":68,"f11":87,"f12":88,"numlock":69,"scrolllock":70,"add":78};this.sendSingleKey=function(b,d){var a=e[d.toLowerCase()];if(a)m.writeScancode(b,a);else{var f=d.length;if(f==0)return;if(f==1)m.writeKeyCode(b,d.toUpperCase().charCodeAt(0));else if(b)m.writeText(d)}};var f=null;var d=0;this.sendKeyComb=function(e,g){if(!sa)return;var a=e.split("+");var h=a.length;var k=0;if(h==0)return;var m=
null;var n=new Array;for(k=0;k<h;k++){var l=a[k];if(l==""&&m=="")l="Add";if(l!="")n.push({"key":l,"down":true});m=l}h=n.length;for(k=h-1;k>=0;k--)n.push({"key":n[k].key,"down":false});if(!g)for(k=0,h=n.length;k<h;k++)Ob.sendSingleKey(n[k].down,n[k].key);else{f=n;d=g;b()}}};this.writeKeyComb=function(b,e){if(sa)Ob.sendKeyComb(b,e)};this.writeText=function(b){if(sa)H("86"+b)};var Qa=new function e(){this.capsLock=this.numLock=false;this.setJoinMode=m.setJoinMode;this.requestControl=m.requestControl;
this.writeKeyComb=m.writeKeyComb;this.writeText=m.writeText;this.draw=z.draw;this.getAppMode=function(){return m.mode};this.send=function(e){if(!T)return;H(e)};this.saveSession=function(e){m.saveSession(e)};this.sendInput=function(e){if(sa&&!z.isPaused()){Zc(e);H(e);if(m.onactivity)m.onactivity(e)}};var f=null;this.getAppInfo=function(){return m.sessionInfo.appInfo};this.onresize=function(e){var c=e.target.svSurface;if(!c)return;var g=c.getFreeSpace();var a=g.width;var h=g.height;if(da){var k=c.railWin;
if(k)k=k.getMain(w.zOrders);if(k)k.resize(0,0,a,h);return}if(m.reconnectOnResize&&T){var t=function(){svGlobal.logger.warn("w:"+a+" ww:"+N+" h:"+h+" hh:"+v);m.reconnect(a,h,G.forceReconnect)};if(f){clearTimeout(f);f=0}f=setTimeout(t,700)}};this.onorientationchange=function(e){var f=Qb(e.innerHeight);if(m.reconnectOnResize)m.reconnect(e.innerWidth,f);else if(da){if(!e.svSurface)return;var g=e.svSurface.railWin;if(g)g=g.getMain(w.zOrders);if(g)g.resize(0,0,e.innerWidth,f)}};this.getClipData=rd;this.onfocus=
function(e){var f=e.target;if(da&&f.svSurface&&f.svSurface.railWin){var g=f.svSurface.railWin.getTopWin(w.zOrders);if(!g||!Z)return;var a=f.svSurface.context;if(a&&a!=z.getContext()){z.setContext(null);g.activate(1);svGlobal.logger.info("Activate win:"+g.id)}}};this.getShareFiles=function(e,f){if(Ia&&ha)ha.list(e,f)};this.getFile=function(e){m.reconnectOnResize=false;window.open(m.getFileUrl(e))};this.getFileLink=function(e){return m.modifyURL(Ea()+"/DOWNLOAD?s="+db+"&f="+e)};this.getGateway=function(){return B};
this.reconnect=function(e,f,g){if(t.symlink){var a="user="+e+"&pwd="+f;if(g)a+="&domain="+g;B=hi5.tool.replaceQuery(B,"parameters",a)}else{B=hi5.tool.replaceQuery(B,"user",e);B=hi5.tool.replaceQuery(B,"pwd",f);B=hi5.tool.replaceQuery(B,"domain",g)}if("sessionStorage"in window)sessionStorage.clear();m.run()};this.sendKeyboardSynchronize=function(e,f,g){if(xa)return;var a=0;if(g)a=a|4;if(f)a=a|2;if(e)a=a|1;H("8E5"+a);Qa.capsLock=g;Qa.numLock=f};this.fromSyncedSurface=function(e){return w.fromSyncedSurface(e)}};
var w=function f(){var d=[];d.addSurface=function(f){d.push(f)};d.hasSurface=function(f){var g=d.length;for(var a=0;a<g;a++)if(d[a].equals(f))return true;return false};d.fromSyncedSurface=function(f){var g=d.length;var a=Date.now();for(var h=0;h<g;h++)if(d[h].isClipSynced(f))return true;return false};d.setSize=function(f,g,a){var h=0;for(var k=d.length;h<k;h++)d[h].setSize(f,g,a)};d.zOrders=new Array;d.drawLicense=function(f){var g=0;for(var a=d.length;g<a;g++)d[g].drawLicense(f)};d.setReadOnly=function(f){var g=
0;for(var a=d.length;g<a;g++)d[g].setReadOnly(f)};d.setVisible=function(d,f){svGlobal.logger.info("TODO: setVisible")};d.copyToClip=function(f){if(d.length<1)return;d[0].copyToClip(f)};d.setCursor=function(f){if(!da&&d[0])d[0].setCursor(f);var g=d.getFocused();if(!g)return;g.setCursor(f)};d.hide=function(f){if(!da){d[0].hide();return}var g=0;for(var a=d.length;g<a;g++)d[g].getWindow().close()};d.execute=function(f,g){var a=0;for(var h=d.length;a<h;a++)d[a][f].apply(d[a],g)};d.addWin=function(f){var g=
d.getFocused();if(!g){svGlobal.logger.warn("Focused surface not found!");g=d[d.length-1]}if(!g){svGlobal.logger.warn("No surface available!");return}da=true;if(!g.railWin){g.railWin=new sd;g.onunload=function(){if(G.closeRemoteApp)if(g.railWin)g.railWin.close();if(g.remoteApp)g.remoteApp.close();if(g.railWin){g.railWin.clear();g.railWin=null}d.removeElm(g)}}if(g.context)z.setContext(g.context);g.railWin.addWin(f);if(hi5.browser.isIE)g.focus()};d.delWin=function(f){var g;for(var a=d.length-1;a>=0;a--){var h=
d[a];g=h.railWin;var k=g.getWinById(f);var t=k&&k.appId&&k.appId.toLowerCase().indexOf("runonce")!=-1;if(g.delWin(f)>=0){if(k==g.mainWin)g.mainWin=null;if(!g.hasApp(k.appId)){var n=function(a){return function(){svGlobal.logger.debug("Start del:"+Date.now());if(!a.railWin||!a.railWin.isRunning()){if(a.remoteApp)a.remoteApp.close();d.delSurface(a)}}};var l=m.appTimeout;if(t||g.isNew())l*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(n(h),l)}}}};d.popWins=function(f){return d[0]&&d[0].railWin?
d[0].railWin.popWins(f):[]};d.getWinById=function(f){var g;var a=0;for(var h=d.length;a<h;a++)if(d[a].railWin){g=d[a].railWin.getWinById(f);if(g)return g}return null};d.onWinChange=function(f){var g;var a=0;for(var h=d.length;a<h;a++)if(d[a].railWin){g=d[a].railWin.getWinById(f.id);if(g)d[a].railWin.onchange(f)}};d.setTitle=function(f){var g;var a=0;for(var h=d.length;a<h;a++)if(d[a].railWin){g=d[a].railWin.getWinById(f);if(g&&g.titleInfo&&g.isVisible()){zb(g.titleInfo+" - "+Na(),d[a].getWindow());
return}}};d.hasApp=function(f){var g=0;for(var a=d.length;g<a;g++)if(d[g].railWin.hasApp(f))return true;return false};d.delSurface=function(f){if(!f||f.railWin&&f.railWin.isRunning())return;svGlobal.logger.info("delete surface...");d.removeElm(f);f.close();if(d.length==0)La()};d.getOwnerSurface=function(f){var g=0;for(var a=d.length;g<a;g++)if(d[g].railWin&&d[g].railWin.hasWin(f))return d[g];return null};d.getFocused=function(){if(!da)return d[0];var f=d.length;for(var g=0;g<f;g++)if(d[g].focused)return d[g];
return d[f-1]};d.close=function(){var f=0;for(var g=d.length;f<g;f++)if(d[f]){if(d[f].remoteApp)d[f].remoteApp.close();d[f].close()}};return d}();this.getSurfaces=function(){return w};this.hide=function(){if(!w)return;w.hide()};var ma={count:0,names:[],close:function(){var f=ma.names;var d=0;for(var c=f.length;d<c;d++)if(ma[f[d]].close)ma[f[d]].close()},init:function(f,d,c){function g(){var a=new m.DynamicChannel;a.name="TSMF";var d={type:"image/jpeg"};var f=new Array(1);a.process=function(c){var g=
c.getPosition();var h;var k=0;var m=0;var t;var B=0;var u=0;var D=0;var y;var A=c.getLittleEndian32();var w=A&1073741823;var G=w>>>30;var K=c.getLittleEndian32();var C=c.getLittleEndian32();switch(w){case 2:if(C==256){var F=c.getLittleEndian32();h=new Uint8Array(16);y=new RdpBuffer(h,0,16);y.setLittleEndian32(2|0);y.setLittleEndian32(K);y.setLittleEndian32(1);y.setLittleEndian32(0);a.send(h)}break;case 0:switch(C){case 257:t=c.getBytes(16);u=c.getLittleEndian32();break;case 256:g=c.getPosition();
var H=c.getLittleEndian32();var L=0;var v=0;for(D=0;D<H;D++){L=c.getLittleEndian32();v=c.getLittleEndian32();m=c.getLittleEndian32();c.skipPosition(v-4)}k=c.getPosition()-g;m=k+8+4;h=new Uint8Array(m);y=new RdpBuffer(h,0,m);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(K);h.set(c.getData().subarray(g,c.getPosition()),8);a.send(h);break;case 261:t=c.getBytes(16);B=c.getLittleEndian32();break;case 264:B=c.getLittleEndian32();c.skipPosition(4);var N=c.getLittleEndian32();var P;var S;var ba=0;
var ca=0;var W=0;var T;var aa=0;P=c.getBytes(16);S=c.getBytes(16);ba=c.getLittleEndian32();ca=c.getLittleEndian32();W=c.getLittleEndian32();T=c.getBytes(16);aa=c.getLittleEndian32();c.skipPosition(aa);h=new Uint8Array(20);y=new RdpBuffer(h,0,20);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(K);if(hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],P)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],S)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,
0,170,0,85,89,90],T))y.setLittleEndian32(1);else{y.setLittleEndian32(0);svGlobal.logger.warn("Format is not supported:");svGlobal.logger.warn(P);svGlobal.logger.warn(S);svGlobal.logger.warn(T)}y.setLittleEndian32(B);a.send(h);break;case 261:t=c.getBytes(16);B=c.getLittleEndian32();break;case 258:t=c.getBytes(16);u=c.getLittleEndian32();N=c.getLittleEndian32();c.skipPosition(N);break;case 263:t=c.getBytes(16);h=new Uint8Array(16);y=new RdpBuffer(h,0,16);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(K);
y.setLittleEndian32(1);a.send(h);case 277:t=c.getBytes(16);u=c.getLittleEndian32();break;case 262:t=c.getBytes(16);z.flushImgs();z.setImgRect(0,0,0,0);h=new Uint8Array(12);y=new RdpBuffer(h,0,12);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(K);a.send(h);break;case 278:t=c.getBytes(16);var X=c.getLittleEndian32();var Z=c.getLittleEndian32();var da=c.getLittleEndian32();var ja=c.getLittleEndian32();z.setImgRect(X,Z,da-X,ja-Z);break;case 265:t=c.getBytes(16);var V=c.getLittleEndian64();var ma=
c.getLittleEndian32()==1;break;case 266:t=c.getBytes(16);break;case 268:t=c.getBytes(16);break;case 267:t=c.getBytes(16);break;case 269:t=c.getBytes(16);var ga=c.getLittleEndian32();break;case 274:break;case 275:break;case 259:t=c.getBytes(16);u=c.getLittleEndian32();k=c.getLittleEndian32();c.skipPosition(32);k=c.getLittleEndian32();var la=new Image;g=c.getPosition();f[0]=c.getData().subarray(g,g+k);var pa=new Blob(f,d);la.src=URL.createObjectURL(pa);z.addImg(la);break;case 270:z.flushImgs();break;
case 273:break;case 260:break;case 276:t=c.getBytes(16);k=c.getLittleEndian32();g=c.getPosition()+k;c.skipPosition(8);var ea=c.getLittleEndian32();svGlobal.logger.info("window state:"+ea);var oa=c.getLittleEndian32();var Rc=c.getLittleEndian32();X=c.getLittleEndian32();Z=c.getLittleEndian32();c.skipPosition(8);var U=c.getLittleEndian32();var ha=c.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+X+" top:"+Z+" w:"+oa+" h:"+Rc+" cl:"+U+" ct:"+ha);c.setPosition(g);var ia=c.getLittleEndian32();
for(g=c.getPosition()+ia;c.getPosition()<g;){var ka=c.getLittleEndian32();var na=c.getLittleEndian32();var qa=c.getLittleEndian32();var sa=c.getLittleEndian32();svGlobal.logger.info("visible region, l:"+na+" t:"+ka+" r:"+sa+" b:"+qa)}z.setImgRect(X,Z,oa,Rc);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+C)}break;default:svGlobal.logger.warn("unkown interface:"+w)}};return a}ma.count=0;ma.names.length=0;var a=new m.DynamicChannel;a.name="ECHO";a.process=function(d){var f=
d.getPosition();var c=d.getEnd();var g=c-f;var h=new Uint8Array(g);h.set(d.getData().subarray(f,c));a.send(h)};m.addDynamicChannel(a);if(f){var h=new m.DynamicChannel;h.name="Microsoft::Windows::RDS::Input";h.process=function(a){var d=a.getLittleEndian16();var f=a.getLittleEndian32();switch(d){case 1:a.skipPosition(4);var c=new RdpBuffer(new Uint8Array(16),0,16);c.setLittleEndian16(2);c.setLittleEndian32(16);c.setLittleEndian32(1|2);c.setLittleEndian32(65536);c.setLittleEndian16(256);c.markEnd();
h.send(c);case 5:w.execute("setTouchRemoting",[true]);ma.isTouchReady=true;svGlobal.logger.info("Touch remoting start");break;case 4:w.execute("setTouchRemoting",[false]);ma.isTouchReady=false;svGlobal.logger.info("Touch remoting suspend")}};m.addDynamicChannel(h)}if(c){svGlobal.logger.warn("Audio input on");var k=new m.DynamicChannel;(function n(){function a(d){var f=d.getLittleEndian32();var c=d.getLittleEndian32();var h=[];var m=[];var l=0;var n=hi5.audio.getAudioContext().sampleRate;for(l=0;l<
f;l++){var q=new g;q.fromBuffer(d);if(q.formatTag==49&&q.nSamplesPerSec==22050){q.hasLocalSupport=true;h.push(q)}else if(q.formatTag==1&&q.nSamplesPerSec==n&&q.nChannels==2)m.push(q)}k.send(u);var r=0;c=h.length;if(c==0){h=m;c=m.length;G.directInput=true}for(l=0;l<c;l++)r+=h[l].getSize();var p=new RdpBuffer(new Uint8Array(1024),0,1024);p.setByte(2);p.setLittleEndian32(c);p.setLittleEndian32(r+9);for(l=0;l<c;l++)h[l].toBuffer(p);p.skipPosition(1024-r-9);p.markEnd();k.send(p)}function d(a){var f=new RdpBuffer(new Uint8Array(5),
0,5);f.setByte(7);f.setLittleEndian32(a);f.markEnd();k.send(f)}function f(a){var c=a.getLittleEndian32();var h=a.getLittleEndian32();var l=new g;l.fromBuffer(a);z=true;y=m.reconnectOnResize;m.reconnectOnResize=false;G.start();if(!G.onopen)G.onopen=function(a){B=a;m.reconnectOnResize=y;d(h);var f=new RdpBuffer(new Uint8Array(5),0,5);f.setByte(4);f.setLittleEndian32(a?0:1);f.markEnd();k.send(f)};if(!G.ondata)G.ondata=function(a,d){if(B){if(A.length!=d+1){A=new Uint8Array(d+1);A[0]=6}k.send(u);A.set(a,
1);k.send(A)}}}function c(a){var f=a.getLittleEndian32();if(!z){d(f);z=false}}function g(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.formatTag=0;this.nChannels=0;this.nSamplesPerSec=0;this.nAvgBytesPerSec=0;this.nBlockAlign=0;this.bitsPerSample=0;this.hasLocalSupport=false;this.cbSize=0;this.extenstion=null;var a=this;this.fromBuffer=function(d){a.formatTag=
d.getLittleEndian16();a.nChannels=d.getLittleEndian16();a.nSamplesPerSec=d.getLittleEndian32();a.nAvgBytesPerSec=d.getLittleEndian32();a.nBlockAlign=d.getLittleEndian16();a.bitsPerSample=d.getLittleEndian16();var f=d.getLittleEndian16();a.cbSize=f;if(f>0){a.extenstion=new Array(f);d.copyToByteArray(a.extenstion,0,d.getPosition(),f);d.skipPosition(f)}};this.toBuffer=function(d){d.setLittleEndian16(a.formatTag);d.setLittleEndian16(a.nChannels);d.setLittleEndian32(a.nSamplesPerSec);d.setLittleEndian32(a.nAvgBytesPerSec);
d.setLittleEndian16(a.nBlockAlign);d.setLittleEndian16(a.bitsPerSample);d.setLittleEndian16(a.cbSize);if(a.cbSize>0)d.setBytes(a.extenstion)};this.getSize=function(){return 18+a.cbSize};this.toString=function(){return"Audio Format, tag="+a.formatTag+" nChannels="+a.nChannels+" nSamplesPerSec="+a.nSamplesPerSec+" nAvgBytesPerSec"+a.nAvgBytesPerSec+" nBlockAlign"+a.nBlockAlign+" bitsPerSample"+a.bitsPerSample+" cbSize="+a.cbSize}}function h(a){function d(f){r=true;if(m.onopen)m.onopen(true);w=new t;
g=f;l=a.createMediaStreamSource(f);var h=m.directInput?1024:4096;k=a.createJavaScriptNode?a.createJavaScriptNode(h,1,1):a.createScriptProcessor(h,1,1);if(m.directInput&&!u)u=new Int16Array(2048);k.onaudioprocess=function(a){if(!c)return;var d=a.inputBuffer.getChannelData(0);if(m.directInput){var f=0;var g=0;for(var h=0;h<1024;h++){g=d[h]*32767;u[f++]=g;u[f++]=g}G.ondata(new Uint8Array(u.buffer),4196)}else y.addData(d,p);d.fill(0)};var n=a.createBiquadFilter();n.frequency.value=q/2;l.connect(n);n.connect(k);
k.connect(a.destination)}function f(){if(!c){if(g.getTracks){var a=g.getTracks()[0];a.stop()}k&&k.disconnect();l&&l.disconnect();r=false}}var c=false;var g=null;var l=null;var k=null;var m=this;var n=a.sampleRate;var q=22050;var p=n/q;var r=false;this.directInput=false;m=this;var u;this.start=function(){if(!r)navigator.getUserMedia({audio:true},d,function(a){r=false;c=false;if(m.onopen)m.onopen(false);svGlobal.logger.warn("Error on getUserMedia: "+a)});else if(m.onopen)m.onopen(true);c=true};this.stop=
function(){c=false};this.close=function(){c=false;y.reset();w=new t;setTimeout(f,8E3)};var y=new function(){function a(d){var l=k/g|0;for(var m=0;m<l;m++){f(d,h);h+=g;k-=g}if(k>0)c=d;else c=null}function d(f){var g=k+f.length;var l=new Float32Array(g);l.set(c.subarray(h));l.set(f,k);h=0;k=g;a(l)}function f(a,d){var c=w.encode(a,d,q,l);l+=c;if(l==n){l=0;m.ondata(q,n)}}var c=null;var g=160;var h=0;var k=0;var l=0;var n=Math.floor(Math.floor(Math.floor(4096/p)/160)/2)*65;var q=new Uint8Array(n);this.reset=
function(){l=0;h=0;k=0;c=null};this.addData=function(f,c){f=$c(f,c);if(k==0){k=f.length;h=0;a(f)}else d(f)}}}function t(){function a(d,f){var c=0;for(var g=0;g<160;g++){c=d[f++];qa[g]=c<0?c*32768:c*32767}}function d(){ta=!ta;var a=0;f();var c=0;if(ta){c=U[0]<<4|U[1]<<10;M[a++]=c>>4;c=c>>5|U[2]<<11;M[a++]=c>>7;c=c>>5|U[3]<<11;c=c>>4|U[4]<<12;M[a++]=c>>6;c=c>>4|U[5]<<12;c=c>>3|U[6]<<13;M[a++]=c>>7;c=c>>3|U[7]<<13;c=c>>7|ha[0]<<9;M[a++]=c>>5;c=c>>2|ka[0]<<14;c=c>>2|ia[0]<<14;c=c>>6|na[0]<<10;M[a++]=
c>>3;c=c>>3|E[0]<<13;M[a++]=c>>8;c=c>>3|E[1]<<13;c=c>>3|E[2]<<13;c=c>>3|E[3]<<13;M[a++]=c>>7;c=c>>3|E[4]<<13;c=c>>3|E[5]<<13;c=c>>3|E[6]<<13;M[a++]=c>>6;c=c>>3|E[7]<<13;c=c>>3|E[8]<<13;M[a++]=c>>8;c=c>>3|E[9]<<13;c=c>>3|E[10]<<13;c=c>>3|E[11]<<13;M[a++]=c>>7;c=c>>3|E[12]<<13;c=c>>7|ha[1]<<9;M[a++]=c>>5;c=c>>2|ka[1]<<14;c=c>>2|ia[1]<<14;c=c>>6|na[1]<<10;M[a++]=c>>3;c=c>>3|E[13]<<13;M[a++]=c>>8;c=c>>3|E[14]<<13;c=c>>3|E[15]<<13;c=c>>3|E[16]<<13;M[a++]=c>>7;c=c>>3|E[17]<<13;c=c>>3|E[18]<<13;c=c>>3|E[19]<<
13;M[a++]=c>>6;c=c>>3|E[20]<<13;c=c>>3|E[21]<<13;M[a++]=c>>8;c=c>>3|E[22]<<13;c=c>>3|E[23]<<13;c=c>>3|E[24]<<13;M[a++]=c>>7;c=c>>3|E[25]<<13;c=c>>7|ha[2]<<9;M[a++]=c>>5;c=c>>2|ka[2]<<14;c=c>>2|ia[2]<<14;c=c>>6|na[2]<<10;M[a++]=c>>3;c=c>>3|E[26]<<13;M[a++]=c>>8;c=c>>3|E[27]<<13;c=c>>3|E[28]<<13;c=c>>3|E[29]<<13;M[a++]=c>>7;c=c>>3|E[30]<<13;c=c>>3|E[31]<<13;c=c>>3|E[32]<<13;M[a++]=c>>6;c=c>>3|E[33]<<13;c=c>>3|E[34]<<13;M[a++]=c>>8;c=c>>3|E[35]<<13;c=c>>3|E[36]<<13;c=c>>3|E[37]<<13;M[a++]=c>>7;c=c>>
3|E[38]<<13;c=c>>7|ha[3]<<9;M[a++]=c>>5;c=c>>2|ka[3]<<14;c=c>>2|ia[3]<<14;c=c>>6|na[3]<<10;M[a++]=c>>3;c=c>>3|E[39]<<13;M[a++]=c>>8;c=c>>3|E[40]<<13;c=c>>3|E[41]<<13;c=c>>3|E[42]<<13;M[a++]=c>>7;c=c>>3|E[43]<<13;c=c>>3|E[44]<<13;c=c>>3|E[45]<<13;M[a++]=c>>6;c=c>>3|E[46]<<13;c=c>>3|E[47]<<13;M[a++]=c>>8;c=c>>3|E[48]<<13;c=c>>3|E[49]<<13;c=c>>3|E[50]<<13;M[a++]=c>>7;c=c>>3|E[51]<<13;M[a]=c>>12;sa=M[a]}else{c=sa<<6|U[0]<<10;M[a++]=c>>6;c=c>>6|U[1]<<10;M[a++]=c>>8;c=c>>5|U[2]<<11;c=c>>5|U[3]<<11;M[a++]=
c>>6;c=c>>4|U[4]<<12;c=c>>4|U[5]<<12;M[a++]=c>>6;c=c>>3|U[6]<<13;c=c>>3|U[7]<<13;M[a++]=c>>8;c=c>>7|ha[0]<<9;c=c>>2|ka[0]<<14;M[a++]=c>>7;c=c>>2|ia[0]<<14;c=c>>6|na[0]<<10;M[a++]=c>>7;c=c>>3|E[0]<<13;c=c>>3|E[1]<<13;c=c>>3|E[2]<<13;M[a++]=c>>6;c=c>>3|E[3]<<13;c=c>>3|E[4]<<13;M[a++]=c>>8;c=c>>3|E[5]<<13;c=c>>3|E[6]<<13;c=c>>3|E[7]<<13;M[a++]=c>>7;c=c>>3|E[8]<<13;c=c>>3|E[9]<<13;c=c>>3|E[10]<<13;M[a++]=c>>6;c=c>>3|E[11]<<13;c=c>>3|E[12]<<13;M[a++]=c>>8;c=c>>7|ha[1]<<9;c=c>>2|ka[1]<<14;M[a++]=c>>7;c=
c>>2|ia[1]<<14;c=c>>6|na[1]<<10;M[a++]=c>>7;c=c>>3|E[13]<<13;c=c>>3|E[14]<<13;c=c>>3|E[15]<<13;M[a++]=c>>6;c=c>>3|E[16]<<13;c=c>>3|E[17]<<13;M[a++]=c>>8;c=c>>3|E[18]<<13;c=c>>3|E[19]<<13;c=c>>3|E[20]<<13;M[a++]=c>>7;c=c>>3|E[21]<<13;c=c>>3|E[22]<<13;c=c>>3|E[23]<<13;M[a++]=c>>6;c=c>>3|E[24]<<13;c=c>>3|E[25]<<13;M[a++]=c>>8;c=c>>7|ha[2]<<9;c=c>>2|ka[2]<<14;M[a++]=c>>7;c=c>>2|ia[2]<<14;c=c>>6|na[2]<<10;M[a++]=c>>7;c=c>>3|E[26]<<13;c=c>>3|E[27]<<13;c=c>>3|E[28]<<13;M[a++]=c>>6;c=c>>3|E[29]<<13;c=c>>
3|E[30]<<13;M[a++]=c>>8;c=c>>3|E[31]<<13;c=c>>3|E[32]<<13;c=c>>3|E[33]<<13;M[a++]=c>>7;c=c>>3|E[34]<<13;c=c>>3|E[35]<<13;c=c>>3|E[36]<<13;M[a++]=c>>6;c=c>>3|E[37]<<13;c=c>>3|E[38]<<13;M[a++]=c>>8;c=c>>7|ha[3]<<9;c=c>>2|ka[3]<<14;M[a++]=c>>7;c=c>>2|ia[3]<<14;c=c>>6|na[3]<<10;M[a++]=c>>7;c=c>>3|E[39]<<13;c=c>>3|E[40]<<13;c=c>>3|E[41]<<13;M[a++]=c>>6;c=c>>3|E[42]<<13;c=c>>3|E[43]<<13;M[a++]=c>>8;c=c>>3|E[44]<<13;c=c>>3|E[45]<<13;c=c>>3|E[46]<<13;M[a++]=c>>7;c=c>>3|E[47]<<13;c=c>>3|E[48]<<13;c=c>>3|E[49]<<
13;M[a++]=c>>6;c=c>>3|E[50]<<13;c=c>>3|E[51]<<13;M[a++]=c>>8}}function f(){var a=0;var d=0;var g=0;var h=120;var l=new Int16Array(50);var k=new Int16Array(160);c(k);B(k,U);S(ea,U,k);var m=ea.dp0;var n=0;var q=0;for(var p=0;p<=3;p++,a+=13){r(k,p*40,l,m,m,h,ha,ka,d++);I(l,na,ia,g++,E,a);for(n=0;n<=39;n++){q=l[5+n]+m[n+h];m[n+h]=q<-32768?-32768:q>32767?32767:q}h+=40}for(n=0;n<120;n++)m[n]=m[160+n]}function c(a){var d=0;var f=0;var g=ea.z1;var h=ea.l_z2;var m=ea.mp;var n=0;var q=0;var p=0;var r=0;var t=
0;var u=0;for(var y=160;y!=0;){y--;r=qa[d++]>>3<<2<<16>>16;n=r-g<<16>>16;g=r;t=n;t<<=15;q=h>>15<<16>>16;p=h-(q<<15)<<16>>16;t+=l(p,32735);u=q*32735;h=k(u,t);u=k(h,16384);q=l(m,-28180);m=u>>15<<16>>16;var z=m+q;a[f++]=z<-32768?-32768:z>32767?32767:z}ea.z1=g;ea.l_z2=h;ea.mp=m}function g(a,c){var d=0;var f=ta?32:33;for(d=0;d<f;d++)a[d+c]=M[d];return f}function h(a,c){if(a==-32768&&c==-32768)return 32767;else return a*c>>15<<16>>16}function l(a,c){if(a==-32768&&c==-32768)return 32767;else{var d=a*c+16384;
d>>=15;return d<<16>>16}}function k(a,c){var d=0;if(a<=0)if(c>=0)return a+c;else{d=-(a+1)-(c+1);return d>=2147483647?-2147483648:-d-2}else if(c<=0)return a+c;else{d=a+c;return d>2147483647?2147483647:d}}function m(a){if(a<0){if(a<=-1073741824)return 0;a=~a}return((a&4294901760)!=0?(a&4278190080)!=0?-1+ua[255&a>>24]:7+ua[255&a>>16]:(a&65280)!=0?15+ua[255&a>>8]:23+ua[255&a])<<16>>16}function n(a,c){if(c>=16)return 0;if(c<=-16)if(a<0)return-1;else return-0;if(c<0)return q(a,-c);return a<<c<<16>>16}function q(a,
c){if(c>=16)if(a<0)return-1;else return-0;if(c<=-16)return 0;if(c<0)return a<<-c<<16>>16;return a>>c<<16>>16}function p(a,c){var d=a;var f=c;var g=0;var h=15;if(a==0)return 0;for(;h!=0;){h--;g=g<<17>>16;d<<=1;if(d>=f){d-=f;g++}}return g<<16>>16}function r(a,c,d,f,g,h,l,m,k){u(a,c,f,h,m,l,k);y(m[k],l[k],f,a,c,g,d,h)}function u(a,c,d,f,g,l,k){var n=0;var q=0;var p=new Int16Array(40);var r=0;var t=0;var y=0;var z=0;var B=0;var C=0;var A=0;for(var D=0;D<=39;D++){A=a[D+c];A=(A<0?A==-32768?32767:-A:A)<<
16>>16;if(A>B)B=A}A=0;if(B==0)C=0;else A=m(B<<16);if(A>6)C=0;else C=6-A<<16>>16;for(D=0;D<=39;D++)p[D]=a[D+c]>>C;r=0;q=40;for(n=40;n<=120;n++){var w=0;var v=1;w=p[0]*d[f-n];w+=p[1]*d[v+f-n];v++;w+=p[2]*d[v+f-n];v++;w+=p[3]*d[v+f-n];v++;w+=p[4]*d[v+f-n];v++;w+=p[5]*d[v+f-n];v++;w+=p[6]*d[v+f-n];v++;w+=p[7]*d[v+f-n];v++;w+=p[8]*d[v+f-n];v++;w+=p[9]*d[v+f-n];v++;w+=p[10]*d[v+f-n];v++;w+=p[11]*d[v+f-n];v++;w+=p[12]*d[v+f-n];v++;w+=p[13]*d[v+f-n];v++;w+=p[14]*d[v+f-n];v++;w+=p[15]*d[v+f-n];v++;w+=p[16]*
d[v+f-n];v++;w+=p[17]*d[v+f-n];v++;w+=p[18]*d[v+f-n];v++;w+=p[19]*d[v+f-n];v++;w+=p[20]*d[v+f-n];v++;w+=p[21]*d[v+f-n];v++;w+=p[22]*d[v+f-n];v++;w+=p[23]*d[v+f-n];v++;w+=p[24]*d[v+f-n];v++;w+=p[25]*d[v+f-n];v++;w+=p[26]*d[v+f-n];v++;w+=p[27]*d[v+f-n];v++;w+=p[28]*d[v+f-n];v++;w+=p[29]*d[v+f-n];v++;w+=p[30]*d[v+f-n];v++;w+=p[31]*d[v+f-n];v++;w+=p[32]*d[v+f-n];v++;w+=p[33]*d[v+f-n];v++;w+=p[34]*d[v+f-n];v++;w+=p[35]*d[v+f-n];v++;w+=p[36]*d[v+f-n];v++;w+=p[37]*d[v+f-n];v++;w+=p[38]*d[v+f-n];v++;w+=p[39]*
d[v+f-n];v++;if(w>r){q=n<<16>>16;r=w}}l[k]=q;r<<=1;r=r>>6-C;t=0;for(D=0;D<=39;D++){var E=0;E=d[D-q+f]>>3<<16>>16;t+=E*E}t<<=1;if(r<=0){g[k]=0;return}if(r>=t){g[k]=3;return}A=m(t);y=r<<A>>16<<16>>16;z=t<<A>>16<<16>>16;for(var F=0;F<=2;F++){if(y<=h(z,ma[F]))break;g[k]=F}}function y(a,c,d,f,g,h,k,m){var n=0;var p=0;var q=0;switch(a){case 0:n=3277;for(p=0;p<=39;p++){h[p+m]=l(n,d[p-c+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}break;case 1:n=11469;for(p=0;p<=39;p++){h[p+m]=l(n,d[p-c+m]);
q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}break;case 2:n=21299;for(p=0;p<=39;p++){h[p+m]=l(n,d[p-c+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}break;case 3:n=32767;for(p=0;p<=39;p++){h[p+m]=l(n,d[p-c+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}}}function B(a,c){A(a);D(c);w(c);G(c)}function z(a,c,d,f,g){for(var h=0;h<g;h++)d[f+h]=a[c+h]}function A(a){var c=0;var d=0;var f=0;var g=0;var h=0;var k=0;var n=0;for(k=0;k<=159;k++){n=a[k]+0;f=n<-32768?-32768:n>32767?
32767:n;if(f>g)g=f}if(g==0)h=0;else h=4-m(g<<16)<<16>>16;if(h>0)switch(h){case 1:for(k=0;k<=159;k++)a[k]=l(a[k],16384);break;case 2:for(k=0;k<=159;k++)a[k]=l(a[k],16384>>1);break;case 3:for(k=0;k<=159;k++)a[k]=l(a[k],16384>>2);break;case 4:for(k=0;k<=159;k++)a[k]=l(a[k],16384>>3)}var p=a;var q=p[d];var r=[0,0,0,0,0,0,0,0,0];z(r,0,R,0,R.length);R[0]+=q*p[d-0];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];R[2]+=q*p[d-2];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];R[2]+=q*
p[d-2];R[3]+=q*p[d-3];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];R[2]+=q*p[d-2];R[3]+=q*p[d-3];R[4]+=q*p[d-4];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];R[2]+=q*p[d-2];R[3]+=q*p[d-3];R[4]+=q*p[d-4];R[5]+=q*p[d-5];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];R[2]+=q*p[d-2];R[3]+=q*p[d-3];R[4]+=q*p[d-4];R[5]+=q*p[d-5];R[6]+=q*p[d-6];q=p[++d];R[0]+=q*p[d-0];R[1]+=q*p[d-1];R[2]+=q*p[d-2];R[3]+=q*p[d-3];R[4]+=q*p[d-4];R[5]+=q*p[d-5];R[6]+=q*p[d-6];R[7]+=q*p[d-7];q=p[++d];for(c=d;c<160;++c){q=p[c];R[0]+=q*p[c-0];R[1]+=
q*p[c-1];R[2]+=q*p[c-2];R[3]+=q*p[c-3];R[4]+=q*p[c-4];R[5]+=q*p[c-5];R[6]+=q*p[c-6];R[7]+=q*p[c-7];R[8]+=q*p[c-8]}for(k=0;k<9;k++)R[k]<<=1;if(h>0)for(k=0;k<160;k++)a[k]<<=h}function D(a){var c=new Int16Array(1);var d=0;var f=0;var g=new Int16Array(9);var h=new Int16Array(9);var k=new Int16Array(9);if(R[0]==0){for(f=0;f<8;f++)a[f]=0;return}c[0]=m(R[0]);for(f=0;f<=8;f++)g[f]=R[f]<<c[0]>>16;z(g,0,k,0,7);z(g,0,h,0,8);for(var n=1;n<=8;n++,d++){c[0]=h[1];c[0]=(c[0]<0?c[0]==-32768?32767:-c[0]:c[0])<<16>>
16;if(h[0]<c[0]){for(f=n;f<8;f++)a[f]=0;return}a[d]=p(c[0],h[0]);if(h[1]>0)a[d]=-a[d];if(n==8)return;c[0]=l(h[1],a[d]);var q=h[0]+c[0];h[0]=q<-32768?-32768:q>32767?32767:q;for(var r=1;r<=8-n;r++){c[0]=l(k[r],a[d]);var t=h[r+1]+c[0];h[r]=t<-32768?-32768:t>32767?32767:t;c[0]=l(h[r+1],a[d]);var u=k[r]+c[0];k[r]=u<-32768?-32768:u>32767?32767:u}}}function w(a){var c;for(var d=0;d<8;d++){c=a[d];c=(c<0?c==-32768?32767:-c:c)<<16>>16;if(c<22118)c>>=1;else if(c<31130)c-=11059;else{c-=26112;c<<=2}a[d]=a[d]<
0?-c:c}}function G(a){var c=0;H(20480,0,31,-32,a,c++);H(20480,0,31,-32,a,c++);H(20480,2048,15,-16,a,c++);H(20480,-2560,15,-16,a,c++);H(13964,94,7,-8,a,c++);H(15360,-1792,7,-8,a,c++);H(8534,-341,3,-4,a,c++);H(9036,-1144,3,-4,a,c++)}function H(a,c,d,f,g,k){var l=0;l=h(a<<16>>16,g[k]);var m=l+(c<<16>>16);l=m<-32768?-32768:m>32767?32767:m;var n=l+256;l=n<-32768?-32768:n>32767?32767:n;l=l>>9<<16>>16;g[k]=(l>d?d-f:l<f?0:l-f)<<16>>16}function I(a,c,d,f,g,h){var k=new Int16Array(13);var l=new Int16Array(13);
J(a);L(k,d,f);N(k,g,h,c,f);P(g,l,h,ra);Q(d[f],l,a,ra)}function J(a){var c=0;for(var d=0;d<=39;d++){c=8192>>1;c+=a[d+0]*-134+a[d+1]*-374+a[d+3]*2054+a[d+4]*5741+a[d+5]*8192+a[d+6]*5741+a[d+7]*2054+a[d+9]*-374+a[d+10]*-134;c=c>>13<<16>>16;ya[d]=c<-32768?-32768:c>32767?32767:c}}function L(a,c,d){var f=0;var g=0;var h=0;var k;f=0;f+=v(0,1)+v(0,2)+v(0,3)+v(0,4)+v(0,5)+v(0,6)+v(0,7)+v(0,8)+v(0,9)+v(0,10)+v(0,11)+v(0,12);k=f;f+=v(0,0);f<<=1;g=f;f=0;f+=v(1,0)+v(1,1)+v(1,2)+v(1,3)+v(1,4)+v(1,5)+v(1,6)+v(1,
7)+v(1,8)+v(1,9)+v(1,10)+v(1,11)+v(1,12);f<<=1;if(f>g){h=1;g=f}f=0;f+=v(2,0)+v(2,1)+v(2,2)+v(2,3)+v(2,4)+v(2,5)+v(2,6)+v(2,7)+v(2,8)+v(2,9)+v(2,10)+v(2,11)+v(2,12);f<<=1;if(f>g){h=2;g=f}f=k;f+=v(3,12);f<<=1;if(f>g){h=3;g=f}for(var l=0;l<=12;l++)a[l]=ya[h+3*l];c[d]=h}function v(a,c){var d;d=ya[a+3*c]>>2<<16>>16;return d*d}function N(a,c,d,f,g){var k=0;var l=0;var m=0;var n=0;var p=0;var q=0;var r=0;var t=0;var u=0;for(u=0;u<=12;u++){n=a[u];n=n<0?n==-32768?32767:-n:n;if(n>l)l=n}r=0;n=l>>9<<16>>16;k=
0;for(u=0;u<=5;u++){if(n<=0)k|=1;else k|=0;n=n>>1<<16>>16;if(k==0)r++}n=r+5<<16>>16;var v=(l>>n<<16>>16)+(r<<3<<16>>16);m=v<-32768?-32768:v>32767?32767:v;O(m,ra);r=va;t=wa;p=6-r<<16>>16;q=pa[t];for(u=0;u<=12;u++){n=a[u]<<p<<16>>16;n=h(n,q);n=n>>12<<16>>16;c[u+d]=n+4<<16>>16}wa=t;va=r;f[g]=m}function O(a,c){var d=0;var f=0;if(a>15)d=(a>>3<<16>>16)-1<<16>>16;f=a-(d<<3)<<16>>16;if(f==0){d=-4;f=7}else{for(;f<=7;){f=(f<<1|1)<<16>>16;d--}f-=8}if(c==ra){va=d;wa=f}else{xa=d;Aa=f}}function P(a,c,d,f){var g=
0;var h=0;var k=0;var m=0;var p=0;var r=0;if(f==ra){h=oa[wa];p=6-va<<16>>16;k=p<-32768?-32768:p>32767?32767:p}else{h=oa[Aa];p=6-xa<<16>>16;k=p<-32768?-32768:p>32767?32767:p}p=k-1;m=n(1,p<-32768?-32768:p>32767?32767:p);Ba=0;for(var t=0;t<13;t++){g=(a[d++]<<1)-7<<16>>16;g=g<<28>>16;g=l(h,g);r=g+m;g=r<-32768?-32768:r>32767?32767:r;c[Ba++]=q(g,k)}}function Q(a,c,d,f){var g=13;var h=0;var k=0;if(f==ra)k=5;else k=0;switch(a){case 3:d[k++]=0;do{d[k++]=0;d[k++]=0;d[k++]=c[h++];--g}while(g!=0);break;case 2:do{d[k++]=
0;d[k++]=0;d[k++]=c[h++];--g}while(g!=0);break;case 1:do{d[k++]=0;d[k++]=c[h++];d[k++]=0;--g}while(g!=0);break;case 0:do{d[k++]=c[h++];d[k++]=0;d[k++]=0;--g}while(g!=0)}if(f==ra)d[k++]=0}function S(a,c,d){var f=new Int16Array(8);var g=a.j;var h=g;h^=1;a.j=h;var k=a.larpp[g];var l=a.larpp[h];X(c,k);Z(l,k,f);W(f);da(a,f,13,d,0);aa(l,k,f);W(f);da(a,f,14,d,13);ba(l,k,f);W(f);da(a,f,13,d,27);ca(k,f);W(f);da(a,f,120,d,40)}function X(a,c){var d=0;var f=0;T(a,c,f++,d,0,-32,13107);T(a,c,f++,d,0,-32,13107);
T(a,c,f++,d,2048,-16,13107);T(a,c,f++,d,-2560,-16,13107);T(a,c,f++,d,94,-8,19223);T(a,c,f++,d,-1792,-8,17476);T(a,c,f++,d,-341,-4,31454);T(a,c,f++,d,-1144,-4,29708)}function T(a,c,d,f,g,h,k){var m=a[d]+h;f=(m<-32768?-32768:m>32767?32767:m)<<26>>16;var n=f-(g<<17>>16);f=n<-32768?-32768:n>32767?32767:n;f=l(k,f);var p=f+f;c[d]=p<-32768?-32768:p>32767?32767:p}function Z(a,c,d){for(var f=0;f<8;f++){var g=(a[f]>>2<<16>>16)+(c[f]>>2<<16>>16);d[f]=g<-32768?-32768:g>32767?32767:g;var h=d[f]+(a[f]>>1<<16>>
16);d[f]=h<-32768?-32768:h>32767?32767:h}}function aa(a,c,d){for(var f=0;f<8;f++){var g=(a[f]>>1<<16>>16)+(c[f]>>1<<16>>16);d[f]=g<-32768?-32768:g>32767?32767:g}}function ba(a,c,d){for(var f=0;f<8;f++){var g=(a[f]>>2<<16>>16)+(c[f]>>2<<16>>16);d[f]=g<-32768?-32768:g>32767?32767:g;var h=d[f]+(c[f]>>1<<16>>16);d[f]=h<-32768?-32768:h>32767?32767:h}}function ca(a,c){for(var d=0;d<8;d++)c[d]=a[d]}function W(a){var c=0;var d=0;for(var f=0;f<8;f++)if(a[f]<0){c=(a[f]==-32768?32767:-a[f])<<16>>16;d=(c>>2<<
16>>16)+26112;a[f]=-(c<11059?c<<1:c<20070?c+11059:d<-32768?-32768:d>32767?32767:d)<<16>>16}else{c=a[f];d=(c>>2<<16>>16)+26112;a[f]=(c<11059?c<<1:c<20070?c+11059:d<-32768?-32768:d>32767?32767:d)<<16>>16}}function da(a,c,d,f,g){var h=a.u;var k=0;var m=0;var n=0;var p=0;var q=0;var r=0;var t=0;for(var u=0;d!=0;){d--;k=p=f[g];for(r=0;r<8;r++){n=h[r];q=c[r];h[r]=p;m=l(q,k);t=n+m;p=t<-32768?-32768:t>32767?32767:t;m=l(q,n);u=k+m;k=u<-32768?-32768:u>32767?32767:u}f[g++]=k}a.u=h}function ja(){this.dp0=new Int16Array(280);
this.z1=0;this.l_z2=0;this.mp=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),new Int16Array(8)];this.j=0;this.nrp=40;this.v=new Int16Array(9);this.msr=0}var la=33;var ma=[6554,16384,26214,32767];var pa=[29128,26215,23832,21846,20165,18725,17476,16384];var oa=[18431,20479,22527,24575,26623,28671,30719,32767];var ea=new ja;var U=new Int16Array(8);var ha=new Int16Array(4);var ia=new Int16Array(4);var ka=new Int16Array(4);var na=new Int16Array(4);var E=new Int16Array(13*4);var qa=new Int16Array(160);
var M=new Uint8Array(la);var sa=0;this.encode=function(c,f,h,k){a(c,f);d();return g(h,k)};var ta=false;var ua=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var R=new Int32Array(9);var va=0;var wa=0;var xa=0;var Aa=0;var Ba=0;var ra=0;var Ea=1;var ya=new Int16Array(40)}k.name="AUDIO_INPUT";k.process=function(d){var g=d.getByte();var h=null;switch(g){case 1:var m=d.getLittleEndian32();h=new RdpBuffer(new Uint8Array(5),0,5);h.setByte(1);h.setLittleEndian32(m);h.markEnd();k.send(h);break;case 2:a(d);break;case 3:f(d);break;case 7:c(d);
break;default:svGlobal.logger.warn("audioInpt: invalid tag:"+g)}};var B=false;k.onclose=function(){B=false;if(G)G.close()};var u=new Uint8Array(1);u[0]=5;var z=false;var y=m.reconnectOnResize;var A=new Uint8Array(0);var w=null;var G=new h(hi5.audio.getAudioContext())})();m.addDynamicChannel(k)}m.addDynamicChannel(g())}};var Ka=new Xb;var U=new Eb;var Mb=new od;var sb=new Array(20);var Ja=0;this.getFileUrl=function(f){return m.modifyURL(Ea()+"/DOWNLOAD?s="+db+"&f="+f)};this.reconnect=function(f,d,
c){c=c||false;if((!T||!Ia)&&!c)return false;if(t.minWidth&&f<t.minWidth)f=t.minWidth;if(t.minHeight&&d<t.minHeight)d=t.minHeight;f=pb(f);d=pb(d);if(!c&&Math.abs(f-N)<4&&Math.abs(d-v)<4)return false;Ia=false;svGlobal.logger.info("reconnecting...");H("8E0"+f+"\t"+d);return true};this.notify=function(f,d){f="8E6"+f;if(d)f+="\t"+d.join(";");H(f)};this.getUploadManager=function(){return ha};this.addSurface=function(f){if(w.hasSurface(f))return;if(!ub)z.setContext(f.context);if(w.indexOf(f)!=-1&&f.railWin)return;
if(xa)f.setPlayerMode();if(t.mouseMoveEmu)f.mouseMoveEmu=oa(t.mouseMoveEmu);f.setConfig(G);w.addSurface(f);f.setSize(N,v,da?"hidden":null);f.setController(Qa);f.setFastCopy(oa(t.fastCopy));f.setTouchpad(oa(t.touchpad));f.setClipboard(oa(t.mapClipboard));if(Hb)ac(f);if(t.invitation){w.setReadOnly(true);btn=hi5.$("requestControl");if(btn)btn.disabled=false}f.run(parseInt(t.keyboard||1033,10))};this.getRunninApps=this.getRunningApps=function(){var f=[];var d=0;for(var c=w.length;d<c;d++){if(!w[d].railWin.getMain(w.zOrders))continue;
f.push(w[d].railWin.getMain(w.zOrders)["titleInfo"])}return f};this.startApp=function(f,d,c){H("8C2"+f+"\t"+d+"\t"+c);var g=w[w.length-1];if(g)g.remoteApp=new bc(f,d,c)};this.startExitingApp=function(f){var d=w.popWins(f);var c=d.length;for(var g=c-1;g>=0;g--)w.addWin(d[g])};this.VirtualChannel=function(){return new Fb(143)};this.GatewayChannel=function(){return new Fb(28)};this.DynamicChannel=function(){return new Fb(64)};this.addChannel=function(f){$a[f.name]=f};this.addGatewayChannel=function(f){ab[f.name]=
f};this.addDynamicChannel=function(f){ma.names.push(f.name);ma[f.name]=f;ma.count++};if(oa(t.smartCard)){var kb=new m.GatewayChannel;var Pb=null;kb.name="SCARDSTB";kb.onopen=function(){Pb=document.getElementById(hi5.appcfg.clientAppletId||"clientApplet")};kb.process=function(f){var d=null;if(Pb){var c=f.getPosition();var g=hi5.Base64.enc(f.getData(),f.getEnd()-c,c);try{g=Pb.deviceControl(g);d=hi5.Base64.dec(g,0)}catch(h){svGlobal.logger.warn(h)}}if(!d)d=[0];var a=new hi5.DataBuffer(d);a.markEnd(d.length);
kb.send(a)};m.addGatewayChannel(kb)}this.run=function(){cc();if(ja.supportWebAudio)ja.iOSFix()};this.getDesktop=function(){return z};this.mouseDown=function(f,d,c){if(sa)H("80"+f+"\t"+d+"\t"+c)};this.mouseMove=function(f,d){if(sa)H("82"+f+"\t"+d)};this.mouseUp=function(f,d,c){if(sa)H("81"+f+"\t"+d+"\t"+c)};this.writeKeyCode=function(f,d){if(sa)H("8B"+(f?0:49152)+"\t"+d)};this.writeScancode=function(f,d){if(sa){if(typeof f=="number"){H("84"+"0\t"+f);H("84"+"49152\t"+f);return}H("84"+(f?0:49152)+"\t"+
d)}};this.writeRawInput=function(f){if(sa)H(f)};var ka=new RdpBuffer([],0,0);this.sendPing=function(f){if(T)ra.sendPingData(f)};this.startPing=function(f,d){ra.setInterval(f,d)};this.stopPing=function(){ra.setInterval(0)};var va=null;var kc=0;this.play=function(){H("F3")};this.pause=function(){H("F2")};this.scan=function(f){H("F4"+(f?"1":"0"))};this.seek=function(f){var d=w.getFocused();if(d&&T){H("F4"+(f?"1":"0")+"\t"+(f/d.getScale()|0));z.pause(true)}};var X={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050};
var nc=false;this.showMessage=function(f,d,c){if(!m.displayMsg||!f)return;var g=d||w.getFocused();if(g)g.showMessage(f,c);else hi5.notifications.notify({"msg":f,"timeout":c||0})};var vb=new ie;var Sa=new me;var yc=new re;var Lc=new ne;var Ib=Lc.process;var Dc=new function(){var f=[{d:507,c:"text"}];this.distance=function(d,c){var f=0|0;var a=0;for(var h=d.length;a<h;a++)if(d[a]!=0)f+=a%c+(a/c|0);return f};this.getName=function(d,c,g){var a=Dc.distance(d,c);var h=0;for(var k=f.length;h<k;h++)if(Math.abs(a-
f[h].d)<128)return f[h].c;return null}};var Ee=[1,2,1,0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,2,1,0,2,1,2,3];var hb={readVar4Bytes:function(f){var d=f.getByte();var c=(d&192)>>6;var g=0;switch(c){case 0:g=d&63;break;case 1:g=(d&63)<<8;g|=f.getByte();break;case 2:g=(d&63)<<16;d=f.getByte();g|=d<<8;d=f.getByte();g|=d;break;case 3:g=(d&63)<<24;d=f.getByte();g|=d<<16;d=f.getByte();g|=d<<8;d=f.getByte();g|=d}return g},readVar2Bytes:function(f){var d=f.getByte();if((d&128)!=0)return(d&127)<<8|f.getByte();else return d}};
this.close=function(){if(Z&&Z.readyState!=WebSocket.CLOSING&&Z.readyState!=WebSocket.CLOSED)try{for(;Z&&Z.readyState!=WebSocket.CLOSING&&Z.readyState!=WebSocket.CLOSED;){if(!xa&&Z.readyState==WebSocket.OPEN)H("85-1");Z.close()}}catch(f){La()}else La()};if(!hi5.browser.isChromeApp)window.addEventListener("unload",La,false);else chrome.runtime.onSuspend.addListener(La);var la=16777215}svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
